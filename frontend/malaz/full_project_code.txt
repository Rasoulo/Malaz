
// =======================================================
// FILE PATH: lib\core\config\color\app_color.dart
// =======================================================

import 'package:flutter/material.dart';

class AppColors {
  static const Color primaryDark = Color(0xFFEDB95E);
  static const Color primaryLight = Color(0xFFC59232);

  static const Color secondaryDark = Color(0xFF3D3D3D);
  static const Color secondaryLight = Color(0xFF909090);

  static const Color accent = Color(0x2DFFE1ED);
  static const tertiary = Colors.blue;

  static const Color backgroundLight = Color(0xFFFFFCF3);
  static const Color backgroundDark = Color(0xFF1B1A1A);

  static const Color surfaceLight = Color(0xFFFFFFFF);
  static const Color surfaceDark = Color(0xFF2D2C2C);

  static const Color textPrimaryLight = Color(0xFF2C2420);
  static const Color textSecondaryLight = Color(0xFF8D7F7D);
  static const Color textPrimaryDark = Color(0xFFF5E6D3);
  static const Color textSecondaryDark = Color(0xFFA1887F);

  static const Color error = Color(0xFFD32F2F);

  static const LinearGradient premiumGoldGradient = LinearGradient(
    colors: [Color(0xFFFFCD71), Color(0xFFDCC18A)],
    begin: Alignment.topLeft,
    end: Alignment.bottomRight,
  );

  static const LinearGradient premiumGoldGradient2 = LinearGradient(
    colors: [Color(0xFFC69B4B), Color(0xFFFFCD71)],
    begin: Alignment.topLeft,
    end: Alignment.bottomRight,
  );
}
// =======================================================
// FILE PATH: lib\core\config\routes\app_routes.dart
// =======================================================

// core/config/routes
import 'dart:async';

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:malaz/presentation/cubits/auth/auth_cubit.dart';
import 'package:malaz/presentation/screens/auth/my_profile/my_profile_screen.dart';
import 'package:malaz/presentation/screens/auth/register/home_register_screen.dart';
import 'package:malaz/presentation/screens/chats/ChatWithAPerson.dart';
import 'package:malaz/presentation/screens/details/details_screen.dart';
import 'package:malaz/presentation/screens/property/add_property.dart';
import 'package:malaz/presentation/screens/splash_screen/splash_screen.dart';
import 'package:malaz/presentation/screens/auth/login/login_screen.dart';
import 'package:malaz/presentation/screens/main_wrapper/main_wrapper.dart'; // الشاشة الرئيسية
import 'package:malaz/presentation/screens/settings/settings_screen.dart';
import 'package:path/path.dart';

import '../../../domain/entities/apartment.dart';
import '../../../presentation/screens/auth/under_review/under_review.dart';
import '../../service_locator/service_locator.dart';

final GlobalKey<NavigatorState> _rootNavigatorKey = GlobalKey<NavigatorState>();

/// *[GoRouter]
/// GoRouter is a package for Flutter that makes navigation easier.
/// It uses URLs (like a website) to manage your app's screens.
///
/// *[Features_of_GoRouter]:
/// 1.  URL-based Navigation: You define a path (like '/home' or '/details/1') for each screen.
/// 2.  Handles Platform Back Button: It correctly handles the back button on Android and web.
/// 3.  Passing Parameters: You can easily pass data to your routes, either in the path ('/user/:id') or as an [extra] object.
/// 4.  Deep Linking: Allows users to open a specific screen in your app from a URL link.
///
/// *[How_to_use_it]:
/// 1.  [initialLocation]: This is the first route the app will show, usually '/'.
/// 2.  [routes]: This is a list of [GoRoute] objects. Each [GoRoute] defines a screen.
/// 3.  [GoRoute]:
///     - [path]: The URL-like string for the screen.
///     - [name]: An optional, unique name for the route. You can navigate using this name.
///     - [builder]: A function that returns the widget (screen) for this route.
///
/// *[Adding_a_route_WITHOUT_parameters]:
/// This is a simple route. When you navigate to '/settings', it shows the [SettingsScreen].
/// GoRoute(path: '/settings', name: 'settings', builder: (context, state) => const SettingsScreen()),
/// To navigate to it: `context.go('/settings')` or `context.goNamed('settings')`
///
/// *[Adding_a_route_WITH_parameters]:
/// In this example, we pass an [Apartment] object to the [details] screen using the [extra] property.
/// GoRoute(path: '/details', name: 'details', builder: (context, state) => DetailsScreen(apartment: state.extra as Apartment)),
/// To navigate to it: `context.go('/details', extra: myApartmentObject)`
/// :)

final AuthCubit authCubit = sl<AuthCubit>();
GoRouter buildAppRouter() {
  return GoRouter(
    initialLocation: '/',
    refreshListenable: GoRouterRefreshStream(authCubit.stream),
    redirect: (context, state) {
      final authState = authCubit.state;

      final goingToLogin = state.matchedLocation == '/login';
      final goingToRegister = state.matchedLocation == '/home_register';
      final goingToPending = state.matchedLocation == '/pending';
      final goingToSplash = state.matchedLocation == '/';

      /// 1️⃣ أثناء التحميل أو البداية → Splash
      if (authState is AuthInitial) {
        return goingToSplash ? null : '/';
      }

      /// 2️⃣ PENDING له أولوية مطلقة
      else if (authState is AuthPending) {
        return goingToPending ? null : '/pending';
      }

      /// 3️⃣ Authenticated
      else if (authState is AuthAuthenticated) {
        if (goingToLogin || goingToRegister || goingToSplash || goingToPending) {
          return '/home';
        }
        return null;
      }

      /// 4️⃣ Unauthenticated / Error
      else if (authState is AuthUnauthenticated || authState is AuthError) {
        return (goingToLogin || goingToRegister) ? null : '/login';
      }

      return null;
    },

    routes: [
      GoRoute(
        path: '/',
        name: 'splash',
        builder: (context, state) => const SplashScreen(),
      ),

      GoRoute(
          path: '/login',
          name: 'login',
          builder: (context, state) => LoginScreen(formKey: GlobalKey<FormState>()),
          pageBuilder: (context, state) => CustomTransitionPage(
            key: state.pageKey,
            child: LoginScreen(formKey: GlobalKey<FormState>()),
            transitionsBuilder:
                (context, animation, secondaryAnimation, child) {
              return FadeTransition(opacity: animation, child: child);
            },
          ),
      ),

      GoRoute(
        path: '/home',
        name: 'home',
        builder: (context, state) => const MainWrapper(),
      ),

      GoRoute(
        path: '/settings',
        name: 'settings',
        builder: (context, state) => const SettingsScreen(),
      ),

      GoRoute(
          path: '/details',
          name: 'details',
          builder: (context, state) {
            final apartment = state.extra as Apartment;
            return DetailsScreen(apartment: apartment);
          }),

      GoRoute(
          path: '/home_register',
          name: 'home_register',
          builder: (context, state) => HomeRegisterScreen()),

      GoRoute(
        path: '/pending',
        name: 'pending',
        builder: (context, state) => UnderReview(),
      ),

      GoRoute(
        path: '/profile',
        name: 'profile',
        builder: (context, state) => MyProfileScreen(),
      ),

      GoRoute(
        path: '/one_chat',
        name: 'one_chat',
        builder: (context, state) => ChatWithAPerson(),
      ),
    ],
    errorBuilder: (context, state) => Scaffold(
      body: Center(
        child: Text('Page not found: ${state.error.toString()}'),
      ),
    ),
  );
}

class GoRouterRefreshStream extends ChangeNotifier {
  GoRouterRefreshStream(Stream stream) {
    notifyListeners();
    _subscription = stream.asBroadcastStream().listen((_) => notifyListeners());
  }

  late final StreamSubscription _subscription;
}

// =======================================================
// FILE PATH: lib\core\config\routes\route_info.dart
// =======================================================

/// TODO: link with app routes required
class RouteNames {
  static const String splash = 'splash';
  static const String login = 'login';
  static const String register = 'register';
  static const String mainWrapper = 'main_wrapper';
  static const String settings = 'settings';
  static const String details = 'details';
  static const String addProperty = 'add_property';
}

class RoutePaths {
  static const String splash = '/';
  static const String login = '/login';
  static const String register = '/register';
  static const String mainWrapper = '/main';
  static const String settings = '/settings';
  static const String details = '/details';
  static const String addProperty = '/add_property';
}
// =======================================================
// FILE PATH: lib\core\config\theme\app_theme.dart
// =======================================================


import 'package:flutter/material.dart';
import '../color/app_color.dart';

class AppTheme {
  AppTheme._();

  static ThemeData get lightTheme {
    return ThemeData(
      useMaterial3: true,
      brightness: Brightness.light,
      primaryColor: AppColors.primaryLight,
      scaffoldBackgroundColor: AppColors.backgroundLight,
      colorScheme: const ColorScheme.light(
        primary: AppColors.primaryLight,
        secondary: AppColors.secondaryLight,
        background: AppColors.backgroundLight,
        surface: AppColors.surfaceLight,
        error: AppColors.error,
        onPrimary: Colors.white,
        onSecondary: AppColors.textPrimaryLight,
        onBackground: AppColors.textPrimaryLight,
        onSurface: AppColors.textPrimaryLight,
        onError: Colors.white,
        tertiary: AppColors.tertiary,
      ),
    );
  }

  static ThemeData get darkTheme {
    return ThemeData(
      useMaterial3: true,
      brightness: Brightness.dark,
      primaryColor: AppColors.primaryDark,
      scaffoldBackgroundColor: AppColors.backgroundDark,
      colorScheme: const ColorScheme.dark(
        primary: AppColors.primaryDark,
        secondary: AppColors.secondaryDark,
        background: AppColors.backgroundDark,
        surface: AppColors.surfaceDark,
        error: AppColors.error,
        onPrimary: Colors.white,
        onSecondary: AppColors.textPrimaryDark,
        onBackground: AppColors.textPrimaryDark,
        onSurface: AppColors.textPrimaryDark,
        onError: Colors.white,
        tertiary: AppColors.tertiary,
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\core\constants\app_constants.dart
// =======================================================

class AppConstants {
  static const baseurl = 'http://192.168.1.100:8000/api';
  /// [SharedPreferences] Keys
  static const String themeKey = 'theme_mode';
  static const String languageKey = 'language_code';
  static const String tokenKey = 'CACHED_TOKEN';

  /// [Failure] Keys
  static const String networkFailureKey = 'NETWORK_FAILURE_KEY';
  static const String unknownFailureKey = 'UNKNOWN_FAILURE_KEY';
  static const String cancelledFailureKey = 'CANCELLED_FAILURE_KEY';

  static const numberOfApartmentsEachRequest = 2;
}
// =======================================================
// FILE PATH: lib\core\errors\error_handler.dart
// =======================================================

import 'package:dio/dio.dart';
import 'package:flutter/src/widgets/framework.dart';
import 'package:malaz/l10n/app_localizations.dart';
import 'package:path/path.dart';
import '../errors/exceptions.dart';

/// TODO: translate
class ErrorHandler {
  static Exception handle(DioException error) {
    switch (error.type) {
      case DioExceptionType.connectionTimeout:
      case DioExceptionType.sendTimeout:
      case DioExceptionType.receiveTimeout:
      case DioExceptionType.connectionError:
        return NetworkException();

      case DioExceptionType.badResponse:
        return _handleBadResponse(error.response);

      case DioExceptionType.cancel:
        return ServerException();

      default:
        return UnexpectedException();
    }
  }

  static Exception _handleBadResponse(Response? response) {
    if (response == null) return ServerException(message: 'Unknown server error');

    final statusCode = response.statusCode;
    final data = response.data;
    String message = 'Something went wrong';

    if (data is Map && data.containsKey('message')) {
      message = data['message'];
    }

    if (statusCode == 401) {
      return UnauthenticatedException(message);
    }

    if(statusCode == 403) {
      if (message.toLowerCase().contains('does not exist')) {
        return PhoneNotFoundException(message);
      }
    }

    if (statusCode == 422 && data is Map) {
      if (data.containsKey('errors')) {
        final errors = data['errors'];
        if (errors is Map && errors.isNotEmpty) {
          final firstKey = errors.keys.first;
          final firstErrorList = errors[firstKey];
          if (firstErrorList is List && firstErrorList.isNotEmpty) {
            return ServerException(
              message: firstErrorList.first.toString(),
              statusCode: 422,
            );
          }
        }
      }
    }

    if (statusCode != null && statusCode >= 500) {
      return ServerException(message: 'Server internal error', statusCode: 500);
    }

    return ServerException(message: message, statusCode: statusCode);
  }
}
// =======================================================
// FILE PATH: lib\core\errors\exceptions.dart
// =======================================================


/// Represents errors that occur during data fetching or processing.
class ServerException implements Exception {
  final String? message;
  final int? statusCode;
  final Map<String, dynamic>? errors;

  ServerException({
    this.message,
    this.statusCode,
    this.errors,
  });

  @override
  String toString() => message ?? 'server exception';
}
/// Represents errors that occur when there is no internet connection.
class NetworkException implements Exception {}

class UnexpectedException implements Exception {}

/// Represents errors that occur when there is no cached data available.
class CacheException implements Exception {
  final String message;
  CacheException(this.message);
  @override
  String toString() => message;
}

/// Can be used for other general exceptions.
class GeneralException implements Exception {}

class UnauthenticatedException implements Exception {
  final String message;
  UnauthenticatedException(this.message);
  @override
  String toString() => message;
}

/// This exception appears when the user is in a pending state,
/// meaning an account with that username and password already exists but has not yet been approved by the admin.
class InvalidCredentialsException implements Exception {
  final String message;
  InvalidCredentialsException(this.message);
  @override
  String toString() => message;
}

/// This exception appears when there is no account with that number entered by the user.
class PhoneNotFoundException implements Exception {
  final String? message;
  PhoneNotFoundException(this.message);
  @override
  String toString() => 'PhoneNotFoundException: ${message ?? ''}';
}

/// This exception appears when the password for the accompanying number is incorrect.
class WrongPasswordException implements Exception {
  final String? message;
  WrongPasswordException([this.message]);
  @override
  String toString() => 'WrongPasswordException: ${message ?? ''}';
}

class PendingApprovalException implements Exception {
  final String message;
  PendingApprovalException(this.message);

  @override
  String toString() => message;
}
// =======================================================
// FILE PATH: lib\core\errors\failures.dart
// =======================================================


import 'package:equatable/equatable.dart';

/// [Failure]
///
/// A base class for all failures. Failures are part of the domain layer.
/// the main purpose of it is to handle all exceptions and convert them to failures
/// [Failure] extends from [Equatable] to make [Failure] objects comparable you
/// can search for it
abstract class Failure extends Equatable {
  final String? message;
  const Failure([this.message]);

  @override
  List<Object?> get props => [message];
}

/// Represents a failure that occurs when communicating with a server.
class ServerFailure extends Failure {
  const ServerFailure(super.message);
}

/// Represents a failure that occurs when there is no internet connection.
class CacheFailure extends Failure {
  const CacheFailure(super.message);
}

/// Represents a failure that occurs when accessing cached data.
class OfflineFailure extends Failure {
  const OfflineFailure(super.message);
}

/// Represents other general failures.
class GeneralFailure extends Failure {
  const GeneralFailure([super.message]);
}

/// This failure appears when the user is in a pending state,
/// meaning an account with that username and password already exists but has not yet been approved by the admin.
class InvalidCredentialsFailure extends Failure {
  const InvalidCredentialsFailure(super.message);
}

/// This exception appears when there is no account with that number entered by the user.
class PhoneNotFoundFailure extends Failure {
  const PhoneNotFoundFailure([super.message]);
}

/// This exception appears when the password for the accompanying number is incorrect.
class WrongPasswordFailure extends Failure {
  const WrongPasswordFailure(super.message);
}

class PendingApprovalFailure extends Failure {
  const PendingApprovalFailure()
      : super('Wait until approved by the officials');
}

class NetworkFailure extends Failure {
  const NetworkFailure([super.message]);
}

class UnauthenticatedFailure extends Failure {
  const UnauthenticatedFailure(super.message);
}

class UnexpectedFailure extends Failure {
  const UnexpectedFailure(super.message);
}
// =======================================================
// FILE PATH: lib\core\network\auth_interceptor.dart
// =======================================================

// core/network/auth_interceptor.dart
import 'package:dio/dio.dart';
import 'package:malaz/data/datasources/local/auth_local_datasource.dart';

class AuthInterceptor extends Interceptor {
  final AuthLocalDatasource localDatasource;

  AuthInterceptor({required this.localDatasource});

  @override
  void onRequest(RequestOptions options, RequestInterceptorHandler handler) async {
    try {
      final token = await localDatasource.getCachedToken();
      if (token != null && token.isNotEmpty) {
        options.headers['Authorization'] = 'Bearer $token';
      }
    } catch (e) {
      /// ignore caching errors here
    }
    handler.next(options);
  }
}

// =======================================================
// FILE PATH: lib\core\network\network_info.dart
// =======================================================

// core/network/network_info.dart
import 'package:internet_connection_checker/internet_connection_checker.dart';

abstract class NetworkInfo {
  Future<bool> get isConnected;
}

class NetworkInfoImpl implements NetworkInfo {
  final InternetConnectionChecker connectionChecker;

  NetworkInfoImpl(this.connectionChecker);

  @override
  Future<bool> get isConnected => connectionChecker.hasConnection;
}
// =======================================================
// FILE PATH: lib\core\network\network_service.dart
// =======================================================



import 'package:dio/dio.dart';

/// [NetWorkService]
///
/// Controls the dealing with dio.
/// why this is useful ? if we need to change any thing about network and we use
/// network queries over 50 places in the project we can only change it here and
/// it's automatically updated in all places.
/// *[baseUrl]
/// - on physical phone = http://10.0.2.2:your_lab_ib/api
/// - on android emulator a= http://10.0.2.2:8000/pi
/// *[crucial_notes] :
/// - do not commit this file after hamwi's commit
/// - put your baseurl according to your situation
/// :)

import '../constants/app_constants.dart';
import '../errors/error_handler.dart';
import 'auth_interceptor.dart';
abstract class NetworkService {
  Future<Response> get(String endpoint, {Map<String, dynamic>? queryParameters});
  Future<Response> post(String endpoint, {dynamic data, Map<String, dynamic>? queryParameters});
  Future<Response> put(String endpoint, {dynamic data, Map<String, dynamic>? queryParameters});
  Future<Response> delete(String endpoint, {dynamic data, Map<String, dynamic>? queryParameters});
}
//const baseurl = 'http://192.168.1.102:8000/api/users/'; // ! this baseurl works only for hamwi
class NetworkServiceImpl implements NetworkService {
  final Dio _dio;
  final AuthInterceptor interceptor;

  NetworkServiceImpl(this.interceptor)
      : _dio = Dio(
    BaseOptions(
      baseUrl: AppConstants.baseurl,
      headers: {
        'Content-Type': 'application/json',
        'Accept': 'application/json',
      },
      validateStatus: (status) => status != null && status < 500,
      followRedirects: false,
      receiveTimeout: const Duration(seconds: 30),
      connectTimeout: const Duration(seconds: 30),
    ),
  ) {
    _dio.interceptors.add(interceptor);
  }

  @override
  Future<Response> get(String endpoint, {Map<String, dynamic>? queryParameters}) async {
    try {
      final response = await _dio.get(endpoint, queryParameters: queryParameters);
      return response;
    } on DioException catch (e) {
      throw ErrorHandler.handle(e);
    }
  }

  @override
  Future<Response> post(String endpoint, {dynamic data, Map<String, dynamic>? queryParameters}) async {
    try {
      final response = await _dio.post(endpoint, data: data, queryParameters: queryParameters);
      print('>>>> ${response.data}');
      return response;
    } on DioException catch (e) {
      throw ErrorHandler.handle(e);
    }
  }

  @override
  Future<Response> put(String endpoint, {dynamic data, Map<String, dynamic>? queryParameters}) async {
    try {
      final response = await _dio.put(endpoint, data: data, queryParameters: queryParameters);
      return response;
    } on DioException catch (e) {
      throw ErrorHandler.handle(e);
    }
  }

  @override
  Future<Response> delete(String endpoint, {dynamic data, Map<String, dynamic>? queryParameters}) async {
    try {
      final response = await _dio.delete(endpoint, data: data, queryParameters: queryParameters);
      return response;
    } on DioException catch (e) {
      throw ErrorHandler.handle(e);
    }
  }
}

// =======================================================
// FILE PATH: lib\core\service_locator\service_locator.dart
// =======================================================

import 'package:get_it/get_it.dart';
import 'package:internet_connection_checker/internet_connection_checker.dart';
import 'package:malaz/data/datasources/local/auth_local_datasource.dart';
import 'package:malaz/data/repositories/auth_repository_impl.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';
import 'package:malaz/domain/usecases/auth/check_auth_usecase.dart';
import 'package:malaz/domain/usecases/auth/get_current_user_usecase.dart';
import 'package:malaz/domain/usecases/auth/login_usecase.dart';
import 'package:malaz/domain/usecases/auth/logout_usecase.dart';
import 'package:shared_preferences/shared_preferences.dart';
import 'package:dio/dio.dart';

import '../../data/datasources/remote/apartment_remote_data_source.dart';
import '../../data/datasources/remote/auth_remote_datasource.dart';
import '../../data/repositories/apartment_repository_impl.dart';
import '../../domain/repositories/apartment_repository.dart';
import '../../domain/usecases/auth/send_otp_usecase.dart';
import '../../domain/usecases/auth/verify_otp_usecase.dart';
import '../../domain/usecases/auth/register_usecase.dart';
import '../../domain/usecases/home/apartments_use_case.dart';
import '../../presentation/cubits/auth/auth_cubit.dart';
import '../../presentation/cubits/home/home_cubit.dart';
import '../../presentation/cubits/language/language_cubit.dart';
import '../../presentation/cubits/theme/theme_cubit.dart';
import '../network/auth_interceptor.dart';
import '../network/network_info.dart';
import '../network/network_service.dart';

/// [GetIt] / [service_locator]
///
/// It's a dependency injection framework for Dart.
/// Think of it as a "Magic Box" where we put our tools (Services/Classes)
/// to retrieve them later anywhere in the app without creating them again.
///
/// *[Definitions]:
/// - [Lazy]: Create the object ONLY when you ask for it (saves memory).
/// - [Singleton]: Create ONE instance and reuse it everywhere (like one fridge for the whole house).
/// - [Factory]: Create a NEW instance every time you ask (like a new plate for every customer).
///
/// *[how_to_use]:
///
/// Instead of creating objects manually like:
/// `final dio = Dio();`  <-- Don't do this!
///
/// You just ask the Service Locator:
/// `final dio = sl<Dio>();`  <-- Do this!
///
/// *[Services_Registered]:
/// - [sharedPreferences]: For caching simple data (Theme, Token, Language).
/// - [Dio]: For network requests (The advanced HTTP client).
/// - [InternetConnectionChecker]: To check if there is REAL internet access.
/// - [NetworkInfo]: To handle connection checks cleanly.
/// - [ThemeCubit]: To handle theme changes.
/// - [LanguageCubit]: To handle language changes.
/// :)

final sl = GetIt.instance;

Future<void> setUpServices() async {
  final sharedPreferences = await SharedPreferences.getInstance();
  sl.registerLazySingleton<SharedPreferences>(() => sharedPreferences);

  sl.registerLazySingleton<Dio>(() => Dio());

  sl.registerLazySingleton<NetworkService>(() => NetworkServiceImpl(sl()));


  sl.registerLazySingleton<InternetConnectionChecker>(
      () => InternetConnectionChecker());

  sl.registerLazySingleton<NetworkInfo>(() => NetworkInfoImpl(sl()));

  sl.registerFactory(() => ThemeCubit(sl()));

  sl.registerFactory(() => LanguageCubit(sl()));

  sl.registerFactory(() => HomeCubit(getApartmentsUseCase: sl()));

  sl.registerLazySingleton(() => GetApartmentsUseCase(sl()));

  sl.registerLazySingleton<ApartmentRepository>(() => ApartmentRepositoryImpl(remoteDataSource: sl()));

  sl.registerLazySingleton<ApartmentRemoteDataSource>(() => ApartmentRemoteDataSourceImpl(networkService: sl()));

  sl.registerLazySingleton<AuthLocalDatasource>(() => AuthLocalDatasourceImpl(sl<SharedPreferences>()),);
  sl.registerLazySingleton<AuthRemoteDatasource>(() => AuthRemoteDatasourceImpl(networkService: sl()));

  sl.registerLazySingleton<AuthRepository>(() => AuthRepositoryImpl(
    authRemoteDatasource: sl(),
    authLocalDatasource: sl(),
  ));

  sl.registerLazySingleton(() => RegisterUsecase(repository: sl()));
  sl.registerLazySingleton(() => LoginUsecase(repository: sl()));
  sl.registerLazySingleton(() => LogoutUsecase(repository: sl()));
  sl.registerLazySingleton(() => GetCurrentUserUsecase(repository: sl()));
  sl.registerLazySingleton(() => CheckAuthUsecase(repository: sl()));
  sl.registerLazySingleton(() => SendOtpUsecase(sl()));
  sl.registerLazySingleton(() => VerifyOtpUsecase(sl()));

  sl.registerLazySingleton(() => AuthInterceptor(localDatasource: sl()));

  sl.registerLazySingleton<AuthCubit>(() => AuthCubit(
    repository: sl<AuthRepository>(),
    loginUsecase: sl(),
    logoutUsecase: sl(),
    getCurrentUserUsecase: sl(),
    checkAuthUsecase: sl(),
    registerUsecase: sl(),
    sendOtpUsecase: sl(),
    verifyOtpUsecase: sl(),
  ));

}

// =======================================================
// FILE PATH: lib\core\usecases\usecase.dart
// =======================================================

import 'package:dartz/dartz.dart';

import '../errors/failures.dart';

abstract class UseCase<Type, Params>{
  Future<Either<Failure, Type>> call(Params params);
}

class  NoParams {}
// =======================================================
// FILE PATH: lib\data\datasources\apartments\apartments_source.dart
// =======================================================

// import '../../../domain/entities/apartment.dart';
//
// final List<Apartment> mockApartments = [
//   Apartment(
//     id: '1',
//     title: 'Modern Downtown Apartment',
//     location: 'Downtown, City Center',
//     price: 1200,
//     imageUrl: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800&fit=crop',
//     bedrooms: 2,
//     bathrooms: 2,
//     areaSqft: 1200,
//   ),
//   Apartment(
//     id: '2',
//     title: 'Luxury Penthouse Suite',
//     location: 'Uptown, Premium District',
//     price: 2500,
//     imageUrl: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&fit=crop',
//     bedrooms: 3,
//     bathrooms: 3,
//     areaSqft: 2000,
//   ),
// ];
// =======================================================
// FILE PATH: lib\data\datasources\local\auth_local_datasource.dart
// =======================================================

import 'dart:convert';

import 'package:malaz/data/models/user_model.dart';
import 'package:shared_preferences/shared_preferences.dart';

import '../../../domain/entities/user_entity.dart';

abstract class AuthLocalDatasource {
  // TOKEN
  Future<void> cacheToken(String token);
  Future<String?> getCachedToken();
  Future<void> clearToken();

  // USER
  Future<void> cacheUser(UserEntity user);
  Future<UserEntity?> getCachedUser();
  Future<void> clearUser();

  // PENDING
  Future<void> setPending(bool value);
  Future<bool> isPending();

  // CLEAR ALL
  Future<void> clearAll();
}

class AuthLocalDatasourceImpl implements AuthLocalDatasource {
  final SharedPreferences prefs;

  static const _KEY_TOKEN = 'CACHED_TOKEN';
  static const _KEY_USER = 'CACHED_USER';
  static const _KEY_PENDING = 'IS_PENDING';

  AuthLocalDatasourceImpl(this.prefs);

  // -------- TOKEN --------

  @override
  Future<void> cacheToken(String token) async {
    await prefs.setString(_KEY_TOKEN, token);
  }

  @override
  Future<String?> getCachedToken() async {
    return prefs.getString(_KEY_TOKEN);
  }

  @override
  Future<void> clearToken() async {
    await prefs.remove(_KEY_TOKEN);
  }

  // -------- USER --------

  @override
  Future<void> cacheUser(UserEntity user) async {
    final jsonString = jsonEncode(UserModel.fromEntity(user).toJson());
    await prefs.setString(_KEY_USER, jsonString);
  }

  @override
  Future<UserEntity?> getCachedUser() async {
    final jsonString = prefs.getString(_KEY_USER);
    if (jsonString == null) return null;
    return UserModel.fromJson(jsonDecode(jsonString));
  }

  @override
  Future<void> clearUser() async {
    await prefs.remove(_KEY_USER);
  }

  // -------- PENDING --------

  @override
  Future<void> setPending(bool value) async {
    await prefs.setBool(_KEY_PENDING, value);
  }

  @override
  Future<bool> isPending() async {
    return prefs.getBool(_KEY_PENDING) ?? false;
  }

  // -------- CLEAR ALL --------

  @override
  Future<void> clearAll() async {
    await clearToken();
    await clearUser();
    await setPending(false);
  }
}

// =======================================================
// FILE PATH: lib\data\datasources\remote\apartment_remote_data_source.dart
// =======================================================

import 'package:malaz/core/constants/app_constants.dart';

import '../../../../core/network/network_service.dart';
import '../../../domain/entities/apartments_list.dart';
import '../../models/apartment_model.dart';

abstract class ApartmentRemoteDataSource {
  Future<ApartmentsList> getApartments({String? cursor});
}

class ApartmentRemoteDataSourceImpl implements ApartmentRemoteDataSource {
  final NetworkService networkService;

  ApartmentRemoteDataSourceImpl({required this.networkService});

  @override
  Future<ApartmentsList> getApartments({String? cursor}) async {
    print('cursor sent $cursor');
    final response = await networkService.get(
      '/properties/all',
      queryParameters: {
        'per_page': AppConstants.numberOfApartmentsEachRequest,
        'cursor': cursor,
      },
    );

    List<ApartmentModel> apartments = [];
    if (response.data['data'] != null) {
      print('data : ${response.data['data']}');
      apartments = List<ApartmentModel>.from(
        (response.data['data'] as List).map((e) => ApartmentModel.fromJson(e)),
      );
    } else {
      print('what happened ? ${response.data['message']}');
    }

    String? nextCursor;
    String? prevCursor;

    if (response.data['meta'] != null) {
      nextCursor = response.data['meta']['next_cursor'];
      prevCursor = response.data['meta']['prev_cursor'];
      print('in datasource nextCursor : $nextCursor');
    } else {
      print('what happened ? meta is null and ${response.data['message']}');
    }

    print('apartments : $apartments');
    return ApartmentsList(
      apartments: apartments,
      nextCursor: nextCursor,
      prevCursor: prevCursor,
    );
  }
}
// =======================================================
// FILE PATH: lib\data\datasources\remote\auth_remote_datasource.dart
// =======================================================

import 'dart:convert';

import 'package:dio/dio.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/core/constants/app_constants.dart';
import 'package:malaz/core/errors/exceptions.dart';
import 'package:path/path.dart';

import '../../../core/network/network_service.dart';
import '../../../core/service_locator/service_locator.dart';
import '../../../domain/entities/user_entity.dart';
import '../../models/user_model.dart';

abstract class AuthRemoteDatasource {
  Future<Map<String, dynamic>> login({
    required String phone,
    required String password,
  });

  Future<Map<String, dynamic>> registerUser({
    required String phone,
    required String role,
    required String firstName,
    required String lastName,
    required String password,
    required String passwordConfirmation,
    required String dateOfBirth,
    required XFile profileImage,
    required XFile identityImage,
  });

  Future<void> logout();

  Future<void> sendOtp({required String phone});

  Future<Map<String, dynamic>> verifyOtp({required String phone, required String otp});

  Future<UserEntity> updateProfile({
    required String firstName,
    required String lastName,
    String? imagePath,
  });
}

class AuthRemoteDatasourceImpl implements AuthRemoteDatasource {
  final NetworkService networkService;

  AuthRemoteDatasourceImpl({required this.networkService});

  @override
  Future<Map<String, dynamic>> registerUser({
    required String phone,
    required String role,
    required String firstName,
    required String lastName,
    required String password,
    required String passwordConfirmation,
    required String dateOfBirth,
    required XFile profileImage,
    required XFile identityImage,
  }) async {
    final endpoint = '/users/register';

    try {
      final formData = FormData.fromMap({
        'phone': phone,
        'role': role,
        'first_name': firstName,
        'last_name': lastName,
        'password': password,
        'password_confirmation': passwordConfirmation,
        'date_of_birth': dateOfBirth,
        'profile_image': await MultipartFile.fromFile(
          profileImage.path,
          filename: basename(profileImage.path),
        ),
        'identity_card_image': await MultipartFile.fromFile(
          identityImage.path,
          filename: basename(identityImage.path),
        ),
      });

      final response = await networkService.post(
        endpoint,
        data: formData,
      );
      return response.data as Map<String, dynamic>;
    } catch (e, stack) {
      print('REGISTER ERROR: $e');
      print(stack);
      rethrow;
    }
  }

  @override
  Future<Map<String, dynamic>> login({
    required String phone,
    required String password,
  }) async {
    final endpoint = '/users/login';

    final response = await networkService.post(
      endpoint,
      data: {'phone': phone, 'password': password},
    );

    final data = response.data;
    String? message = data is Map<String, dynamic> ? data['message']?.toString() : null;

    if (response.statusCode == 200 && data['data'] != null) {
      return data;
    }

    /// TODO: merge to error handler
    if (message != null && message.toLowerCase().contains('wait until')) {
      throw PendingApprovalException(message);
    }

    if (data['access_token'] != null) {
      return data;
    }

    if (message != null && message.toLowerCase().contains('does not exist')) {
      throw PhoneNotFoundException(message);
    }

    if (message != null && message.toLowerCase().contains('invalid credentials')) {
      throw WrongPasswordException(message);
    }

    return data;
  }

  @override
  Future<void> logout() async {
    await networkService.post('/users/logout');
  }

  @override
  Future<void> sendOtp({required String phone}) async {
    try {
      final url = '${AppConstants.baseurl}/users/send-otp';
      final response = await networkService.post(url, queryParameters: {'phone': phone});
      if (response.statusCode == 200 || response.statusCode == 201) {
        return;
      } else {
        throw ServerException(message: 'sendOtp failed: ${response.statusCode}');
      }
    } catch (e) {
      print(e.toString());
      rethrow;
    }
  }

  @override
  Future<Map<String, dynamic>> verifyOtp({required String phone, required String otp}) async {
    try {
      final url = '${AppConstants.baseurl}/users/verify-otp';
      final response = await networkService.post(url, queryParameters: {'phone': phone, 'otp': otp});
      return response.data as Map<String, dynamic>;
    } catch (e) {
      rethrow;
    }
  }

  @override
  Future<UserEntity> updateProfile({
    required String firstName,
    required String lastName,
    String? imagePath,
  }) async {
    Map<String, dynamic> data = {
      "first_name": firstName,
      "last_name": lastName,
    };

    if (imagePath != null) {
      data["profile_image_url"] = await MultipartFile.fromFile(
        imagePath,
        filename: imagePath.split('/').last,
      );
    }

    FormData formData = FormData.fromMap(data);

    final response = await networkService.post(
      '/users/request-update',
      data: formData,
    );

    return UserModel.fromJson(response.data['data']);
  }
}

// =======================================================
// FILE PATH: lib\data\models\apartment_model.dart
// =======================================================

import '../../domain/entities/apartment.dart';

class ApartmentModel extends Apartment {
  ApartmentModel({
    required super.id,
    required super.ownerId,
    required super.status,
    required super.title,
    required super.price,
    required super.city,
    required super.governorate,
    required super.address,
    required super.description,
    required super.type,
    required super.rooms,
    required super.bathrooms,
    required super.bedrooms,
    required super.area,
    required super.rating,
    required super.numberOfReviews,
    required super.mainImageUrl,
    super.isFav,
  });

  factory ApartmentModel.fromJson(Map<String, dynamic> json) {
    return ApartmentModel(
      id: json['id'] as int,
      ownerId: json['owner_id'] as int? ?? 0,
      status: json['status'] ?? '',
      title: json['title'] ?? '',
      price: (json['price'] as num?)?.toInt() ?? 0,
      city: json['city'] ?? '',
      governorate: json['governorate'] ?? '',
      address: json['address'] ?? '',
      description: json['description'] ?? '',
      type: json['type'] ?? '',

      rooms: (json['number_of_rooms'] as num?)?.toInt() ?? 0,
      bathrooms: (json['number_of_baths'] as num?)?.toInt() ?? 0,
      bedrooms: (json['number_of_bedrooms'] as num?)?.toInt() ?? 0,

      area: (json['area'] as num?)?.toInt() ?? 0,
      rating: json['rating'] as num? ?? 0,
      numberOfReviews: (json['number_of_reviews'] as num?)?.toInt() ?? 0,

      mainImageUrl: json['main_image_url'] ?? '',

      isFav: json['is_favorite'] ?? false,
    );
  }
}
// =======================================================
// FILE PATH: lib\data\models\auth_result.dart
// =======================================================

import '../../domain/entities/user_entity.dart';

class AuthResult {
  final UserEntity user;
  final bool isPending;

  AuthResult({required this.user, required this.isPending});
}

// =======================================================
// FILE PATH: lib\data\models\user_model.dart
// =======================================================

import 'package:malaz/domain/entities/user_entity.dart';

class UserModel extends UserEntity{
  UserModel({
    required super.id,
    required super.first_name,
    required super.last_name,
    required super.phone,
    required super.role,
    required super.date_of_birth,
    required super.profile_image_url,
    required super.identity_card_image_url,
    required super.phone_verified_at,
    required super.created_at,
    required super.updated_at,
  });

  factory UserModel.pending({required String phone}) {
    return UserModel(
      id: 0,
      first_name: '',
      last_name: '',
      phone: phone,
      role: 'PENDING',
      date_of_birth: '',
      profile_image_url: '',
      identity_card_image_url: '',
      phone_verified_at: '',
      created_at: '',
      updated_at: '',
    );
  }

  factory UserModel.fromEntity(UserEntity user) {
    return UserModel(
      id: user.id,
      first_name: user.first_name,
      last_name: user.last_name,
      phone: user.phone,
      role: user.role,
      date_of_birth: user.date_of_birth,
      profile_image_url: user.profile_image_url,
      identity_card_image_url: user.identity_card_image_url,
      phone_verified_at: user.phone_verified_at,
      created_at: user.created_at,
      updated_at: user.updated_at,
    );
  }

  factory UserModel.fromJson(Map<String, dynamic> json){
    return UserModel(
      id: json['id'] is int ? json['id'] : int.parse(json['id'].toString()),
      first_name: json['first_name'] ?? '',
      last_name: json['last_name'] ?? '',
      phone: json['phone'] ?? '',
      role: json['role'] ?? '',
      date_of_birth: json['date_of_birth'] ?? '',
      profile_image_url: json['profile_image_url'] ?? '',
      identity_card_image_url: json['identity_card_image_url'] ?? '',
      phone_verified_at: json['phone_verified_at'] ?? '',
      created_at: json['created_at'] ?? '',
      updated_at: json['updated_at'] ?? '',
    );
  }

  Map<String, dynamic> toJson(){
    return {
      'id': id,
      'first_name': first_name,
      'last_name': last_name,
      'phone': phone,
      'role': role,
      'date_of_birth': date_of_birth,
      'profile_image_url': profile_image_url,
      'identity_card_image_url': identity_card_image_url,
      'phone_verified_at': phone_verified_at,
      'created_at': created_at,
      'updated_at': updated_at,
    };
  }
}
// =======================================================
// FILE PATH: lib\data\repositories\apartment_repository_impl.dart
// =======================================================


import 'package:malaz/data/datasources/remote/apartment_remote_data_source.dart';
import 'package:malaz/domain/repositories/apartment_repository.dart';

import '../../domain/entities/apartments_list.dart';

class ApartmentRepositoryImpl implements ApartmentRepository {
  final ApartmentRemoteDataSource remoteDataSource;

  ApartmentRepositoryImpl({required this.remoteDataSource});

  @override
  Future<ApartmentsList> getApartments({required String? cursor}) async {
    try {
      final remoteApartments = await remoteDataSource.getApartments(cursor: cursor);
      return remoteApartments;
    } catch (e) {
      rethrow;
    }
  }
}

// =======================================================
// FILE PATH: lib\data\repositories\auth_repository_impl.dart
// =======================================================

import 'package:dartz/dartz.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/core/errors/exceptions.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/data/datasources/local/auth_local_datasource.dart';
import 'package:malaz/data/datasources/remote/auth_remote_datasource.dart';
import 'package:malaz/domain/entities/user_entity.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';

import '../../domain/entities/auth_state.dart';
import '../models/user_model.dart';
import '../utils/response_parser.dart';

class AuthRepositoryImpl extends AuthRepository {
  final AuthRemoteDatasource authRemoteDatasource;
  final AuthLocalDatasource authLocalDatasource;

  AuthRepositoryImpl({
    required this.authRemoteDatasource,
    required this.authLocalDatasource,
  });

  @override
  Future<Either<Failure, AuthStatus>> checkAuth() async {
    try {
      final token = await authLocalDatasource.getCachedToken();
      final isPending = await authLocalDatasource.isPending();
      final user = await authLocalDatasource.getCachedUser();

      // PENDING USER (no token)
      if (isPending && user != null) {
        return Right(AuthStatus(
          isAuthenticated: false,
          isPending: true,
          user: user,
        ));
      }

      // AUTHENTICATED USER
      if (token != null && token.isNotEmpty && user != null) {
        return Right(AuthStatus(
          isAuthenticated: true,
          isPending: false,
          user: user,
        ));
      }

      // NOT AUTHENTICATED
      return Right(AuthStatus(
        isAuthenticated: false,
        isPending: false,
        user: null,
      ));
    } catch (e) {
      return Left(CacheFailure(e.toString()));
    }
  }

  @override
  Future<Either<Failure, UserEntity?>> getCurrentUser() async {
    try {
      final user = await authLocalDatasource.getCachedUser();
      return Right(user);
    } catch (e) {
      return Left(CacheFailure(e.toString()));
    }
  }

  @override
  Future<Either<Failure, bool>> isAuthentication() async {
    try {
      final token = await authLocalDatasource.getCachedToken();
      if (token != null && token.isNotEmpty) {
        return Right(true);
      }
      final user = await authLocalDatasource.getCachedUser();
      return Right(user != null);
    } catch (e) {
      return Left(CacheFailure(e.toString()));
    }
  }

  @override
  Future<Either<Failure, UserEntity>> login({
    required String phoneNumber,
    required String password,
  }) async {
    try {
      final result = await authRemoteDatasource.login(
        phone: phoneNumber,
        password: password,
      );

      if (result['message'] == 'Wait until is approved by the officials') {
        final us = await authLocalDatasource.getCachedUser();
        final pendingUser = UserModel.pending(phone: phoneNumber);
        await authLocalDatasource.cacheUser(pendingUser);
        await authLocalDatasource.setPending(true);
        return Right(pendingUser);
      }

      final user = UserModel.fromJson(result['user']);
      final token = result['access_token'];

      await authLocalDatasource.cacheUser(user);
      await authLocalDatasource.cacheToken(token);
      await authLocalDatasource.setPending(false);

      return Right(user);

      /// TODO: need to clean up
    } on PendingApprovalException{
      return Left(const PendingApprovalFailure());
    } on PhoneNotFoundException catch (e) {
      return Left(PhoneNotFoundFailure(e.message ?? 'This phone number does not exist.'));
    } on WrongPasswordException catch (e) {
      return Left(WrongPasswordFailure(e.message ?? 'Invalid credentials'));
    } on InvalidCredentialsException catch(e) {
      if(e.message!.toLowerCase().contains('wait until')) {
        return Left(InvalidCredentialsFailure(e.message));
      }
      return Left(InvalidCredentialsFailure('Invalid credentials'));
    } on ServerException catch (e) {
      return Left(ServerFailure(e.message ?? 'Server error'));
    } catch (e) {
      return Left(GeneralFailure());
    }
  }

  @override
  Future<Either<Failure, void>> logout() async {
    try {
      await authRemoteDatasource.logout();
      await authLocalDatasource.clearAll();
      return const Right(null);
    } on ServerException catch (e) {
      return Left(ServerFailure(e.message));
    } catch (e) {
      return Left(GeneralFailure(e.toString()));
    }
  }

  @override
  Future<Either<Failure, UserEntity>> register({
    required String phone,
    required String role,
    required String firstName,
    required String lastName,
    required String password,
    required String passwordConfirmation,
    required String dateOfBirth,
    required XFile profileImage,
    required XFile identityImage,
  }) async {
    try {
      final result = await authRemoteDatasource.registerUser(
        phone: phone,
        role: role,
        firstName: firstName,
        lastName: lastName,
        password: password,
        passwordConfirmation: passwordConfirmation,
        dateOfBirth: dateOfBirth,
        profileImage: profileImage,
        identityImage: identityImage,
      );
      final userMap = result['data'] as Map<String, dynamic>?;

      if (userMap == null) {
        return Left(ServerFailure('No user data returned from server'));
      }

      final user = UserModel.fromJson(userMap);
      await authLocalDatasource.cacheUser(user);

      return Right(user);
    } on ServerException catch (e) {
      return Left(ServerFailure(e.toString()));
    } on NetworkException {
      return Left(NetworkFailure());
    } on CacheException catch(e) {
      return Left(CacheFailure(e.toString()));
    } catch (e) {
      return Left(const GeneralFailure());
    }
  }

  @override
  Future<Either<Failure, void>> sendOtp({required String phone}) async {
    try {
      await authRemoteDatasource.sendOtp(phone: phone);
      return const Right(null);
    } on ServerException catch (e) {
      return Left(ServerFailure(e.message));
    } catch (e) {
      return Left(const GeneralFailure());
    }
  }

  @override
  Future<Either<Failure, bool>> verifyOtp(
      {required String phone, required String otp}) async {
    try {
      final res = await authRemoteDatasource.verifyOtp(phone: phone, otp: otp);
      final success = extractSuccess(res);
      if (success) return Right(true);

      final message = extractMessage(res) ?? 'Invalid code';
      return Left(ServerFailure(message));
    } on ServerException catch (e) {
      return Left(ServerFailure(e.message ?? 'Server error'));
    } catch (e) {
      return Left(const GeneralFailure());
    }
  }

  @override
  Future<Either<Failure, UserEntity>> updateFullProfile({
    required String firstName,
    required String lastName,
    String? imagePath,
  }) async {
    try {
      final user = await authRemoteDatasource.updateProfile(
        firstName: firstName,
        lastName: lastName,
        imagePath: imagePath,
      );
      return Right(user);
    } on ServerException catch (e) {
      return Left(ServerFailure(e.message));
    }
  }

  @override
  Future<void> updateCachedUser(UserEntity user) async {
    await authLocalDatasource.cacheUser(user);
  }
}
// =======================================================
// FILE PATH: lib\data\utils\failure_mapper.dart
// =======================================================

import '../../core/errors/exceptions.dart';
import '../../core/errors/failures.dart';

class FailureMapper {
  static Failure map(dynamic exception) {
    if (exception is NetworkException) {
      return NetworkFailure();
    }
    else if (exception is ServerException) {
      return ServerFailure(exception.message);
    }
    else if (exception is UnauthenticatedException) {
      return UnauthenticatedFailure(exception.message);
    } else {
      return UnexpectedFailure('Something went wrong');
    }
  }
}
// =======================================================
// FILE PATH: lib\data\utils\response_parser.dart
// =======================================================

// lib/data/utils/response_parser.dart
import 'dart:convert';

bool extractSuccess(dynamic data, {int? statusCode}) {
  try {
    if (statusCode != null) {
      if (statusCode >= 400) return false;
    }

    if (data == null) return false;

    dynamic parsed = data;
    if (data is String) {
      try {
        parsed = jsonDecode(data);
      } catch (_) { parsed = data; }
    }

    dynamic rawSuccess;
    if (parsed is Map) {
      rawSuccess = parsed['success'] ??
          parsed['status'] ??
          parsed['ok'] ??
          parsed['result'] ??
          (parsed['data'] is Map ? parsed['data']['success'] ?? parsed['data']['status'] : null);
    } else {
      rawSuccess = parsed;
    }

    if (rawSuccess is bool) return rawSuccess;
    if (rawSuccess is int) return rawSuccess == 1;
    if (rawSuccess is String) {
      final s = rawSuccess.toLowerCase().trim();
      return (s == 'true' || s == '1' || s == 'success' || s == 'ok' || s == 'verified');
    }

    final msg = extractMessage(parsed);
    if (msg != null) {
      final low = msg.toLowerCase();
      if (low.contains('success') || low.contains('verified') || low.contains('created')) return true;
      if (low.contains('error') || low.contains('invalid') || low.contains('failed')) return false;
    }

    if (statusCode != null && statusCode >= 200 && statusCode < 300) return true;
    return false;
  } catch (e) {
    return false;
  }
}

String? extractMessage(dynamic data) {
  try {
    if (data == null) return null;
    dynamic parsed = data;
    if (data is String) {
      try { parsed = jsonDecode(data); } catch (_) { parsed = data; }
    }
    if (parsed is Map) {
      final m = parsed['message'] ?? parsed['msg'] ?? parsed['error'] ?? parsed['errors'];
      if (m == null) return null;
      if (m is String) return m;
      try { return jsonEncode(m); } catch (_) { return m.toString(); }
    }
    if (parsed is String) return parsed;
    return parsed.toString();
  } catch (e) {
    return null;
  }
}

// =======================================================
// FILE PATH: lib\domain\entities\apartment.dart
// =======================================================

class Apartment {
  final int id;
  final int ownerId;
  final String status;
  final String title;
  final int price;
  final String city;
  final String governorate;
  final String address;
  final String description;
  final String type;
  final int rooms;
  final int bathrooms;
  final int bedrooms;
  final int area;
  final num rating;
  final int numberOfReviews;
  final String mainImageUrl;
  final bool isFav;

  Apartment({
    required this.id,
    required this.ownerId,
    required this.status,
    required this.title,
    required this.price,
    required this.city,
    required this.governorate,
    required this.address,
    required this.description,
    required this.type,
    required this.rooms,
    required this.bathrooms,
    required this.bedrooms,
    required this.area,
    required this.rating,
    required this.numberOfReviews,
    required this.mainImageUrl,
    this.isFav = false,
  });
}
// =======================================================
// FILE PATH: lib\domain\entities\apartments_list.dart
// =======================================================

import 'apartment.dart';

class ApartmentsList {
  final List<Apartment> apartments;
  final String? nextCursor;
  final String? prevCursor;

  ApartmentsList({
    required this.apartments,
    this.nextCursor,
    this.prevCursor,
  });
}
// =======================================================
// FILE PATH: lib\domain\entities\auth_state.dart
// =======================================================

import 'user_entity.dart';

class AuthStatus {
  final bool isAuthenticated;
  final bool isPending;
  final UserEntity? user;

  AuthStatus({
    required this.isAuthenticated,
    required this.isPending,
    required this.user,
  });
}

// =======================================================
// FILE PATH: lib\domain\entities\user_entity.dart
// =======================================================

import 'package:equatable/equatable.dart';

class UserEntity extends Equatable{
  final int id;
  final String first_name;
  final String last_name;
  final String phone;
  final String role;
  final String date_of_birth;
  final String profile_image_url;
  final String identity_card_image_url;
  final String phone_verified_at;
  final String created_at;
  final String updated_at;

  UserEntity({
    required this.id,
    required this.first_name,
    required this.last_name,
    required this.phone,
    required this.role,
    required this.date_of_birth,
    required this.profile_image_url,
    required this.identity_card_image_url,
    required this.phone_verified_at,
    required this.created_at,
    required this.updated_at,
  });

  factory UserEntity.emptyPending() {
    return UserEntity(
      id: 0,
      role: 'PENDING',
      first_name: '',
      last_name: '',
      phone: '',
      date_of_birth: '',
      profile_image_url: '',
      identity_card_image_url: '',
      phone_verified_at: '',
      created_at: '',
      updated_at: '',
    );
  }
  @override
  // TODO: implement props
  List<Object?> get props => [
    id,
    first_name,
    last_name,
    phone,role,
    date_of_birth,
    profile_image_url,
    identity_card_image_url,
    phone_verified_at,
    created_at,
    updated_at
  ];

}
// =======================================================
// FILE PATH: lib\domain\repositories\apartment_repository.dart
// =======================================================


import 'package:malaz/domain/entities/apartments_list.dart';

abstract class ApartmentRepository {
  Future<ApartmentsList> getApartments({required String? cursor});
}

// =======================================================
// FILE PATH: lib\domain\repositories\auth_repository.dart
// =======================================================


import 'package:dartz/dartz.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/domain/entities/user_entity.dart';

import '../../data/models/auth_result.dart';
import '../entities/auth_state.dart';

abstract class AuthRepository {

  Future<Either<Failure,UserEntity>> login({
    required String phoneNumber,
    required String password,
  });

  Future<Either<Failure, UserEntity>> register({
    required String phone,
    required String role,
    required String firstName,
    required String lastName,
    required String password,
    required String passwordConfirmation,
    required String dateOfBirth,
    required XFile profileImage,
    required XFile identityImage,
  });

  Future<Either<Failure,void>> logout();

  Future<Either<Failure,UserEntity?>> getCurrentUser();

  Future<Either<Failure,bool>> isAuthentication();

  Future<Either<Failure, void>> sendOtp({ required String phone });

  Future<Either<Failure, AuthStatus>> checkAuth();

  Future<Either<Failure, bool>> verifyOtp({ required String phone, required String otp });

  Future<Either<Failure, UserEntity>> updateFullProfile({
    required String firstName,
    required String lastName,
    String? imagePath,
  });

  Future<void> updateCachedUser(UserEntity user);
}
// =======================================================
// FILE PATH: lib\domain\usecases\auth\check_auth_usecase.dart
// =======================================================

import 'package:dartz/dartz.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/core/usecases/usecase.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';

import '../../entities/auth_state.dart';

class CheckAuthUsecase implements UseCase<AuthStatus, NoParams> {
  final AuthRepository repository;

  CheckAuthUsecase({required this.repository});

  @override
  Future<Either<Failure, AuthStatus>> call(NoParams params) async {
    return await repository.checkAuth();
  }
}

// =======================================================
// FILE PATH: lib\domain\usecases\auth\get_current_user_usecase.dart
// =======================================================

import 'package:dartz/dartz.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/core/usecases/usecase.dart';
import 'package:malaz/domain/entities/user_entity.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';

class  GetCurrentUserUsecase implements UseCase<UserEntity?,NoParams>{
  final AuthRepository repository;

  GetCurrentUserUsecase({required this.repository});

  @override
  Future<Either<Failure, UserEntity?>> call(NoParams params) async {
    return await repository.getCurrentUser();
  }


}
// =======================================================
// FILE PATH: lib\domain\usecases\auth\login_usecase.dart
// =======================================================

import 'package:dartz/dartz.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/core/usecases/usecase.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';

import '../../entities/user_entity.dart';

class LoginUsecase implements UseCase<UserEntity,LoginParams>{
  final AuthRepository repository;
  
  LoginUsecase({required this.repository});

  @override
  Future<Either<Failure, UserEntity>> call(LoginParams params) async {
    return await repository.login(phoneNumber: params.phoneNumber, password: params.password);
  }
}

class LoginParams{
  final String phoneNumber;
  final String password;

  LoginParams({required this.phoneNumber, required this.password});

}
// =======================================================
// FILE PATH: lib\domain\usecases\auth\logout_usecase.dart
// =======================================================

import 'package:dartz/dartz.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/core/usecases/usecase.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';

class LogoutUsecase implements UseCase<void,NoParams>{
  final AuthRepository repository;

  LogoutUsecase({required this.repository});

  @override
  Future<Either<Failure, void>> call(NoParams params) async {
    return await repository.logout();
  }
}
// =======================================================
// FILE PATH: lib\domain\usecases\auth\register_usecase.dart
// =======================================================

import 'package:dartz/dartz.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/core/errors/failures.dart';
import 'package:malaz/core/usecases/usecase.dart';
import 'package:malaz/domain/entities/user_entity.dart';
import 'package:malaz/domain/repositories/auth_repository.dart';

class RegisterUsecase implements UseCase<UserEntity, RegisterParams> {
  final AuthRepository repository;

  RegisterUsecase({required this.repository});

  @override
  Future<Either<Failure, UserEntity>> call(RegisterParams params) async {
    return await repository.register(
      phone: params.phone,
      role: params.role,
      firstName: params.firstName,
      lastName: params.lastName,
      password: params.password,
      passwordConfirmation: params.passwordConfirmation,
      dateOfBirth: params.dateOfBirth,
      profileImage: params.profileImage,
      identityImage: params.identityCardImage,
    );
  }
}

class RegisterParams {
  final String phone;
  final String role;
  final String firstName;
  final String lastName;
  final String password;
  final String passwordConfirmation;
  final String dateOfBirth;
  final XFile profileImage;
  final XFile identityCardImage;

  RegisterParams({
    required this.phone,
    required this.role,
    required this.firstName,
    required this.lastName,
    required this.password,
    required this.passwordConfirmation,
    required this.dateOfBirth,
    required this.profileImage,
    required this.identityCardImage,
  });
}

// =======================================================
// FILE PATH: lib\domain\usecases\auth\send_otp_usecase.dart
// =======================================================

// domain/usecases/send_otp_usecase.dart
import 'package:dartz/dartz.dart';
import '../../../core/errors/failures.dart';
import '../../../core/usecases/usecase.dart';
import '../../repositories/auth_repository.dart';

class SendOtpParams {
  final String phone;
  SendOtpParams(this.phone);
}

class SendOtpUsecase implements UseCase<void, SendOtpParams> {
  final AuthRepository repository;
  SendOtpUsecase(this.repository);
  @override
  Future<Either<Failure, void>> call(SendOtpParams params) {
    return repository.sendOtp(phone: params.phone);
  }
}

// =======================================================
// FILE PATH: lib\domain\usecases\auth\verify_otp_usecase.dart
// =======================================================

// domain/usecases/verify_otp_usecase.dart
import 'package:dartz/dartz.dart';

import '../../../core/errors/failures.dart';
import '../../../core/usecases/usecase.dart';
import '../../repositories/auth_repository.dart';

class VerifyOtpParams {
  final String phone;
  final String otp;
  VerifyOtpParams({required this.phone, required this.otp});
}

class VerifyOtpUsecase implements UseCase<bool, VerifyOtpParams> {
  final AuthRepository repository;
  VerifyOtpUsecase(this.repository);
  @override
  Future<Either<Failure, bool>> call(VerifyOtpParams params) {
    return repository.verifyOtp(phone: params.phone, otp: params.otp);
  }
}

// =======================================================
// FILE PATH: lib\domain\usecases\home\apartments_use_case.dart
// =======================================================


import 'package:malaz/domain/entities/apartment.dart';
import 'package:malaz/domain/repositories/apartment_repository.dart';

import '../../entities/apartments_list.dart';

class GetApartmentsUseCase {
  final ApartmentRepository repository;

  GetApartmentsUseCase(this.repository);

  Future<ApartmentsList> call({required String? cursor}) async {
    return await repository.getApartments(cursor: cursor);
  }
}

// =======================================================
// FILE PATH: lib\l10n\app_localizations.dart
// =======================================================

import 'dart:async';

import 'package:flutter/foundation.dart';
import 'package:flutter/widgets.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:intl/intl.dart' as intl;

import 'app_localizations_ar.dart';
import 'app_localizations_en.dart';
import 'app_localizations_fr.dart';
import 'app_localizations_ru.dart';
import 'app_localizations_tr.dart';

// ignore_for_file: type=lint

/// Callers can lookup localized strings with an instance of AppLocalizations
/// returned by `AppLocalizations.of(context)`.
///
/// Applications need to include `AppLocalizations.delegate()` in their app's
/// `localizationDelegates` list, and the locales they support in the app's
/// `supportedLocales` list. For example:
///
/// ```dart
/// import 'l10n/app_localizations.dart';
///
/// return MaterialApp(
///   localizationsDelegates: AppLocalizations.localizationsDelegates,
///   supportedLocales: AppLocalizations.supportedLocales,
///   home: MyApplicationHome(),
/// );
/// ```
///
/// ## Update pubspec.yaml
///
/// Please make sure to update your pubspec.yaml to include the following
/// packages:
///
/// ```yaml
/// dependencies:
///   # Internationalization support.
///   flutter_localizations:
///     sdk: flutter
///   intl: any # Use the pinned version from flutter_localizations
///
///   # Rest of dependencies
/// ```
///
/// ## iOS Applications
///
/// iOS applications define key application metadata, including supported
/// locales, in an Info.plist file that is built into the application bundle.
/// To configure the locales supported by your app, you’ll need to edit this
/// file.
///
/// First, open your project’s ios/Runner.xcworkspace Xcode workspace file.
/// Then, in the Project Navigator, open the Info.plist file under the Runner
/// project’s Runner folder.
///
/// Next, select the Information Property List item, select Add Item from the
/// Editor menu, then select Localizations from the pop-up menu.
///
/// Select and expand the newly-created Localizations item then, for each
/// locale your application supports, add a new item and select the locale
/// you wish to add from the pop-up menu in the Value field. This list should
/// be consistent with the languages listed in the AppLocalizations.supportedLocales
/// property.
abstract class AppLocalizations {
  AppLocalizations(String locale)
      : localeName = intl.Intl.canonicalizedLocale(locale.toString());

  final String localeName;

  static AppLocalizations of(BuildContext context) {
    return Localizations.of<AppLocalizations>(context, AppLocalizations)!;
  }

  static const LocalizationsDelegate<AppLocalizations> delegate =
      _AppLocalizationsDelegate();

  /// A list of this localizations delegate along with the default localizations
  /// delegates.
  ///
  /// Returns a list of localizations delegates containing this delegate along with
  /// GlobalMaterialLocalizations.delegate, GlobalCupertinoLocalizations.delegate,
  /// and GlobalWidgetsLocalizations.delegate.
  ///
  /// Additional delegates can be added by appending to this list in
  /// MaterialApp. This list does not have to be used at all if a custom list
  /// of delegates is preferred or required.
  static const List<LocalizationsDelegate<dynamic>> localizationsDelegates =
      <LocalizationsDelegate<dynamic>>[
    delegate,
    GlobalMaterialLocalizations.delegate,
    GlobalCupertinoLocalizations.delegate,
    GlobalWidgetsLocalizations.delegate,
  ];

  /// A list of this localizations delegate's supported locales.
  static const List<Locale> supportedLocales = <Locale>[
    Locale('ar'),
    Locale('en'),
    Locale('fr'),
    Locale('ru'),
    Locale('tr')
  ];

  /// No description provided for @welcome_back.
  ///
  /// In en, this message translates to:
  /// **'Welcome Back'**
  String get welcome_back;

  /// No description provided for @login_to_continue.
  ///
  /// In en, this message translates to:
  /// **'Login to continue your search'**
  String get login_to_continue;

  /// No description provided for @mobile_number.
  ///
  /// In en, this message translates to:
  /// **'Mobile Number'**
  String get mobile_number;

  /// No description provided for @send_verification_code.
  ///
  /// In en, this message translates to:
  /// **'Send verification code'**
  String get send_verification_code;

  /// No description provided for @login.
  ///
  /// In en, this message translates to:
  /// **'Login'**
  String get login;

  /// No description provided for @logout.
  ///
  /// In en, this message translates to:
  /// **'Logout'**
  String get logout;

  /// No description provided for @dont_have_account.
  ///
  /// In en, this message translates to:
  /// **'Don\'t have an account?'**
  String get dont_have_account;

  /// No description provided for @my_bookings.
  ///
  /// In en, this message translates to:
  /// **'My Bookings'**
  String get my_bookings;

  /// No description provided for @bookings.
  ///
  /// In en, this message translates to:
  /// **'bookings'**
  String get bookings;

  /// No description provided for @my_favorites.
  ///
  /// In en, this message translates to:
  /// **'My Favorites'**
  String get my_favorites;

  /// No description provided for @favorites.
  ///
  /// In en, this message translates to:
  /// **'favorites'**
  String get favorites;

  /// No description provided for @chats.
  ///
  /// In en, this message translates to:
  /// **'chats'**
  String get chats;

  /// No description provided for @select_theme.
  ///
  /// In en, this message translates to:
  /// **'select theme'**
  String get select_theme;

  /// No description provided for @select_language.
  ///
  /// In en, this message translates to:
  /// **'select language'**
  String get select_language;

  /// No description provided for @messages.
  ///
  /// In en, this message translates to:
  /// **'Messages'**
  String get messages;

  /// No description provided for @register.
  ///
  /// In en, this message translates to:
  /// **'Register'**
  String get register;

  /// No description provided for @home.
  ///
  /// In en, this message translates to:
  /// **'Home'**
  String get home;

  /// No description provided for @settings.
  ///
  /// In en, this message translates to:
  /// **'Settings'**
  String get settings;

  /// No description provided for @theme.
  ///
  /// In en, this message translates to:
  /// **'Theme'**
  String get theme;

  /// No description provided for @my_profile.
  ///
  /// In en, this message translates to:
  /// **'My Profile'**
  String get my_profile;

  /// No description provided for @become_a_renter.
  ///
  /// In en, this message translates to:
  /// **'Become a Renter'**
  String get become_a_renter;

  /// No description provided for @language.
  ///
  /// In en, this message translates to:
  /// **'Language'**
  String get language;

  /// No description provided for @first_name.
  ///
  /// In en, this message translates to:
  /// **'First Name'**
  String get first_name;

  /// No description provided for @last_name.
  ///
  /// In en, this message translates to:
  /// **'Last Name'**
  String get last_name;

  /// No description provided for @have_account.
  ///
  /// In en, this message translates to:
  /// **'Do you already have an account ? '**
  String get have_account;

  /// No description provided for @create_account.
  ///
  /// In en, this message translates to:
  /// **'Create Account'**
  String get create_account;

  /// No description provided for @join_to_find.
  ///
  /// In en, this message translates to:
  /// **'Join us to find your perfect apartment !'**
  String get join_to_find;

  /// No description provided for @password.
  ///
  /// In en, this message translates to:
  /// **'Password'**
  String get password;

  /// No description provided for @confirm_password.
  ///
  /// In en, this message translates to:
  /// **'Confirm Password'**
  String get confirm_password;

  /// No description provided for @id_document_message.
  ///
  /// In en, this message translates to:
  /// **'Please upload a photo of your ID document for security purposes:'**
  String get id_document_message;

  /// No description provided for @upload_id_message.
  ///
  /// In en, this message translates to:
  /// **'Click to upload ID document'**
  String get upload_id_message;

  /// No description provided for @png_jpg.
  ///
  /// In en, this message translates to:
  /// **'PNG, JPG, PDF up to 10MB'**
  String get png_jpg;

  /// No description provided for @profile_image_message.
  ///
  /// In en, this message translates to:
  /// **'Choose a picture that suits you!\nIf you need that..\n\nyour profile picture will appear when you message your future apartment owner!'**
  String get profile_image_message;

  /// No description provided for @next.
  ///
  /// In en, this message translates to:
  /// **'Next'**
  String get next;

  /// No description provided for @previous.
  ///
  /// In en, this message translates to:
  /// **'Previous'**
  String get previous;

  /// No description provided for @send_code.
  ///
  /// In en, this message translates to:
  /// **'Send verification code'**
  String get send_code;

  /// No description provided for @date_of_birth.
  ///
  /// In en, this message translates to:
  /// **'Date Of Birth'**
  String get date_of_birth;

  /// No description provided for @six_digits.
  ///
  /// In en, this message translates to:
  /// **'Please enter a 6-digit PIN code'**
  String get six_digits;

  /// No description provided for @field_required.
  ///
  /// In en, this message translates to:
  /// **'This field is required'**
  String get field_required;

  /// No description provided for @image_required.
  ///
  /// In en, this message translates to:
  /// **'This image is required'**
  String get image_required;

  /// No description provided for @malaz.
  ///
  /// In en, this message translates to:
  /// **'MALAZ'**
  String get malaz;

  /// No description provided for @share_your_property.
  ///
  /// In en, this message translates to:
  /// **'Share your property details with us'**
  String get share_your_property;

  /// No description provided for @add_property.
  ///
  /// In en, this message translates to:
  /// **'Add property'**
  String get add_property;

  /// No description provided for @uploud_photo_property.
  ///
  /// In en, this message translates to:
  /// **'Click to upload photos of your property'**
  String get uploud_photo_property;

  /// No description provided for @essential_details.
  ///
  /// In en, this message translates to:
  /// **'Essential Details'**
  String get essential_details;

  /// No description provided for @bedrooms.
  ///
  /// In en, this message translates to:
  /// **'Bedrooms:'**
  String get bedrooms;

  /// No description provided for @bathrooms.
  ///
  /// In en, this message translates to:
  /// **'Bathrooms:'**
  String get bathrooms;

  /// No description provided for @bathrooms_no_dots.
  ///
  /// In en, this message translates to:
  /// **'Bathrooms'**
  String get bathrooms_no_dots;

  /// No description provided for @area.
  ///
  /// In en, this message translates to:
  /// **'Area:'**
  String get area;

  /// No description provided for @price.
  ///
  /// In en, this message translates to:
  /// **'Price'**
  String get price;

  /// No description provided for @property_type.
  ///
  /// In en, this message translates to:
  /// **'Property Type'**
  String get property_type;

  /// No description provided for @apartment.
  ///
  /// In en, this message translates to:
  /// **'Apartment'**
  String get apartment;

  /// No description provided for @villa.
  ///
  /// In en, this message translates to:
  /// **'Villa'**
  String get villa;

  /// No description provided for @house.
  ///
  /// In en, this message translates to:
  /// **'House'**
  String get house;

  /// No description provided for @farm.
  ///
  /// In en, this message translates to:
  /// **'Farm'**
  String get farm;

  /// No description provided for @country_house.
  ///
  /// In en, this message translates to:
  /// **'Country House'**
  String get country_house;

  /// No description provided for @location_details.
  ///
  /// In en, this message translates to:
  /// **'Location Details'**
  String get location_details;

  /// No description provided for @city.
  ///
  /// In en, this message translates to:
  /// **'City:'**
  String get city;

  /// No description provided for @syria.
  ///
  /// In en, this message translates to:
  /// **'Syria'**
  String get syria;

  /// No description provided for @governorate.
  ///
  /// In en, this message translates to:
  /// **'Governorate:'**
  String get governorate;

  /// No description provided for @damascus.
  ///
  /// In en, this message translates to:
  /// **'Damascus'**
  String get damascus;

  /// No description provided for @address.
  ///
  /// In en, this message translates to:
  /// **'Address:'**
  String get address;

  /// No description provided for @address_loc.
  ///
  /// In en, this message translates to:
  /// **'Alhamak,bostan Aldoor'**
  String get address_loc;

  /// No description provided for @description.
  ///
  /// In en, this message translates to:
  /// **'Description'**
  String get description;

  /// No description provided for @describe_property.
  ///
  /// In en, this message translates to:
  /// **'Describe your property details...'**
  String get describe_property;

  /// No description provided for @save.
  ///
  /// In en, this message translates to:
  /// **'Save'**
  String get save;

  /// No description provided for @verified_host.
  ///
  /// In en, this message translates to:
  /// **'Verified Host'**
  String get verified_host;

  /// No description provided for @owner.
  ///
  /// In en, this message translates to:
  /// **'Owner'**
  String get owner;

  /// No description provided for @rooms.
  ///
  /// In en, this message translates to:
  /// **'Rooms'**
  String get rooms;

  /// No description provided for @reviews.
  ///
  /// In en, this message translates to:
  /// **'Reviews'**
  String get reviews;

  /// No description provided for @review.
  ///
  /// In en, this message translates to:
  /// **'Review'**
  String get review;

  /// No description provided for @view_all.
  ///
  /// In en, this message translates to:
  /// **'View All'**
  String get view_all;

  /// No description provided for @per_month.
  ///
  /// In en, this message translates to:
  /// **'per month'**
  String get per_month;

  /// No description provided for @book_now.
  ///
  /// In en, this message translates to:
  /// **'Book Now'**
  String get book_now;

  /// No description provided for @month.
  ///
  /// In en, this message translates to:
  /// **'month'**
  String get month;

  /// No description provided for @new_.
  ///
  /// In en, this message translates to:
  /// **'New'**
  String get new_;

  /// No description provided for @network_error_message.
  ///
  /// In en, this message translates to:
  /// **'Network error occurred. Please check your internet connection and try again.'**
  String get network_error_message;

  /// No description provided for @request_cancelled_error_message.
  ///
  /// In en, this message translates to:
  /// **'Request was cancelled'**
  String get request_cancelled_error_message;

  /// No description provided for @unexpected_error_message.
  ///
  /// In en, this message translates to:
  /// **'Unexpected error occurred'**
  String get unexpected_error_message;

  /// No description provided for @retry.
  ///
  /// In en, this message translates to:
  /// **'Retry'**
  String get retry;

  /// No description provided for @warring.
  ///
  /// In en, this message translates to:
  /// **'warring'**
  String get warring;

  /// No description provided for @edit_profile.
  ///
  /// In en, this message translates to:
  /// **'Edit Profile'**
  String get edit_profile;

  /// No description provided for @identity_verification.
  ///
  /// In en, this message translates to:
  /// **'Identity verification'**
  String get identity_verification;

  /// No description provided for @identity_verification_input.
  ///
  /// In en, this message translates to:
  /// **'Please enter your password to confirm identity'**
  String get identity_verification_input;

  /// No description provided for @current_password.
  ///
  /// In en, this message translates to:
  /// **'Current password'**
  String get current_password;

  /// No description provided for @cancel.
  ///
  /// In en, this message translates to:
  /// **'Cancel'**
  String get cancel;

  /// No description provided for @incorrect_password.
  ///
  /// In en, this message translates to:
  /// **'Incorrect Password'**
  String get incorrect_password;

  /// No description provided for @verify.
  ///
  /// In en, this message translates to:
  /// **'verification'**
  String get verify;

  /// No description provided for @profile_updated_success.
  ///
  /// In en, this message translates to:
  /// **'Profile Updated & Cached Successfully'**
  String get profile_updated_success;
}

class _AppLocalizationsDelegate
    extends LocalizationsDelegate<AppLocalizations> {
  const _AppLocalizationsDelegate();

  @override
  Future<AppLocalizations> load(Locale locale) {
    return SynchronousFuture<AppLocalizations>(lookupAppLocalizations(locale));
  }

  @override
  bool isSupported(Locale locale) =>
      <String>['ar', 'en', 'fr', 'ru', 'tr'].contains(locale.languageCode);

  @override
  bool shouldReload(_AppLocalizationsDelegate old) => false;
}

AppLocalizations lookupAppLocalizations(Locale locale) {
  // Lookup logic when only language code is specified.
  switch (locale.languageCode) {
    case 'ar':
      return AppLocalizationsAr();
    case 'en':
      return AppLocalizationsEn();
    case 'fr':
      return AppLocalizationsFr();
    case 'ru':
      return AppLocalizationsRu();
    case 'tr':
      return AppLocalizationsTr();
  }

  throw FlutterError(
      'AppLocalizations.delegate failed to load unsupported locale "$locale". This is likely '
      'an issue with the localizations generation tool. Please file an issue '
      'on GitHub with a reproducible sample app and the gen-l10n configuration '
      'that was used.');
}

// =======================================================
// FILE PATH: lib\l10n\app_localizations_ar.dart
// =======================================================

// ignore: unused_import
import 'package:intl/intl.dart' as intl;
import 'app_localizations.dart';

// ignore_for_file: type=lint

/// The translations for Arabic (`ar`).
class AppLocalizationsAr extends AppLocalizations {
  AppLocalizationsAr([String locale = 'ar']) : super(locale);

  @override
  String get welcome_back => 'مرحباً بعودتك';

  @override
  String get login_to_continue => 'سجل الدخول للمتابعة في البحث';

  @override
  String get mobile_number => 'رقم الهاتف';

  @override
  String get send_verification_code => 'إرسال رمز التحقق';

  @override
  String get login => 'تسجيل الدخول';

  @override
  String get logout => 'تسجيل الخروج';

  @override
  String get dont_have_account => 'ليس لديك حساب؟';

  @override
  String get my_bookings => 'حجوزاتي';

  @override
  String get bookings => 'الحجوزات';

  @override
  String get my_favorites => 'مفضلاتي';

  @override
  String get favorites => 'المفضلة';

  @override
  String get chats => 'المحادثات';

  @override
  String get select_theme => 'اختر المظهر';

  @override
  String get select_language => 'اختر اللغة';

  @override
  String get messages => 'الرسائل';

  @override
  String get register => 'تسجيل';

  @override
  String get home => 'الرئيسية';

  @override
  String get settings => 'الإعدادات';

  @override
  String get theme => 'المظهر';

  @override
  String get my_profile => 'ملفي الشخصي';

  @override
  String get become_a_renter => 'كن مؤجراً';

  @override
  String get language => 'اللغة';

  @override
  String get first_name => 'الاسم الأول';

  @override
  String get last_name => 'الاسم الأخير';

  @override
  String get have_account => 'هل لديك حساب بالفعل؟';

  @override
  String get create_account => 'إنشاء حساب';

  @override
  String get join_to_find => 'انضم إلينا للعثور على شقتك المثالية!';

  @override
  String get password => 'كلمة المرور';

  @override
  String get confirm_password => 'تأكيد كلمة المرور';

  @override
  String get id_document_message => 'يرجى رفع صورة لبطاقة هويتك لأغراض أمنية:';

  @override
  String get upload_id_message => 'اضغط لرفع وثيقة الهوية';

  @override
  String get png_jpg => 'PNG, JPG, PDF بحد أقصى 10 ميجابايت';

  @override
  String get profile_image_message =>
      'اختر صورة تناسبك!\nإذا كنت بحاجة لذلك..\n\nستظهر صورة ملفك الشخصي عندما تراسل مالك شقتك المستقبلي!';

  @override
  String get next => 'التالي';

  @override
  String get previous => 'السابق';

  @override
  String get send_code => 'إرسال رمز التحقق';

  @override
  String get date_of_birth => 'تاريخ الميلاد';

  @override
  String get six_digits => 'يرجى إداخل رمز PIN المكون من 6 أرقام';

  @override
  String get field_required => 'هذا الحقل مطلوب';

  @override
  String get image_required => 'هذه الصورة مطلوبة';

  @override
  String get malaz => 'ملاذ';

  @override
  String get share_your_property => 'شارك تفاصيل عقارك معنا';

  @override
  String get add_property => 'إضافة عقار';

  @override
  String get uploud_photo_property => 'اضغط لرفع صور عقارك';

  @override
  String get essential_details => 'التفاصيل الأساسية';

  @override
  String get bedrooms => 'غرف النوم:';

  @override
  String get bathrooms => 'الحمامات:';

  @override
  String get bathrooms_no_dots => 'الحمامات';

  @override
  String get area => 'المساحة:';

  @override
  String get price => 'السعر';

  @override
  String get property_type => 'نوع العقار';

  @override
  String get apartment => 'شقة';

  @override
  String get villa => 'فيلا';

  @override
  String get house => 'منزل';

  @override
  String get farm => 'مزرعة';

  @override
  String get country_house => 'بيت ريفي';

  @override
  String get location_details => 'تفاصيل الموقع';

  @override
  String get city => 'المدينة:';

  @override
  String get syria => 'سوريا';

  @override
  String get governorate => 'المحافظة:';

  @override
  String get damascus => 'دمشق';

  @override
  String get address => 'العنوان:';

  @override
  String get address_loc => 'الهمك، بستان الدور';

  @override
  String get description => 'الوصف';

  @override
  String get describe_property => 'صف تفاصيل عقارك...';

  @override
  String get save => 'حفظ';

  @override
  String get verified_host => 'مضيف موثق';

  @override
  String get owner => 'المالك';

  @override
  String get rooms => 'الغرف';

  @override
  String get reviews => 'التقييمات';

  @override
  String get review => 'تقييم';

  @override
  String get view_all => 'عرض الكل';

  @override
  String get per_month => 'شهرياً';

  @override
  String get book_now => 'احجز الآن';

  @override
  String get month => 'شهر';

  @override
  String get new_ => 'جديد';

  @override
  String get network_error_message =>
      'حدث خطأ في الشبكة. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.';

  @override
  String get request_cancelled_error_message => 'تم إلغاء الطلب';

  @override
  String get unexpected_error_message => 'حدث خطأ غير متوقع';

  @override
  String get retry => 'إعادة المحاولة';

  @override
  String get warring => 'تنبيه';

  @override
  String get edit_profile => 'تعديل الحساب';

  @override
  String get identity_verification => 'التحقق من الهوية';

  @override
  String get identity_verification_input =>
      'يرجى إدخال كلمة المرور الخاصة بك لتأكيد هويتك';

  @override
  String get current_password => 'كلمة المرور الحالية';

  @override
  String get cancel => 'إلغاء';

  @override
  String get incorrect_password => 'كلمة المرور غير صحيحة';

  @override
  String get verify => 'تحقق';

  @override
  String get profile_updated_success => 'تم تحديث الملف الشخصي وحفظه بنجاح';
}

// =======================================================
// FILE PATH: lib\l10n\app_localizations_en.dart
// =======================================================

// ignore: unused_import
import 'package:intl/intl.dart' as intl;
import 'app_localizations.dart';

// ignore_for_file: type=lint

/// The translations for English (`en`).
class AppLocalizationsEn extends AppLocalizations {
  AppLocalizationsEn([String locale = 'en']) : super(locale);

  @override
  String get welcome_back => 'Welcome Back';

  @override
  String get login_to_continue => 'Login to continue your search';

  @override
  String get mobile_number => 'Mobile Number';

  @override
  String get send_verification_code => 'Send verification code';

  @override
  String get login => 'Login';

  @override
  String get logout => 'Logout';

  @override
  String get dont_have_account => 'Don\'t have an account?';

  @override
  String get my_bookings => 'My Bookings';

  @override
  String get bookings => 'bookings';

  @override
  String get my_favorites => 'My Favorites';

  @override
  String get favorites => 'favorites';

  @override
  String get chats => 'chats';

  @override
  String get select_theme => 'select theme';

  @override
  String get select_language => 'select language';

  @override
  String get messages => 'Messages';

  @override
  String get register => 'Register';

  @override
  String get home => 'Home';

  @override
  String get settings => 'Settings';

  @override
  String get theme => 'Theme';

  @override
  String get my_profile => 'My Profile';

  @override
  String get become_a_renter => 'Become a Renter';

  @override
  String get language => 'Language';

  @override
  String get first_name => 'First Name';

  @override
  String get last_name => 'Last Name';

  @override
  String get have_account => 'Do you already have an account ? ';

  @override
  String get create_account => 'Create Account';

  @override
  String get join_to_find => 'Join us to find your perfect apartment !';

  @override
  String get password => 'Password';

  @override
  String get confirm_password => 'Confirm Password';

  @override
  String get id_document_message =>
      'Please upload a photo of your ID document for security purposes:';

  @override
  String get upload_id_message => 'Click to upload ID document';

  @override
  String get png_jpg => 'PNG, JPG, PDF up to 10MB';

  @override
  String get profile_image_message =>
      'Choose a picture that suits you!\nIf you need that..\n\nyour profile picture will appear when you message your future apartment owner!';

  @override
  String get next => 'Next';

  @override
  String get previous => 'Previous';

  @override
  String get send_code => 'Send verification code';

  @override
  String get date_of_birth => 'Date Of Birth';

  @override
  String get six_digits => 'Please enter a 6-digit PIN code';

  @override
  String get field_required => 'This field is required';

  @override
  String get image_required => 'This image is required';

  @override
  String get malaz => 'MALAZ';

  @override
  String get share_your_property => 'Share your property details with us';

  @override
  String get add_property => 'Add property';

  @override
  String get uploud_photo_property => 'Click to upload photos of your property';

  @override
  String get essential_details => 'Essential Details';

  @override
  String get bedrooms => 'Bedrooms:';

  @override
  String get bathrooms => 'Bathrooms:';

  @override
  String get bathrooms_no_dots => 'Bathrooms';

  @override
  String get area => 'Area:';

  @override
  String get price => 'Price';

  @override
  String get property_type => 'Property Type';

  @override
  String get apartment => 'Apartment';

  @override
  String get villa => 'Villa';

  @override
  String get house => 'House';

  @override
  String get farm => 'Farm';

  @override
  String get country_house => 'Country House';

  @override
  String get location_details => 'Location Details';

  @override
  String get city => 'City:';

  @override
  String get syria => 'Syria';

  @override
  String get governorate => 'Governorate:';

  @override
  String get damascus => 'Damascus';

  @override
  String get address => 'Address:';

  @override
  String get address_loc => 'Alhamak,bostan Aldoor';

  @override
  String get description => 'Description';

  @override
  String get describe_property => 'Describe your property details...';

  @override
  String get save => 'Save';

  @override
  String get verified_host => 'Verified Host';

  @override
  String get owner => 'Owner';

  @override
  String get rooms => 'Rooms';

  @override
  String get reviews => 'Reviews';

  @override
  String get review => 'Review';

  @override
  String get view_all => 'View All';

  @override
  String get per_month => 'per month';

  @override
  String get book_now => 'Book Now';

  @override
  String get month => 'month';

  @override
  String get new_ => 'New';

  @override
  String get network_error_message =>
      'Network error occurred. Please check your internet connection and try again.';

  @override
  String get request_cancelled_error_message => 'Request was cancelled';

  @override
  String get unexpected_error_message => 'Unexpected error occurred';

  @override
  String get retry => 'Retry';

  @override
  String get warring => 'warring';

  @override
  String get edit_profile => 'Edit Profile';

  @override
  String get identity_verification => 'Identity verification';

  @override
  String get identity_verification_input =>
      'Please enter your password to confirm identity';

  @override
  String get current_password => 'Current password';

  @override
  String get cancel => 'Cancel';

  @override
  String get incorrect_password => 'Incorrect Password';

  @override
  String get verify => 'verification';

  @override
  String get profile_updated_success => 'Profile Updated & Cached Successfully';
}

// =======================================================
// FILE PATH: lib\l10n\app_localizations_fr.dart
// =======================================================

// ignore: unused_import
import 'package:intl/intl.dart' as intl;
import 'app_localizations.dart';

// ignore_for_file: type=lint

/// The translations for French (`fr`).
class AppLocalizationsFr extends AppLocalizations {
  AppLocalizationsFr([String locale = 'fr']) : super(locale);

  @override
  String get welcome_back => 'Bon retour';

  @override
  String get login_to_continue =>
      'Connectez-vous pour continuer votre recherche';

  @override
  String get mobile_number => 'Numéro de mobile';

  @override
  String get send_verification_code => 'Envoyer le code de vérification';

  @override
  String get login => 'Connexion';

  @override
  String get logout => 'Déconnexion';

  @override
  String get dont_have_account => 'Vous n\'avez pas de compte ?';

  @override
  String get my_bookings => 'Mes réservations';

  @override
  String get bookings => 'réservations';

  @override
  String get my_favorites => 'Mes favoris';

  @override
  String get favorites => 'favoris';

  @override
  String get chats => 'discussions';

  @override
  String get select_theme => 'choisir le thème';

  @override
  String get select_language => 'choisir la langue';

  @override
  String get messages => 'Messages';

  @override
  String get register => 'S\'inscrire';

  @override
  String get home => 'Accueil';

  @override
  String get settings => 'Paramètres';

  @override
  String get theme => 'Thème';

  @override
  String get my_profile => 'Mon profil';

  @override
  String get become_a_renter => 'Devenir hôte';

  @override
  String get language => 'Langue';

  @override
  String get first_name => 'Prénom';

  @override
  String get last_name => 'Nom';

  @override
  String get have_account => 'Avez-vous déjà un compte ?';

  @override
  String get create_account => 'Créer un compte';

  @override
  String get join_to_find =>
      'Rejoignez-nous pour trouver l\'appartement idéal !';

  @override
  String get password => 'Mot de passe';

  @override
  String get confirm_password => 'Confirmer le mot de passe';

  @override
  String get id_document_message =>
      'Veuillez télécharger une photo de votre pièce d\'identité pour des raisons de sécurité :';

  @override
  String get upload_id_message =>
      'Cliquez pour télécharger la pièce d\'identité';

  @override
  String get png_jpg => 'PNG, JPG, PDF jusqu\'à 10 Mo';

  @override
  String get profile_image_message =>
      'Choisissez une photo qui vous correspond !\nSi besoin..\n\nvotre photo de profil apparaîtra lorsque vous enverrez un message au futur propriétaire !';

  @override
  String get next => 'Suivant';

  @override
  String get previous => 'Précédent';

  @override
  String get send_code => 'Envoyer le code de vérification';

  @override
  String get date_of_birth => 'Date de naissance';

  @override
  String get six_digits => 'Veuillez saisir un code PIN à 6 chiffres';

  @override
  String get field_required => 'Ce champ est obligatoire';

  @override
  String get image_required => 'Cette image est obligatoire';

  @override
  String get malaz => 'MALAZ';

  @override
  String get share_your_property =>
      'Partagez les détails de votre bien avec nous';

  @override
  String get add_property => 'Ajouter un bien';

  @override
  String get uploud_photo_property =>
      'Cliquez pour télécharger des photos de votre bien';

  @override
  String get essential_details => 'Détails essentiels';

  @override
  String get bedrooms => 'Chambres :';

  @override
  String get bathrooms => 'Salles de bain :';

  @override
  String get bathrooms_no_dots => 'Salles de bain';

  @override
  String get area => 'Surface :';

  @override
  String get price => 'Prix';

  @override
  String get property_type => 'Type de bien';

  @override
  String get apartment => 'Appartement';

  @override
  String get villa => 'Villa';

  @override
  String get house => 'Maison';

  @override
  String get farm => 'Ferme';

  @override
  String get country_house => 'Maison de campagne';

  @override
  String get location_details => 'Détails de l\'emplacement';

  @override
  String get city => 'Ville :';

  @override
  String get syria => 'Syrie';

  @override
  String get governorate => 'Gouvernorat :';

  @override
  String get damascus => 'Damas';

  @override
  String get address => 'Adresse :';

  @override
  String get address_loc => 'Alhamak, Bostan Aldoor';

  @override
  String get description => 'Description';

  @override
  String get describe_property => 'Décrivez les détails de votre bien...';

  @override
  String get save => 'Enregistrer';

  @override
  String get verified_host => 'Hôte vérifié';

  @override
  String get owner => 'Propriétaire';

  @override
  String get rooms => 'Pièces';

  @override
  String get reviews => 'Avis';

  @override
  String get review => 'Avis';

  @override
  String get view_all => 'Tout voir';

  @override
  String get per_month => 'par mois';

  @override
  String get book_now => 'Réserver';

  @override
  String get month => 'mois';

  @override
  String get new_ => 'Nouveau';

  @override
  String get network_error_message =>
      'Une erreur réseau est survenue. Veuillez vérifier votre connexion internet et réessayer.';

  @override
  String get request_cancelled_error_message => 'La demande a été annulée';

  @override
  String get unexpected_error_message =>
      'Une erreur inattendue s\'est produite';

  @override
  String get retry => 'Réessayer';

  @override
  String get warring => 'Avertissement';

  @override
  String get edit_profile => 'Modifier le profil';

  @override
  String get identity_verification => 'Vérification d\'identité';

  @override
  String get identity_verification_input =>
      'Veuillez saisir votre mot de passe pour confirmer votre identité';

  @override
  String get current_password => 'Mot de passe actuel';

  @override
  String get cancel => 'Annuler';

  @override
  String get incorrect_password => 'Mot de passe incorrect';

  @override
  String get verify => 'vérification';

  @override
  String get profile_updated_success =>
      'Profil mis à jour et en cache avec succès';
}

// =======================================================
// FILE PATH: lib\l10n\app_localizations_ru.dart
// =======================================================

// ignore: unused_import
import 'package:intl/intl.dart' as intl;
import 'app_localizations.dart';

// ignore_for_file: type=lint

/// The translations for Russian (`ru`).
class AppLocalizationsRu extends AppLocalizations {
  AppLocalizationsRu([String locale = 'ru']) : super(locale);

  @override
  String get welcome_back => 'С возвращением';

  @override
  String get login_to_continue => 'Войдите, чтобы продолжить поиск';

  @override
  String get mobile_number => 'Номер телефона';

  @override
  String get send_verification_code => 'Отправить код подтверждения';

  @override
  String get login => 'Войти';

  @override
  String get logout => 'Выйти';

  @override
  String get dont_have_account => 'Нет аккаунта?';

  @override
  String get my_bookings => 'Мои бронирования';

  @override
  String get bookings => 'бронирования';

  @override
  String get my_favorites => 'Избранное';

  @override
  String get favorites => 'избранное';

  @override
  String get chats => 'чаты';

  @override
  String get select_theme => 'выберите тему';

  @override
  String get select_language => 'выберите язык';

  @override
  String get messages => 'Сообщения';

  @override
  String get register => 'Регистрация';

  @override
  String get home => 'Главная';

  @override
  String get settings => 'Настройки';

  @override
  String get theme => 'Тема';

  @override
  String get my_profile => 'Мой профиль';

  @override
  String get become_a_renter => 'Стать арендодателем';

  @override
  String get language => 'Язык';

  @override
  String get first_name => 'Имя';

  @override
  String get last_name => 'Фамилия';

  @override
  String get have_account => 'У вас уже есть аккаунт?';

  @override
  String get create_account => 'Создать аккаунт';

  @override
  String get join_to_find =>
      'Присоединяйтесь к нам, чтобы найти идеальную квартиру!';

  @override
  String get password => 'Пароль';

  @override
  String get confirm_password => 'Подтвердите пароль';

  @override
  String get id_document_message =>
      'Пожалуйста, загрузите фото вашего удостоверения личности в целях безопасности:';

  @override
  String get upload_id_message => 'Нажмите, чтобы загрузить документ';

  @override
  String get png_jpg => 'PNG, JPG, PDF до 10 МБ';

  @override
  String get profile_image_message =>
      'Выберите подходящее фото!\nЕсли нужно..\n\nваше фото профиля будет видно владельцу квартиры, когда вы напишете ему сообщение!';

  @override
  String get next => 'Далее';

  @override
  String get previous => 'Назад';

  @override
  String get send_code => 'Отправить код подтверждения';

  @override
  String get date_of_birth => 'Дата рождения';

  @override
  String get six_digits => 'Пожалуйста, введите 6-значный PIN-код';

  @override
  String get field_required => 'Это поле обязательно';

  @override
  String get image_required => 'Это изображение обязательно';

  @override
  String get malaz => 'Малаз';

  @override
  String get share_your_property => 'Поделитесь с нами деталями вашего объекта';

  @override
  String get add_property => 'Добавить объект';

  @override
  String get uploud_photo_property => 'Нажмите, чтобы загрузить фото объекта';

  @override
  String get essential_details => 'Основные детали';

  @override
  String get bedrooms => 'Спальни:';

  @override
  String get bathrooms => 'Ванные:';

  @override
  String get bathrooms_no_dots => 'Ванные';

  @override
  String get area => 'Площадь:';

  @override
  String get price => 'Цена';

  @override
  String get property_type => 'Тип недвижимости';

  @override
  String get apartment => 'Квартира';

  @override
  String get villa => 'Вилла';

  @override
  String get house => 'Дом';

  @override
  String get farm => 'Ферма';

  @override
  String get country_house => 'Загородный дом';

  @override
  String get location_details => 'Детали местоположения';

  @override
  String get city => 'Город:';

  @override
  String get syria => 'Сирия';

  @override
  String get governorate => 'Провинция:';

  @override
  String get damascus => 'Дамаск';

  @override
  String get address => 'Адрес:';

  @override
  String get address_loc => 'Аль-Хамак, Бостан Аль-Дур';

  @override
  String get description => 'Описание';

  @override
  String get describe_property => 'Опишите детали вашего объекта...';

  @override
  String get save => 'Сохранить';

  @override
  String get verified_host => 'Проверенный хозяин';

  @override
  String get owner => 'Владелец';

  @override
  String get rooms => 'Комнаты';

  @override
  String get reviews => 'Отзывы';

  @override
  String get review => 'Отзыв';

  @override
  String get view_all => 'Посмотреть все';

  @override
  String get per_month => 'в месяц';

  @override
  String get book_now => 'Забронировать';

  @override
  String get month => 'месяц';

  @override
  String get new_ => 'Новое';

  @override
  String get network_error_message =>
      'Произошла ошибка сети. Пожалуйста, проверьте подключение к интернету и попробуйте еще раз.';

  @override
  String get request_cancelled_error_message => 'Запрос был отменен';

  @override
  String get unexpected_error_message => 'Произошла непредвиденная ошибка';

  @override
  String get retry => 'Повторить';

  @override
  String get warring => 'Предупреждение';

  @override
  String get edit_profile => 'Редактировать профиль';

  @override
  String get identity_verification => 'проверка личности';

  @override
  String get identity_verification_input =>
      'Пожалуйста, введите свой пароль для подтверждения личности';

  @override
  String get current_password => 'Текущий пароль';

  @override
  String get cancel => 'Oтмена';

  @override
  String get incorrect_password => 'Неверный пароль';

  @override
  String get verify => 'проверка';

  @override
  String get profile_updated_success => 'Профиль успешно обновлен и кэширован';
}

// =======================================================
// FILE PATH: lib\l10n\app_localizations_tr.dart
// =======================================================

// ignore: unused_import
import 'package:intl/intl.dart' as intl;
import 'app_localizations.dart';

// ignore_for_file: type=lint

/// The translations for Turkish (`tr`).
class AppLocalizationsTr extends AppLocalizations {
  AppLocalizationsTr([String locale = 'tr']) : super(locale);

  @override
  String get welcome_back => 'Tekrar Hoş Geldiniz';

  @override
  String get login_to_continue => 'Aramanıza devam etmek için giriş yapın';

  @override
  String get mobile_number => 'Cep Telefonu Numarası';

  @override
  String get send_verification_code => 'Doğrulama kodunu gönder';

  @override
  String get login => 'Giriş Yap';

  @override
  String get logout => 'Çıkış Yap';

  @override
  String get dont_have_account => 'Hesabınız yok mu?';

  @override
  String get my_bookings => 'Rezervasyonlarım';

  @override
  String get bookings => 'rezervasyonlar';

  @override
  String get my_favorites => 'Favorilerim';

  @override
  String get favorites => 'favoriler';

  @override
  String get chats => 'sohbetler';

  @override
  String get select_theme => 'tema seç';

  @override
  String get select_language => 'dil seç';

  @override
  String get messages => 'Mesajlar';

  @override
  String get register => 'Kayıt Ol';

  @override
  String get home => 'Anasayfa';

  @override
  String get settings => 'Ayarlar';

  @override
  String get theme => 'Tema';

  @override
  String get my_profile => 'Profilim';

  @override
  String get become_a_renter => 'Ev Sahibi Olun';

  @override
  String get language => 'Dil';

  @override
  String get first_name => 'Ad';

  @override
  String get last_name => 'Soyad';

  @override
  String get have_account => 'Zaten bir hesabınız var mı?';

  @override
  String get create_account => 'Hesap Oluştur';

  @override
  String get join_to_find => 'Hayalinizdeki daireyi bulmak için bize katılın!';

  @override
  String get password => 'Şifre';

  @override
  String get confirm_password => 'Şifreyi Onayla';

  @override
  String get id_document_message =>
      'Güvenlik nedeniyle lütfen kimlik belgenizin bir fotoğrafını yükleyin:';

  @override
  String get upload_id_message => 'Kimlik belgesi yüklemek için tıklayın';

  @override
  String get png_jpg => 'PNG, JPG, PDF en fazla 10MB';

  @override
  String get profile_image_message =>
      'Sizi yansıtan bir resim seçin!\nBuna ihtiyacınız varsa..\n\nprofil resminiz gelecekteki daire sahibine mesaj attığınızda görünecektir!';

  @override
  String get next => 'İleri';

  @override
  String get previous => 'Geri';

  @override
  String get send_code => 'Doğrulama kodunu gönder';

  @override
  String get date_of_birth => 'Doğum Tarihi';

  @override
  String get six_digits => 'Lütfen 6 haneli PIN kodunu girin';

  @override
  String get field_required => 'Bu alan zorunludur';

  @override
  String get image_required => 'Bu resim zorunludur';

  @override
  String get malaz => 'MALAZ';

  @override
  String get share_your_property => 'Mülk detaylarınızı bizimle paylaşın';

  @override
  String get add_property => 'Mülk Ekle';

  @override
  String get uploud_photo_property =>
      'Mülkünüzün fotoğraflarını yüklemek için tıklayın';

  @override
  String get essential_details => 'Temel Detaylar';

  @override
  String get bedrooms => 'Yatak Odası:';

  @override
  String get bathrooms => 'Banyo:';

  @override
  String get bathrooms_no_dots => 'Banyo';

  @override
  String get area => 'Alan:';

  @override
  String get price => 'Fiyat';

  @override
  String get property_type => 'Mülk Tipi';

  @override
  String get apartment => 'Daire';

  @override
  String get villa => 'Villa';

  @override
  String get house => 'Ev';

  @override
  String get farm => 'Çiftlik';

  @override
  String get country_house => 'Kır Evi';

  @override
  String get location_details => 'Konum Detayları';

  @override
  String get city => 'Şehir:';

  @override
  String get syria => 'Suriye';

  @override
  String get governorate => 'İl:';

  @override
  String get damascus => 'Şam';

  @override
  String get address => 'Adres:';

  @override
  String get address_loc => 'Alhamak, Bostan Aldoor';

  @override
  String get description => 'Açıklama';

  @override
  String get describe_property => 'Mülkünüzün detaylarını açıklayın...';

  @override
  String get save => 'Kaydet';

  @override
  String get verified_host => 'Doğrulanmış Ev Sahibi';

  @override
  String get owner => 'Mülk Sahibi';

  @override
  String get rooms => 'Odalar';

  @override
  String get reviews => 'Değerlendirmeler';

  @override
  String get review => 'Değerlendirme';

  @override
  String get view_all => 'Hepsini Gör';

  @override
  String get per_month => 'aylık';

  @override
  String get book_now => 'Hemen Ayırt';

  @override
  String get month => 'ay';

  @override
  String get new_ => 'Yeni';

  @override
  String get network_error_message =>
      'Ağ hatası oluştu. Lütfen internet bağlantınızı kontrol edin ve tekrar deneyin.';

  @override
  String get request_cancelled_error_message => 'İstek iptal edildi';

  @override
  String get unexpected_error_message => 'Beklenmedik bir hata oluştu';

  @override
  String get retry => 'Tekrar dene';

  @override
  String get warring => 'Uyarı';

  @override
  String get edit_profile => 'Profil Düzenle';

  @override
  String get identity_verification => 'kimlik doğrulama';

  @override
  String get identity_verification_input =>
      'Kimliğinizi doğrulamak için lütfen şifrenizi girin';

  @override
  String get current_password => 'Mevcut Şifre';

  @override
  String get cancel => 'Iptal';

  @override
  String get incorrect_password => 'Yanlış Şifre';

  @override
  String get verify => 'doğrulama';

  @override
  String get profile_updated_success =>
      'Profil başarıyla güncellendi ve önbelleğe alındı';
}

// =======================================================
// FILE PATH: lib\main.dart
// =======================================================

// main.dart
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:flutter_localizations/flutter_localizations.dart';
import 'package:malaz/presentation/cubits/auth/auth_cubit.dart';

import 'package:malaz/presentation/cubits/home/home_cubit.dart';
import 'package:malaz/presentation/cubits/language/language_cubit.dart';
import 'package:malaz/presentation/cubits/theme/theme_cubit.dart';

import 'package:malaz/presentation/screens/auth/login/login_screen.dart';
import 'package:malaz/presentation/screens/auth/register/home_register_screen.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen1.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen2.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen3.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen4.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen5.dart';
import 'package:malaz/presentation/screens/settings/settings_screen.dart';
import 'package:malaz/presentation/screens/splash_screen/splash_screen.dart';

import 'core/config/routes/app_routes.dart';
import 'core/config/theme/app_theme.dart';

import 'core/service_locator/service_locator.dart';
import 'l10n/app_localizations.dart';


/// [main]
///
/// - `WidgetsFlutterBinding.ensureInitialized():` Ensures that the Flutter framework is initialized.
///   This is required before calling native Flutter functions (like [runApp]).
///
/// - `await setUpServices()`: Calls an asynchronous function to set up and initialize
///   the application's services, such as dependency injection using [get_it].
///
/// - `runApp(const RentalApp())`: Starts the application by displaying the root widget [RentalApp].
///
/// [RentalApp] is a StatelessWidget that serves as the application's root.
///
/// - [MultiBlocProvider]: Provides multiple BLoC states to the widget tree.
///   This allows descendant widgets to access [ThemeCubit], [LanguageCubit], and [HomeCubit].
///   Each Cubit is created using `sl<T>()`, which fetches the registered service instance
///   from the service locator.
///
/// - `child: const RentalAppView()`: Renders [RentalAppView] as its child widget.
///
/// [RentalAppView] is a StatelessWidget that builds the main UI of the app.
///
/// - `context.watch<ThemeCubit>().state` & `context.watch<LanguageCubit>().state`:
///   These lines listen for changes in [ThemeCubit] and [LanguageCubit].
///   When the state of either cubit changes, Flutter rebuilds this widget.
///
/// - [MaterialApp]: The main widget that wraps a number of widgets required for
///   Material Design applications.
///   - [title]: The app title used by the operating system.
///   - [debugShowCheckedModeBanner]: Hides the "Debug" banner in the top-right corner.
///   - [theme] & [darkTheme]: Define the light and dark themes for the app.
///   - [themeMode]: Controls which theme to use (light, dark, or system) based on the [ThemeCubit]'s state.
///   - [locale]: Sets the app's current language based on the [LanguageCubit]'s state.
///   - [supportedLocales]: A list of languages supported by the app.
///   - [localizationsDelegates]: Provides translations and localized content for the app.
///   - [localeResolutionCallback]: Logic to determine the best supported locale based on the device's locale.
///   - [routes]: Defines the named navigation routes in the app, allowing navigation to screens
///     like [LoginScreen], [HomeRegisterScreen], and [SettingsScreen].
///   - [home]: The widget displayed when the app starts, which is [SplashScreen] here.
///
Future<void> main() async {
  WidgetsFlutterBinding.ensureInitialized();

  await setUpServices();

  runApp(const RentalApp());
}

class RentalApp extends StatelessWidget {
  const RentalApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MultiBlocProvider(
      providers: [
        BlocProvider(create: (context) => sl<ThemeCubit>()),
        BlocProvider(create: (context) => sl<LanguageCubit>()),
        BlocProvider(create: (context) => sl<HomeCubit>()),
        BlocProvider.value(value: sl<AuthCubit>()),
        //BlocProvider(create: (context) => sl<AuthCubit>()),// ..checkAuth()
      ],
      child: const RentalAppView(),
    );
  }
}

class RentalAppView extends StatelessWidget {
  const RentalAppView({super.key});

  @override
  Widget build(BuildContext context) {
    final themeState = context.watch<ThemeCubit>().state;
    final languageState = context.watch<LanguageCubit>().state;
    final authCubit = context.read<AuthCubit>();

    final router = buildAppRouter(); // build router with authCubit

    return MaterialApp.router(
      title: 'Malaz Rental',
      debugShowCheckedModeBanner: false,
      theme: AppTheme.lightTheme,
      darkTheme: AppTheme.darkTheme,
      themeMode: themeState.themeMode,
      locale: languageState.locale,
      supportedLocales: AppLocalizations.supportedLocales,
      localizationsDelegates: const [
        AppLocalizations.delegate,
        GlobalMaterialLocalizations.delegate,
        GlobalWidgetsLocalizations.delegate,
        GlobalCupertinoLocalizations.delegate,
      ],
      localeResolutionCallback: (locale, supportedLocales) {
        for (var supportedLocale in supportedLocales) {
          if (supportedLocale.languageCode == locale?.languageCode) {
            return supportedLocale;
          }
        }
        return supportedLocales.first;
      },
      routerConfig: router,
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\cubits\auth\auth_cubit.dart
// =======================================================

import 'package:equatable/equatable.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/domain/entities/user_entity.dart';
import 'package:malaz/domain/usecases/auth/check_auth_usecase.dart';
import 'package:malaz/domain/usecases/auth/get_current_user_usecase.dart';
import 'package:malaz/domain/usecases/auth/login_usecase.dart';
import 'package:malaz/domain/usecases/auth/logout_usecase.dart';
import '../../../core/errors/failures.dart';
import '../../../core/usecases/usecase.dart';
import '../../../domain/repositories/auth_repository.dart';
import '../../../domain/usecases/auth/register_usecase.dart';
import '../../../domain/usecases/auth/send_otp_usecase.dart';
import '../../../domain/usecases/auth/verify_otp_usecase.dart';

// --- States --- //

abstract class AuthState extends Equatable {
  @override
  List<Object?> get props => [];
}

class AuthInitial extends AuthState {}

class AuthLoading extends AuthState {}

class AuthAuthenticated extends AuthState {
  final UserEntity user;
  AuthAuthenticated(this.user);
  @override
  List<Object?> get props => [user];
}

class AuthUnauthenticated extends AuthState {}

class AuthPending extends AuthState {
  final UserEntity user;
  AuthPending(this.user);
  @override
  List<Object?> get props => [user];
}

class AuthError extends AuthState {
  final String message;
  AuthError({required this.message});
  @override
  List<Object?> get props => [message];
}

class OtpSending extends AuthState {}

class OtpSent extends AuthState {}

class OtpSendError extends AuthState {
  final String message;
  OtpSendError(this.message);
}

class OtpVerifying extends AuthState {}

class OtpVerified extends AuthState {}

class OtpVerifyError extends AuthState {
  final String message;
  OtpVerifyError(this.message);
}

// --- Cubit --- //

class AuthCubit extends Cubit<AuthState> {
  final LoginUsecase loginUsecase;
  final LogoutUsecase logoutUsecase;
  final GetCurrentUserUsecase getCurrentUserUsecase;
  final CheckAuthUsecase checkAuthUsecase;
  final RegisterUsecase registerUsecase;
  final SendOtpUsecase sendOtpUsecase;
  final VerifyOtpUsecase verifyOtpUsecase;
  final AuthRepository repository;

  AuthCubit(
      {required this.loginUsecase,
      required this.logoutUsecase,
      required this.getCurrentUserUsecase,
      required this.checkAuthUsecase,
      required this.registerUsecase,
      required this.sendOtpUsecase,
      required this.verifyOtpUsecase,
      required this.repository}) : super(AuthInitial());

  Future<void> checkAuth() async {
    final res = await checkAuthUsecase(NoParams());

    res.fold(
          (_) {
        if (state is AuthPending) return;
        emit(AuthUnauthenticated());
      },
          (status) {
        if (status.isPending && status.user != null) {
          emit(AuthPending(status.user!));
        } else if (status.isAuthenticated && status.user != null) {
          emit(AuthAuthenticated(status.user!));
        } else {
          if (state is AuthPending) return;
          emit(AuthUnauthenticated());
        }
      },
    );
  }

  Future<void> register({
    required String phone,
    required String firstName,
    required String lastName,
    required String password,
    required String dateOfBirth,
    required XFile profileImage,
    required XFile identityImage,
  }) async {
    emit(AuthLoading());

    try {
      final res = await registerUsecase(RegisterParams(
        phone: phone,
        role: 'PENDING',
        firstName: firstName,
        lastName: lastName,
        password: password,
        passwordConfirmation: password,
        dateOfBirth: dateOfBirth,
        profileImage: profileImage,
        identityCardImage: identityImage,
      ));
      print('>>>> ${res}');
      res.fold(
        (failure) {
          emit(AuthError(message: _mapFailureToMessage(failure)));
          emit(AuthUnauthenticated());
        },
        (user) {
          final role = user.role.toLowerCase();
          if (role == 'pending') {
            emit(AuthPending(user));
          } else {
            emit(AuthAuthenticated(user));
          }
        },
      );
    } catch (e) {
      emit(AuthError(message: 'Error preparing images: $e'));
      emit(AuthUnauthenticated());
    }
  }

  Future<void> login({required String phone, required String password,}) async {
    emit(AuthLoading());

    final res = await loginUsecase(
      LoginParams(phoneNumber: phone, password: password),
    );

    res.fold(
          (failure) {
        if (failure is PendingApprovalFailure) {
          emit(AuthPending(
            UserEntity.emptyPending(),
          ));
        } else if (failure is PhoneNotFoundFailure) {
          emit(AuthError(
            message: 'This phone number does not exist in our records.',
          ));
        } else if (failure is WrongPasswordFailure) {
          emit(AuthError(message: 'Invalid credentials'));
        } else {
          emit(AuthError(message: _mapFailureToMessage(failure)));
        }
      },
          (user) {
        if (user.role.toUpperCase() == 'PENDING') {
          emit(AuthPending(user));
        } else {
          emit(AuthAuthenticated(user));
        }
      },
    );
  }

  Future<void> logout() async {
    emit(AuthLoading());
    final result = await logoutUsecase(NoParams());

    result.fold(
          (failure) => emit(AuthError(message:failure.message ?? "Logout Failed")),
          (_) {
        emit(AuthUnauthenticated());
      },
    );
  }

  Future<void> sendOtp(String phone) async {
    emit(OtpSending());
    final res = await sendOtpUsecase(SendOtpParams(phone));
    res.fold(
      (failure) => emit(OtpSendError(_mapFailureToMessage(failure))),
      (_) => emit(OtpSent()),
    );
  }

  Future<void> verifyOtp(String phone, String otp) async {
    emit(OtpVerifying());
    final res = await verifyOtpUsecase(VerifyOtpParams(phone: phone, otp: otp));
    res.fold(
      (failure) => emit(OtpVerifyError(_mapFailureToMessage(failure))),
      (success) {
        if (success)
          emit(OtpVerified());
        else
          emit(OtpVerifyError('Invalid code'));
      },
    );
  }

  Future<void> checkRoleUsingLogin({required String phone, required String password}) async {
    emit(AuthLoading());

    final res = await loginUsecase(
      LoginParams(phoneNumber: phone, password: password),
    );

    res.fold(
      (failure) {
        emit(AuthError(message: _mapFailureToMessage(failure)));
      },
      (user) {
        if (user.role == 'PENDING') {
          emit(AuthPending(user));
        } else if (user.role == 'USER') {
          emit(AuthAuthenticated(user));
        } else {
          emit(AuthUnauthenticated());
        }
      },
    );
  }

  Future<bool> verifyPasswordSilently(String password) async {
    final currentState = state;
    if (currentState is AuthAuthenticated) {
      final result = await loginUsecase(LoginParams(
        phoneNumber: currentState.user.phone,
        password: password,
      ));
      return result.isRight();
    }
    return false;
  }

  Future<void> updateUserData(String firstName, String lastName, {String? imagePath}) async {

    try {
      final result = await repository.updateFullProfile(
        firstName: firstName,
        lastName: lastName,
        imagePath: imagePath,
      );

      result.fold(
            (failure) => emit(AuthError(message: failure.message ?? "Update Failed")),
            (updatedUser) {
          emit(AuthAuthenticated(updatedUser));
          repository.updateCachedUser(updatedUser);
        },
      );
    } catch (e) {
      emit(AuthError(message: e.toString()));
    }
  }

  void updateUserInformation(UserEntity updatedUser) {
    if (state is AuthAuthenticated) {
      emit(AuthAuthenticated(updatedUser));

      repository.updateCachedUser(updatedUser);
    }
  }

  String _mapFailureToMessage(Failure f) {
    if (f is PhoneNotFoundFailure)
      return 'This phone number does not exist in our records.';
    if (f is WrongPasswordFailure) return 'Incorrect Password';
    if (f is InvalidCredentialsFailure) return 'Invalid credentials';
    if (f is ServerFailure) return (f.message ?? 'Server error');
    if (f is NetworkFailure) return 'Check your internet connection';
    return 'An unexpected error occurred';
  }
}

// =======================================================
// FILE PATH: lib\presentation\cubits\home\home_cubit.dart
// =======================================================

import 'package:equatable/equatable.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:malaz/core/constants/app_constants.dart';
import '../../../../domain/entities/apartment.dart';
import '../../../core/errors/failures.dart';
import '../../../data/utils/failure_mapper.dart';
import '../../../domain/usecases/home/apartments_use_case.dart';

/// ===========================
/// ----------[states]---------
/// ===========================

abstract class HomeState extends Equatable {
  const HomeState();
  @override
  List<Object?> get props => [];
}

class HomeInitial extends HomeState {}
class HomeLoading extends HomeState {}

class HomeLoaded extends HomeState {
  final List<Apartment> apartments;
  final bool hasReachedMax;
  final bool hasReachedStart;

  const HomeLoaded({
    required this.apartments,
    this.hasReachedMax = false,
    this.hasReachedStart = true,
  });

  @override
  List<Object?> get props => [apartments, hasReachedMax, hasReachedStart];

  HomeLoaded copyWith({
    List<Apartment>? apartments,
    bool? hasReachedMax,
    bool? hasReachedStart,
  }) {
    return HomeLoaded(
      apartments: apartments ?? this.apartments,
      hasReachedMax: hasReachedMax ?? this.hasReachedMax,
      hasReachedStart: hasReachedStart ?? this.hasReachedStart,
    );
  }
}

class HomeError extends HomeState {
  final String message;
  const HomeError({required this.message});
  @override
  List<Object> get props => [message];
}

/// ===========================
/// ----------[cubit]----------
/// ===========================

class HomeCubit extends Cubit<HomeState> {
  final GetApartmentsUseCase getApartmentsUseCase;

  String? _nextCursor;
  String? _prevCursor;

  bool _isFetching = false;

  HomeCubit({required this.getApartmentsUseCase}) : super(HomeInitial());

  Future<void> loadApartments({
    bool isRefresh = false,
    bool loadNext = false,
    bool loadPrev = false,
  }) async {
    if (_isFetching) return;
    _isFetching = true;

    try {
      String? cursorToSend;
      if (isRefresh) {
        cursorToSend = null;
        emit(HomeLoading());
      } else if (loadNext) {
        cursorToSend = _nextCursor;
        if (cursorToSend == null) {
          _isFetching = false;
          return;
        }
      } else if (loadPrev) {
        cursorToSend = _prevCursor;
        if (cursorToSend == null) {
          _isFetching = false;
          return;
        }
      } else {
        if (state is! HomeLoaded) emit(HomeLoading());
        cursorToSend = null;
      }
      final result = await getApartmentsUseCase.call(cursor: cursorToSend);

      _nextCursor = result.nextCursor;
      _prevCursor = result.prevCursor;

      if (loadNext && state is HomeLoaded) {
        final currentList = (state as HomeLoaded).apartments;
        emit(HomeLoaded(
          apartments: currentList + result.apartments,
          hasReachedMax: _nextCursor == null,
          hasReachedStart: _prevCursor == null,
        ));
      } else {
        emit(HomeLoaded(
          apartments: result.apartments,
          hasReachedMax: _nextCursor == null,
          hasReachedStart: _prevCursor == null,
        ));
      }

    } catch (e) {
      final Failure failure = FailureMapper.map(e);

      String keyMessage;

      if (failure is NetworkFailure) {
        keyMessage = AppConstants.networkFailureKey;
      } else if(failure is ServerFailure) {
        keyMessage = failure.message ?? AppConstants.cancelledFailureKey;
      } else {
        keyMessage = AppConstants.unknownFailureKey;
      }

      if (!isClosed) emit(HomeError(message: keyMessage));
    } finally {
      _isFetching = false;
    }
  }
}
// =======================================================
// FILE PATH: lib\presentation\cubits\language\language_cubit.dart
// =======================================================


import 'package:equatable/equatable.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:shared_preferences/shared_preferences.dart';

/// ===========================
/// ----------[states]---------
/// ===========================

class LanguageState extends Equatable {
  final Locale locale;

  const LanguageState({this.locale = const Locale('en')});

  @override
  List<Object> get props => [locale];

  LanguageState copyWith({Locale? locale}) {
    return LanguageState(locale: locale ?? this.locale);
  }
}

/// ===========================
/// ----------[cubit]----------
/// ===========================

class LanguageCubit extends Cubit<LanguageState> {
  final SharedPreferences _prefs;
  static const String _languageKey = 'language_code';

  LanguageCubit(this._prefs) : super(const LanguageState()) {
    loadLanguage();
  }

  void loadLanguage() {
    final languageCode = _prefs.getString(_languageKey) ?? 'en'; // Default to 'en'
    emit(LanguageState(locale: Locale(languageCode)));
  }

  void updateLanguage(Locale newLocale) {
    _prefs.setString(_languageKey, newLocale.languageCode);
    emit(state.copyWith(locale: newLocale));
  }
}

// =======================================================
// FILE PATH: lib\presentation\cubits\settings\settings_cubit.dart
// =======================================================

import 'package:equatable/equatable.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:shared_preferences/shared_preferences.dart';

/// ===========================
/// ----------[states]---------
/// ===========================

/// [SettingsCubit] & [SettingsState]
/// not in work currently the whole code here is nothing but scribble
/// If you are about to fix this screen you can delete everything below
class SettingsState extends Equatable {
  final ThemeMode themeMode;
  final Locale locale;

  const SettingsState({
    this.themeMode = ThemeMode.system,
    this.locale = const Locale('en'),
  });

  @override
  List<Object> get props => [themeMode, locale];

  SettingsState copyWith({
    ThemeMode? themeMode,
    Locale? locale,
  }) {
    return SettingsState(
      themeMode: themeMode ?? this.themeMode,
      locale: locale ?? this.locale,
    );
  }
}

/// ===========================
/// ----------[cubit]----------
/// ===========================

class SettingsCubit extends Cubit<SettingsState> {
  final SharedPreferences _prefs;

  static const String _themeKey = 'theme_mode';
  static const String _languageKey = 'language_code';

  SettingsCubit(this._prefs) : super(const SettingsState()) {
    loadSettings();
  }

  void loadSettings() {
    final themeModeString = _prefs.getString(_themeKey);
    ThemeMode themeMode;
    if (themeModeString == 'light') {
      themeMode = ThemeMode.light;
    } else if (themeModeString == 'dark') {
      themeMode = ThemeMode.dark;
    } else {
      themeMode = ThemeMode.system;
    }

    final languageCode = _prefs.getString(_languageKey) ?? 'ar';

    emit(SettingsState(themeMode: themeMode, locale: Locale(languageCode)));
  }

  void updateThemeMode(ThemeMode newThemeMode) {
    _prefs.setString(_themeKey, newThemeMode.name);

    emit(state.copyWith(themeMode: newThemeMode));
  }

  void updateLanguage(Locale newLocale) {
    _prefs.setString(_languageKey, newLocale.languageCode);

    emit(state.copyWith(locale: newLocale));
  }
}

// =======================================================
// FILE PATH: lib\presentation\cubits\theme\theme_cubit.dart
// =======================================================

import 'package:equatable/equatable.dart';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:shared_preferences/shared_preferences.dart';

import '../../../core/constants/app_constants.dart';

/// ===========================
/// ----------[states]---------
/// ===========================

class ThemeState extends Equatable {
  final ThemeMode themeMode;

  const ThemeState(this.themeMode);

  @override
  List<Object> get props => [themeMode];
}

/// ===========================
/// ----------[cubit]----------
/// ===========================

class ThemeCubit extends Cubit<ThemeState> {
  final SharedPreferences _prefs;

  ThemeCubit(this._prefs) : super(const ThemeState(ThemeMode.system)) {
    _loadTheme();
  }

  void _loadTheme() {
    final savedTheme = _prefs.getString(AppConstants.themeKey);

    if (savedTheme == 'dark') {
      emit(const ThemeState(ThemeMode.dark));
    } else if (savedTheme == 'light') {
      emit(const ThemeState(ThemeMode.light));
    } else {
      emit(const ThemeState(ThemeMode.system));
    }
  }

  Future<void> changeTheme(ThemeMode mode) async {
    if (state.themeMode == mode) return;

    String modeStr = 'system';
    if (mode == ThemeMode.dark) modeStr = 'dark';
    if (mode == ThemeMode.light) modeStr = 'light';

    await _prefs.setString(AppConstants.themeKey, modeStr);
    emit(ThemeState(mode));
  }
}
// =======================================================
// FILE PATH: lib\presentation\global_widgets\apartment_card.dart
// =======================================================


import 'package:flutter/material.dart';
import '../../core/config/color/app_color.dart';
import '../../domain/entities/apartment.dart';

class ApartmentCard extends StatelessWidget {
  final Apartment apartment;
  final VoidCallback onTap;

  const ApartmentCard({Key? key, required this.apartment, required this.onTap}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    final colorScheme = theme.colorScheme;
    final isDarkMode = theme.brightness == Brightness.dark;

    return GestureDetector(
      onTap: onTap,
      child: Container(
        margin: const EdgeInsets.only(bottom: 24),
        decoration: BoxDecoration(
          color: colorScheme.surface,
          borderRadius: BorderRadius.circular(24),
          boxShadow: [
            BoxShadow(
              color: Colors.black.withOpacity(0.05),
              blurRadius: 20,
              offset: const Offset(0, 10),
            ),
          ],
        ),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [

            Hero(
              tag: apartment.id,
              child: ClipRRect(
                borderRadius: const BorderRadius.vertical(top: Radius.circular(24)),
                child: Image.network(
                  apartment.mainImageUrl,
                  height: 200,
                  width: double.infinity,
                  fit: BoxFit.cover,
                ),
              ),
            ),
            Padding(
              padding: const EdgeInsets.all(20),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    apartment.title,
                    style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold, color: colorScheme.onSurface),
                  ),
                  const SizedBox(height: 8),
                  Row(
                    children: [
                      Icon(Icons.location_on, color: colorScheme.primary, size: 16),
                      const SizedBox(width: 4),
                      Text(
                        apartment.city,
                        style: TextStyle(color: colorScheme.onSurface.withOpacity(0.6)),
                      ),
                    ],
                  ),
                  const SizedBox(height: 16),
                  // Amenities Row
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      _Amenity(icon: Icons.bed, text: '${apartment.bedrooms} Beds'),
                      _Amenity(icon: Icons.bathtub, text: '${apartment.bathrooms} Baths'),
                      _Amenity(icon: Icons.square_foot, text: '${apartment.area} sqft'),
                    ],
                  ),
                  const SizedBox(height: 16),
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      Text(
                        '\$${apartment.price.toInt()}',
                        style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold, color: colorScheme.primary),
                      ),
                      Container(
                        padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
                        decoration: BoxDecoration(
                          gradient: isDarkMode ? AppColors.premiumGoldGradient : AppColors.premiumGoldGradient,
                          borderRadius: BorderRadius.circular(12),
                        ),
                        child: const Text('View', style: TextStyle(color: Colors.white, fontWeight: FontWeight.bold)),
                      )
                    ],
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
}

class _Amenity extends StatelessWidget {
  final IconData icon;
  final String text;
  const _Amenity({required this.icon, required this.text});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return Row(
      children: [
        Icon(icon, size: 16, color: colorScheme.secondary),
        const SizedBox(width: 4),
        Text(
          text,
          style: TextStyle(
            fontSize: 12,
            fontWeight: FontWeight.bold,
            color: colorScheme.onSurface.withOpacity(0.6),
          ),
        ),
      ],
    );
  }
}


// =======================================================
// FILE PATH: lib\presentation\global_widgets\apartment_cards\apartment_card.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:malaz/l10n/app_localizations.dart';
import '../../../domain/entities/apartment.dart';

/// ============================================================================
/// [ApartmentCard]
/// A modern, high-end card widget that displays property summary.
///
/// * [Features]:
/// - Hero Animation for seamless transitions.
/// - Image Slider (Simulated using PageView).
/// - Floating Rating Badge.
/// - Clean Typography utilizing the app theme.
/// ============================================================================
class ApartmentCard extends StatelessWidget {
  final Apartment apartment;
  final VoidCallback onTap;

  const ApartmentCard({
    super.key,
    required this.apartment,
    required this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    return Container(
      margin: const EdgeInsets.only(bottom: 24),
      decoration: BoxDecoration(
        color: Theme.of(context).cardColor,
        borderRadius: BorderRadius.circular(24),
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.05),
            blurRadius: 20,
            offset: const Offset(0, 10),
          ),
        ],
      ),
      child: ClipRRect(
        borderRadius: BorderRadius.circular(24),
        child: Material(
          color: Colors.transparent,
          child: InkWell(
            onTap: onTap,
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                _BuildCardImageArea(apartment: apartment),

                _BuildCardDetails(apartment: apartment),
              ],
            ),
          ),
        ),
      ),
    );
  }
}

/// [_BuildCardImageArea]
/// Handles the top part of the card: The Image Slider and the Overlay Badges.
class _BuildCardImageArea extends StatefulWidget {
  final Apartment apartment;

  const _BuildCardImageArea({required this.apartment});

  @override
  State<_BuildCardImageArea> createState() => _BuildCardImageAreaState();
}

class _BuildCardImageAreaState extends State<_BuildCardImageArea> {
  final PageController _pageController = PageController();
  int _currentPage = 0;

  @override
  Widget build(BuildContext context) {
    final List<String> images = [
      widget.apartment.mainImageUrl,
      widget.apartment.mainImageUrl,
      widget.apartment.mainImageUrl,
    ];

    return Stack(
      children: [
        SizedBox(
          height: 400,
          width: double.infinity,
          child: Hero(
            tag: 'apartment_image_${widget.apartment.id}',
            child: PageView.builder(
              controller: _pageController,
              itemCount: images.length,
              onPageChanged: (index) {
                setState(() => _currentPage = index);
              },
              itemBuilder: (context, index) {
                return Image.network(
                  images[index],
                  fit: BoxFit.cover,
                  errorBuilder: (context, error, stackTrace) =>
                      Container(color: Colors.grey[300], child: const Icon(Icons.error)),
                );
              },
            ),
          ),
        ),

        Positioned(
          top: 16,
          left: 16,
          child: _BuildRatingBadge(rating: widget.apartment.rating),
        ),

        const Positioned(
          top: 16,
          right: 16,
          child: _BuildFavoriteIcon(),
        ),

        Positioned(
          bottom: 12,
          left: 0,
          right: 0,
          child: Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: List.generate(
              images.length,
                  (index) => AnimatedContainer(
                duration: const Duration(milliseconds: 300),
                margin: const EdgeInsets.symmetric(horizontal: 4),
                height: 6,
                width: _currentPage == index ? 20 : 6,
                decoration: BoxDecoration(
                  color: _currentPage == index ? Colors.white : Colors.white.withOpacity(0.5),
                  borderRadius: BorderRadius.circular(3),
                ),
              ),
            ),
          ),
        ),
      ],
    );
  }
}

/// [_BuildCardDetails]
/// Displays the textual information below the image.
class _BuildCardDetails extends StatelessWidget {
  final Apartment apartment;

  const _BuildCardDetails({required this.apartment});

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    return Padding(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              Expanded(
                child: Text(
                  apartment.title,
                  style: theme.textTheme.titleMedium?.copyWith(
                    fontWeight: FontWeight.bold,
                  ),
                  maxLines: 1,
                  overflow: TextOverflow.ellipsis,
                ),
              ),
              if (apartment.status == 'approved')
                const Icon(Icons.verified, size: 16, color: Colors.blue),
            ],
          ),
          const SizedBox(height: 8),

          Row(
            children: [
              Icon(Icons.location_on, size: 14, color: theme.colorScheme.secondary),
              const SizedBox(width: 4),
              Expanded(
                child: Text(
                  '${apartment.city}, ${apartment.address}',
                  style: theme.textTheme.bodyMedium?.copyWith(
                    color: theme.colorScheme.onSurface.withOpacity(0.6),
                  ),
                  maxLines: 1,
                  overflow: TextOverflow.ellipsis,
                ),
              ),
            ],
          ),
          const SizedBox(height: 12),

          Divider(color: Colors.grey.withOpacity(0.1)),
          const SizedBox(height: 12),

          Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              RichText(
                text: TextSpan(
                  children: [
                    TextSpan(
                      text: '\$${apartment.price}',
                      style: theme.textTheme.titleLarge?.copyWith(
                        fontWeight: FontWeight.bold,
                        color: theme.colorScheme.primary,
                      ),
                    ),
                    TextSpan(
                      text: ' / ${AppLocalizations.of(context).month}',
                      style: theme.textTheme.bodySmall?.copyWith(
                        color: theme.colorScheme.onSurface.withOpacity(0.6),
                      ),
                    ),
                  ],
                ),
              ),

              Row(
                children: [
                  _BuildMiniAmenity(icon: Icons.bed, text: '${apartment.bedrooms}'),
                  const SizedBox(width: 8),
                  _BuildMiniAmenity(icon: Icons.bathtub, text: '${apartment.bathrooms}'),
                  const SizedBox(width: 8),
                  _BuildMiniAmenity(icon: Icons.square_foot, text: '${apartment.area} m²'),
                ],
              ),
            ],
          ),
        ],
      ),
    );
  }
}

/// [_BuildRatingBadge]
/// A blurry glass-effect badge for rating.
class _BuildRatingBadge extends StatelessWidget {
  final num rating;

  const _BuildRatingBadge({required this.rating});

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
      decoration: BoxDecoration(
        color: Colors.black.withOpacity(0.6),
        borderRadius: BorderRadius.circular(12),
        border: Border.all(color: Colors.white.withOpacity(0.2)),
      ),
      child: Row(
        mainAxisSize: MainAxisSize.min,
        children: [
          const Icon(Icons.star, color: Colors.amber, size: 14),
          const SizedBox(width: 4),
          Text(
            rating > 0 ? rating.toString() : AppLocalizations.of(context).new_,
            style: const TextStyle(
              color: Colors.white,
              fontSize: 12,
              fontWeight: FontWeight.bold,
            ),
          ),
        ],
      ),
    );
  }
}

/// [_BuildFavoriteIcon]
/// A dedicated widget for the favorite button on the card.
class _BuildFavoriteIcon extends StatelessWidget {
  const _BuildFavoriteIcon();

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(8),
      decoration: BoxDecoration(
        color: Colors.white,
        shape: BoxShape.circle,
        boxShadow: [
          BoxShadow(
            color: Colors.black.withOpacity(0.1),
            blurRadius: 10,
          ),
        ],
      ),
      child: const Icon(Icons.favorite_border, size: 20, color: Colors.grey),
    );
  }
}

/// [_BuildMiniAmenity]
/// Small icon and text for quick info (Bed/Bath).
class _BuildMiniAmenity extends StatelessWidget {
  final IconData icon;
  final String text;

  const _BuildMiniAmenity({required this.icon, required this.text});

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    return Row(
      children: [
        Icon(icon, size: 16, color: theme.colorScheme.tertiary),
        const SizedBox(width: 4),
        Text(
          text,
          style: theme.textTheme.bodySmall?.copyWith(fontWeight: FontWeight.w600),
        ),
      ],
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\global_widgets\apartment_cards\apartment_shimmer.dart
// =======================================================

import 'package:flutter/material.dart';

/// [BuildShimmerCard]
/// The actual skeleton design matching the ApartmentCard structure.
class BuildShimmerCard extends StatelessWidget {
  const BuildShimmerCard({super.key});

  @override
  Widget build(BuildContext context) {
    return Container(
      margin: const EdgeInsets.only(bottom: 24),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.circular(24),
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Container(
            height: 400,
            width: double.infinity,
            decoration: BoxDecoration(
              color: Colors.white,
              borderRadius: BorderRadius.circular(24),
            ),
          ),

          const SizedBox(height: 16),

          Padding(
            padding: const EdgeInsets.symmetric(horizontal: 16),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Container(
                  height: 20,
                  width: double.infinity,
                  decoration: BoxDecoration(
                    color: Colors.white,
                    borderRadius: BorderRadius.circular(8),
                  ),
                ),
                const SizedBox(height: 8),

                Container(
                  height: 14,
                  width: 150,
                  decoration: BoxDecoration(
                    color: Colors.white,
                    borderRadius: BorderRadius.circular(8),
                  ),
                ),

                const SizedBox(height: 16),
                Divider(color: Colors.white),
                const SizedBox(height: 12),

                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Container(
                      height: 24,
                      width: 80,
                      decoration: BoxDecoration(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(8),
                      ),
                    ),
                    Row(
                      children: [
                        Container(
                          height: 20,
                          width: 40,
                          decoration: BoxDecoration(
                            color: Colors.white,
                            borderRadius: BorderRadius.circular(8),
                          ),
                        ),
                        const SizedBox(width: 8),
                        Container(
                          height: 20,
                          width: 40,
                          decoration: BoxDecoration(
                            color: Colors.white,
                            borderRadius: BorderRadius.circular(8),
                          ),
                        ),
                      ],
                    )
                  ],
                )
              ],
            ),
          ),
          const SizedBox(height: 16),
        ],
      ),
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\global_widgets\build_branding.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:malaz/core/config/color/app_color.dart';

class BuildBranding extends StatelessWidget {
  const BuildBranding({super.key});

  @override
  Widget build(BuildContext context) {
    return Align(
      alignment: Alignment.bottomCenter,
      child: Padding(
        padding: const EdgeInsets.only(bottom: 20.0),
        child: Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            ShaderMask(
              shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
              child: Text(
                'FROM',
                style: TextStyle(
                  fontSize: 14,
                  fontWeight: FontWeight.w300,
                  color: Colors.grey[600],
                ),
              ),
            ),
            const SizedBox(height: 4),
            ShaderMask(
              shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
              child: Text(
                'MALAZ',
                style: TextStyle(
                  fontSize: 18,
                  fontWeight: FontWeight.bold,
                  color: Colors.yellow,
                  letterSpacing: 1.5,
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\global_widgets\custom_button.dart
// =======================================================


import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import '../../core/config/color/app_color.dart';

class CustomButton extends StatelessWidget {
  final String text;
  final VoidCallback? onPressed;
  final bool isOutline;

  const CustomButton({
    Key? key,
    required this.text,
    this.onPressed,
    this.isOutline = false,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    final colorScheme = theme.colorScheme;
    final isDarkMode = theme.brightness == Brightness.dark;

    final bool isDeactivated = onPressed == null;

    return Container(
      width: double.infinity,
      height: 56,
      decoration: BoxDecoration(
        gradient: isOutline || isDeactivated
            ? null
            : (isDarkMode ? AppColors.premiumGoldGradient : AppColors.premiumGoldGradient),
        color: isDeactivated ? Colors.grey.shade400 : null,
        borderRadius: BorderRadius.circular(16),
        border: isOutline ? Border.all(color: colorScheme.primary, width: 2) : null,
      ),
      child: ElevatedButton(
        onPressed: onPressed,
        style: ElevatedButton.styleFrom(
          backgroundColor: Colors.transparent,
          shadowColor: Colors.transparent,
          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(16)),
        ),
        child: Text(
          text,
          style: TextStyle(
            fontSize: 18,
            fontWeight: FontWeight.bold,
            color: isOutline ? colorScheme.primary : colorScheme.onPrimary,
          ),
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\auth\login\login_screen.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import 'package:malaz/core/config/color/app_color.dart';
import 'package:modal_progress_hud_nsn/modal_progress_hud_nsn.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../cubits/auth/auth_cubit.dart';
import '../../../global_widgets/build_branding.dart';
import '../../../global_widgets/custom_button.dart';
import '../shared_widgets/shared_widgets.dart';

class LoginScreen extends StatefulWidget {
  GlobalKey<FormState> formKey;
  LoginScreen({super.key, required this.formKey});

  @override
  State<LoginScreen> createState() => _LoginScreenState();
}

class _LoginScreenState extends State<LoginScreen> {
  final _phoneController = TextEditingController();
  final _passwordController = TextEditingController();

  @override
  void dispose() {
    _phoneController.dispose();
    _passwordController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.surface,
      body: BlocConsumer<AuthCubit, AuthState>(
        listener: (context, state) {
          if (state is AuthPending) {
            context.go('/pending');
          }
          if (state is AuthAuthenticated) {
            context.go('/home');
          }
          if (state is AuthError) {
            ScaffoldMessenger.of(context).showSnackBar(
              SnackBar(content: Text(state.message), backgroundColor: Colors.red),
            );
          }
        },
        builder: (context, state) {
            final isLoading = state is AuthLoading;

            return ModalProgressHUD(
              color: Colors.white,
              inAsyncCall: isLoading,
              child: SingleChildScrollView(
                child: SafeArea(
                  child: Padding(
                    padding: const EdgeInsets.symmetric(horizontal: 24),
                    child: Form(
                      key: widget.formKey,
                      child: Column(
                        mainAxisAlignment: MainAxisAlignment.center,
                        children: [
                          const SizedBox(
                            height: 40,
                          ),

                          // Logo
                          Container(
                            width: 80,
                            height: 80,
                            decoration: BoxDecoration(
                                color: Colors.white,
                                borderRadius: BorderRadius.circular(20),
                                boxShadow: const [
                                  BoxShadow(blurRadius: 20, color: Colors.black12)
                                ]
                            ),
                            child: Image.asset('assets/icons/key_logo.png'),
                          ),
                          const SizedBox(
                            height: 24,
                          ),

                          // Header Texts welcome_back
                          ShaderMask(
                            shaderCallback: (bounds) =>
                                AppColors.premiumGoldGradient.createShader(bounds),
                            child: Text(
                                tr.welcome_back, // Using getter
                                style: TextStyle(
                                  fontSize: 28,
                                  fontWeight: FontWeight.bold,
                                  color: Colors.yellow,
                                )
                            ),
                          ),
                          const SizedBox(
                            height: 8,
                          ),

                          // Header Texts login_to_continue
                          ShaderMask(
                            shaderCallback: (bounds) =>
                                AppColors.premiumGoldGradient.createShader(bounds),
                            child: Text(
                              tr.login_to_continue, // Using getter
                              style: TextStyle(
                                  color: Colors.grey.shade600
                              ),
                            ),
                          ),
                          const SizedBox(
                            height: 135,
                          ),

                          // Mobile number Text field
                          BuildTextfield(
                            label: tr.mobile_number,
                            icon: Icons.phone,
                            obscure: false,
                            haveSuffixEyeIcon: false,
                            formKey: widget.formKey,
                            keyboardType: TextInputType.phone,
                            controller: _phoneController, // adapt BuildTextfield to accept controller
                          ),
                          const SizedBox(
                            height: 16,
                          ),

                          // Password Text field
                          BuildTextfield(
                            label: tr.password,
                            icon: Icons.password,
                            obscure: true,
                            haveSuffixEyeIcon: true,
                            formKey: widget.formKey,
                            controller: _passwordController,
                          ),
                          const SizedBox(
                            height: 70,
                          ),

                          // Login Button
                          CustomButton(
                              text: tr.login,
                              onPressed: isLoading ? null : () {
                                if (widget.formKey.currentState?.validate() ?? false) {
                                  context.read<AuthCubit>().login(
                                    phone: _phoneController.text.trim(),
                                    password: _passwordController.text.trim(),
                                  );
                                }
                              },
                          ),
                          const SizedBox(
                            height: 12,
                          ),

                          // To Go to Register pages (home_register_screen.dart)
                          const BuildRegisterRow(),
                          const SizedBox(
                            height: 110,
                          ),

                          // Branding
                          BuildBranding()
                        ],
                      ),
                    ),
                  ),
                ),
              ),
            );
          },
      ),
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\auth\my_profile\my_profile_screen.dart
// =======================================================

import 'dart:io';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import 'package:image_picker/image_picker.dart';
import '../../../../core/config/color/app_color.dart';
import '../../../../core/service_locator/service_locator.dart';
import '../../../../data/datasources/local/auth_local_datasource.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../cubits/auth/auth_cubit.dart';

class MyProfileScreen extends StatefulWidget {
  const MyProfileScreen({super.key});

  @override
  State<MyProfileScreen> createState() => _MyProfileScreenState();
}

class _MyProfileScreenState extends State<MyProfileScreen> {
  late TextEditingController _firstNameController;
  late TextEditingController _lastNameController;
  bool _isEditable = false;
  String? _tempLocalImagePath; // لتخزين مسار الصورة المختارة محلياً قبل الحفظ النهائي

  @override
  void initState() {
    super.initState();
    _firstNameController = TextEditingController();
    _lastNameController = TextEditingController();

    final state = context.read<AuthCubit>().state;
    if (state is AuthAuthenticated) {
      _firstNameController.text = state.user.first_name;
      _lastNameController.text = state.user.last_name;
    }
  }

  @override
  void dispose() {
    _firstNameController.dispose();
    _lastNameController.dispose();
    super.dispose();
  }

  // دالة اختيار الصورة (تعمل فقط في وضع التعديل)
  Future<void> _pickImage() async {
    final ImagePicker picker = ImagePicker();
    final XFile? image = await picker.pickImage(source: ImageSource.gallery);

    if (image != null) {
      setState(() {
        _tempLocalImagePath = image.path;
      });
    }
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.background,
      body: BlocBuilder<AuthCubit, AuthState>(
        builder: (context, state) {
          String? profileImgUrl;
          if (state is AuthAuthenticated) {
            profileImgUrl = state.user.profile_image_url;
          }

          return CustomScrollView(
            physics: const BouncingScrollPhysics(),
            slivers: [
              SliverAppBar(
                expandedHeight: 280,
                pinned: true,
                stretch: true,
                backgroundColor: AppColors.primaryLight,
                leading: IconButton(
                  icon: Icon(Icons.arrow_back_ios_new, color: colorScheme.surface),
                  onPressed: () => context.go('/home'),
                ),
                actions: [
                  if (_isEditable)
                    Padding(
                      padding: const EdgeInsets.all(8),
                      child: IconButton(
                        icon: Icon(Icons.save, color: colorScheme.surface, size: 35),
                        onPressed: () async {
                          await context.read<AuthCubit>().updateUserData(
                            _firstNameController.text,
                            _lastNameController.text,
                            imagePath: _tempLocalImagePath,
                          );
                          setState(() {
                            _isEditable = false;
                            _tempLocalImagePath = null;
                          });
                          ScaffoldMessenger.of(context).showSnackBar(
                              SnackBar(content: Text(tr.profile_updated_success))
                          );
                        },
                      ),
                    ),
                ],
                flexibleSpace: FlexibleSpaceBar(
                  background: Stack(
                    alignment: Alignment.center,
                    children: [
                      Container(decoration: const BoxDecoration(gradient: AppColors.premiumGoldGradient2)),
                      Positioned(
                        top: -50,
                        right: -50,
                        child: CircleAvatar(radius: 100, backgroundColor: Colors.white.withOpacity(0.1)),
                      ),
                      _buildAvatar(profileImgUrl, colorScheme),
                    ],
                  ),
                ),
              ),
              SliverToBoxAdapter(
                child: Transform.translate(
                  offset: const Offset(0, -20),
                  child: Container(
                    decoration: BoxDecoration(
                      color: colorScheme.background,
                      borderRadius: const BorderRadius.vertical(top: Radius.circular(30)),
                    ),
                    padding: const EdgeInsets.only(top: 30),
                    child: Column(
                      children: [
                        _buildProfileName(colorScheme),
                        const SizedBox(height: 8),
                        Text(
                            tr.my_profile.toUpperCase(),
                            style: TextStyle(
                                color: Colors.grey.shade500,
                                fontSize: 12,
                                fontWeight: FontWeight.bold,
                                letterSpacing: 2
                            )
                        ),
                        const SizedBox(height: 35),
                        _buildInfoCard(colorScheme, tr),
                        const SizedBox(height: 40),
                        if (!_isEditable) _buildPremiumEditButton(context, tr),
                        const SizedBox(height: 50),
                      ],
                    ),
                  ),
                ),
              ),
            ],
          );
        },
      ),
    );
  }

  Widget _buildAvatar(String? profileImgUrl, ColorScheme colorScheme) {
    return Positioned(
      bottom: 40,
      child: Stack(
        children: [
          Container(
            padding: const EdgeInsets.all(6),
            decoration: BoxDecoration(
              color: Colors.white.withOpacity(0.2),
              shape: BoxShape.circle,
              border: Border.all(color: Colors.white.withOpacity(0.4), width: 1.5),
            ),
            child: Container(
              padding: const EdgeInsets.all(4),
              decoration: const BoxDecoration(color: Colors.white, shape: BoxShape.circle),
              child: Hero(
                tag: 'profile_pic',
                child: CircleAvatar(
                  radius: 65,
                  backgroundColor: colorScheme.surface,
                  // إذا اختار المستخدم صورة جديدة محلياً نعرضها، وإلا نعرض الصورة من السيرفر
                  child: _tempLocalImagePath != null
                      ? ClipRRect(
                    borderRadius: BorderRadius.circular(65),
                    child: Image.file(File(_tempLocalImagePath!), width: 130, height: 130, fit: BoxFit.cover),
                  )
                      : UserProfileImage(imageUrl: profileImgUrl ?? "", size: 130),
                ),
              ),
            ),
          ),
          // لا تظهر الكاميرا إلا إذا ضغط المستخدم على Edit Profile
          if (_isEditable)
            Positioned(
              bottom: 5,
              right: 5,
              child: GestureDetector(
                onTap: _pickImage, // تفتح الاستوديو مباشرة لأننا تحققنا من كلمة السر مسبقاً
                child: Container(
                  padding: const EdgeInsets.all(8),
                  decoration: BoxDecoration(
                    gradient: AppColors.premiumGoldGradient2,
                    shape: BoxShape.circle,
                    border: Border.all(color: Colors.white, width: 2),
                    boxShadow: [BoxShadow(color: Colors.black26, blurRadius: 10, offset: const Offset(0, 4))],
                  ),
                  child: const Icon(Icons.camera_alt, color: Colors.white, size: 20),
                ),
              ),
            ),
        ],
      ),
    );
  }

  Widget _buildProfileName(ColorScheme colorScheme) {
    return _isEditable
        ? Padding(
      padding: const EdgeInsets.symmetric(horizontal: 40),
      child: Row(
        children: [
          Expanded(child: TextField(controller: _firstNameController, textAlign: TextAlign.center, style: const TextStyle(fontSize: 20, fontWeight: FontWeight.bold))),
          const SizedBox(width: 10),
          Expanded(child: TextField(controller: _lastNameController, textAlign: TextAlign.center, style: const TextStyle(fontSize: 20, fontWeight: FontWeight.bold))),
        ],
      ),
    )
        : Text("${_firstNameController.text} ${_lastNameController.text}", style: TextStyle(fontSize: 28, fontWeight: FontWeight.bold, color: colorScheme.primary, letterSpacing: 0.5));
  }

  Widget _buildInfoCard(ColorScheme colorScheme, AppLocalizations tr) {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 24),
      padding: const EdgeInsets.symmetric(vertical: 10, horizontal: 15),
      decoration: BoxDecoration(
        color: colorScheme.surface,
        borderRadius: BorderRadius.circular(28),
        boxShadow: [BoxShadow(color: colorScheme.primary.withOpacity(0.06), blurRadius: 25, offset: const Offset(0, 10))],
      ),
      child: Column(
        children: [
          _infoTile(Icons.person_outline, tr.first_name, _firstNameController, colorScheme),
          _customDivider(colorScheme),
          _infoTile(Icons.person_outline, tr.last_name, _lastNameController, colorScheme),
          _customDivider(colorScheme),
          _infoTile(Icons.lock_open_outlined, tr.password, TextEditingController(text: "••••••••"), colorScheme, isEnabled: false),
        ],
      ),
    );
  }

  Widget _infoTile(IconData icon, String label, TextEditingController controller, ColorScheme colorScheme, {bool isEnabled = true}) {
    return Padding(
      padding: const EdgeInsets.symmetric(vertical: 15, horizontal: 10),
      child: Row(
        children: [
          Container(
            padding: const EdgeInsets.all(12),
            decoration: BoxDecoration(color: colorScheme.primary.withOpacity(0.08), borderRadius: BorderRadius.circular(15)),
            child: Icon(icon, color: colorScheme.primary, size: 22),
          ),
          const SizedBox(width: 18),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(label, style: TextStyle(color: Colors.grey.shade500, fontSize: 12, fontWeight: FontWeight.w500)),
                const SizedBox(height: 4),
                TextField(
                  controller: controller,
                  enabled: _isEditable && isEnabled,
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold, color: colorScheme.onSurface),
                  decoration: const InputDecoration(border: InputBorder.none, isDense: true),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  Widget _customDivider(ColorScheme colorScheme) {
    return Divider(height: 1, indent: 70, endIndent: 20, color: colorScheme.primary.withOpacity(0.05));
  }

  Widget _buildPremiumEditButton(BuildContext context, AppLocalizations tr) {
    return Container(
      margin: const EdgeInsets.symmetric(horizontal: 30),
      height: 58,
      width: double.infinity,
      decoration: BoxDecoration(
        gradient: AppColors.premiumGoldGradient2,
        borderRadius: BorderRadius.circular(18),
        boxShadow: [BoxShadow(color: AppColors.primaryLight.withOpacity(0.3), blurRadius: 15, offset: const Offset(0, 8))],
      ),
      child: ElevatedButton(
        onPressed: () => _showPasswordDialog(context),
        style: ElevatedButton.styleFrom(backgroundColor: Colors.transparent, shadowColor: Colors.transparent, shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(18))),
        child: Text(tr.edit_profile, style: const TextStyle(color: Colors.white, fontSize: 17, fontWeight: FontWeight.bold)),
      ),
    );
  }

  void _showPasswordDialog(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;
    final passwordController = TextEditingController();
    bool isLoading = false;

    showDialog(
      context: context,
      barrierDismissible: false,
      builder: (context) => StatefulBuilder(
        builder: (context, setState) {
          return AlertDialog(
            shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(25)),
            title: Text(tr.identity_verification, style: TextStyle(fontWeight: FontWeight.bold, color: colorScheme.primary)),
            content: Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                Text(tr.identity_verification_input, textAlign: TextAlign.center, style: const TextStyle(fontSize: 13, color: Colors.grey)),
                const SizedBox(height: 20),
                TextField(
                  controller: passwordController,
                  obscureText: true,
                  style: TextStyle(color: colorScheme.onSurface),
                  decoration: InputDecoration(
                    hintText: tr.current_password,
                    filled: true,
                    fillColor: colorScheme.primary.withOpacity(0.05),
                    border: OutlineInputBorder(borderRadius: BorderRadius.circular(15), borderSide: BorderSide.none),
                  ),
                ),
              ],
            ),
            actions: [
              TextButton(onPressed: isLoading ? null : () => Navigator.pop(context), child: Text(tr.cancel)),
              ElevatedButton(
                style: ButtonStyle(backgroundColor: WidgetStateProperty.all(colorScheme.primary)),
                onPressed: isLoading
                    ? null
                    : () async {
                  setState(() => isLoading = true);
                  final bool isCorrect = await context.read<AuthCubit>().verifyPasswordSilently(passwordController.text);
                  if (isCorrect) {
                    Navigator.pop(context);
                    this.setState(() => _isEditable = true);
                  } else {
                    setState(() => isLoading = false);
                    ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text(tr.incorrect_password), backgroundColor: colorScheme.error));
                  }
                },
                child: isLoading
                    ? const CircularProgressIndicator(constraints: BoxConstraints(maxWidth: 25, maxHeight: 25), color: Colors.white)
                    : Text(tr.verify, style: TextStyle(color: colorScheme.surface)),
              ),
            ],
          );
        },
      ),
    );
  }
}

class UserProfileImage extends StatelessWidget {
  final String imageUrl;
  final double size;
  const UserProfileImage({super.key, required this.imageUrl, this.size = 50.0});

  @override
  Widget build(BuildContext context) {
    return FutureBuilder<String?>(
      future: sl<AuthLocalDatasource>().getCachedToken(),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) return const Center(child: CircularProgressIndicator(strokeWidth: 2));
        final token = snapshot.data;
        print("Requesting image with Token: $token");
        return ClipRRect(
          borderRadius: BorderRadius.circular(size / 2),
          child: Image.network(
            "${imageUrl}${imageUrl.contains('?') ? '&' : '?'}v=${DateTime.now().millisecondsSinceEpoch}",
            width: size,
            height: size,
            fit: BoxFit.cover,
            headers: {'Authorization': 'Bearer ${token?.trim()}', 'Accept': 'application/json'},
            errorBuilder: (context, error, stackTrace) => Icon(Icons.person, size: size * 0.5, color: Colors.grey.shade400),
          ),
        );
      },
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\auth\register\home_register_screen.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen1.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen2.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen3.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen4.dart';
import 'package:malaz/presentation/screens/auth/register/register_screen5.dart';
import 'package:smooth_page_indicator/smooth_page_indicator.dart';

import '../../../../core/config/color/app_color.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../cubits/auth/auth_cubit.dart';
import '../shared_widgets/shared_widgets.dart';

class HomeRegisterScreen extends StatefulWidget {
  HomeRegisterScreen({super.key});

  @override
  State<HomeRegisterScreen> createState() => _HomeRegisterScreenState();
}

class _HomeRegisterScreenState extends State<HomeRegisterScreen> {
  final PageController _controller = PageController();
  final GlobalKey<RegisterScreen4State> registerScreen4Key = GlobalKey<RegisterScreen4State>();
  final GlobalKey<RegisterScreen5State> registerScreen5Key = GlobalKey<RegisterScreen5State>();
  final GlobalKey<BuildPincodeTextfieldState> _pinTextfieldKey = GlobalKey<BuildPincodeTextfieldState>();

  final List<GlobalKey<FormState>> formKeys = List.generate(5, (_) => GlobalKey<FormState>());


  /// data inputs from user storage here
  final RegisterData registerData = RegisterData();
  bool _pinValid = false;  /// PIN verification status
  int currentPage = 0;

  /// Update PIN status from RegisterScreen1
  void updatePinValidity(bool value) {
    setState(() => _pinValid = value);
  }

  bool myConditionCheck() {
    final currentFormKey = formKeys[currentPage];
    /// If there is no form on the current page -> we block navigation (unexpected but safe situation)
    if (currentFormKey.currentState == null) {
      return true; /// true => Block movement
    }

    /// We are verifying the current form
    final bool isFormValid = currentFormKey.currentState!.validate();
    if (!isFormValid) {
      return true; /// Navigation is prevented because the form is invalid
    }

    /// Page-specific conditions
    if (currentPage == 0) {
      /// Check the PIN status inside BuildPincodeTextfield
      final pinState = _pinTextfieldKey.currentState;
      if (pinState == null) {
        /// The state cannot be reached -> Block navigation
        return true;
      }

      /// If the length is incorrect, we will show the error and prevent movement
      if (!pinState.isPinValid()) {
        pinState.showError();
        return true;
      }

      /// Now we check the server verification result (stored in _pinValid)
      if (!_pinValid) {
        /// Six numbers were entered, but the server has not yet confirmed or rejected them.
        pinState.showError();
        return true;
      }
    } else if (currentPage == 3) {
      if (registerScreen4Key.currentState == null || !registerScreen4Key.currentState!.isImageSelected()) {
        registerScreen4Key.currentState?.showImageError(true);
        return true;
      }
    } else if (currentPage == 4) {
      if (registerScreen5Key.currentState == null || !registerScreen5Key.currentState!.isImageSelected()) {
        registerScreen5Key.currentState?.showImageError(true);
        return true;
      }
    }

    /// All tests are successful => Movement is permitted
    return false;
  }


  void _onPageChanged(int newPage) {
    if (myConditionCheck()) {
      _controller.animateToPage(
        currentPage,
        duration: Duration(milliseconds: 100),
        curve: Curves.easeInOut,
      );
    } else {
      setState(() => currentPage = newPage);
    }
  }

  void _submitRegister() {
    final phone = registerData.phone.trim();
    final firstName = registerData.firstName.trim();
    final lastName = registerData.lastName.trim();
    final password = registerData.password.trim();
    final dob = registerData.dateOfBirth.trim();
    final profile = registerData.profileImage;
    final identity = registerData.identityImage;

    print('>>>>>> submitRegister called with: phone="$phone", first="$firstName", last="$lastName", password="${password.isNotEmpty}", dob="$dob", profile=${profile != null}, identity=${identity != null}');

    if (phone.isEmpty || firstName.isEmpty || lastName.isEmpty || password.isEmpty || dob.isEmpty || profile == null || identity == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Please fill all fields and upload images')),
      );
      return;
    }

    context.read<AuthCubit>().register(
      phone: phone,
      firstName: firstName,
      lastName: lastName,
      password: password,
      dateOfBirth: dob,
      profileImage: profile,
      identityImage: identity,
    );
  }


  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;
    return BlocListener<AuthCubit, AuthState>(
      listener: (context, state) {
        if (state is AuthPending) {
          context.go('/pending');
        } else if (state is AuthAuthenticated) {
          context.go('/home');
        } else if (state is AuthError) {
          ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text(state.message)));
        }
      },
      child: Scaffold(
        backgroundColor: colorScheme.surface,
        body: ListView(
          children: [
            SizedBox(
              height: 800,
              width: 450,
              child: PageView(
                //physics: NeverScrollableScrollPhysics(),
                controller: _controller,
                onPageChanged: _onPageChanged,
                children: [
                  RegisterScreen1(
                    formKey: formKeys[0],
                    pinKey: _pinTextfieldKey,
                    registerData: registerData,
                    onPinVerified: updatePinValidity,
                  ),
                  RegisterScreen2(
                    formKey: formKeys[1],
                    registerData: registerData,
                  ),
                  RegisterScreen3(
                    formKey: formKeys[2],
                    registerData: registerData,
                  ),
                  RegisterScreen4(
                    key: registerScreen4Key,
                    formKey: formKeys[3],
                    registerData: registerData,
                  ),
                  RegisterScreen5(
                    key: registerScreen5Key,
                    formKey: formKeys[4],
                    registerData: registerData,
                    onRegisterPressed: _submitRegister,
                  ),
                ],
              ),
            ),
            const SizedBox(
              height: 8,
            ),
            Center(
              child: ShaderMask(
                shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                child: SmoothPageIndicator(
                  controller: _controller,
                  count: 5,
                  effect: ExpandingDotsEffect(
                      activeDotColor: Colors.white,
                      dotColor: Colors.yellow,
                      dotHeight: 25,
                      dotWidth: 25,
                      spacing: 15
                  ),
                ),
              ),
            ),
            const SizedBox(
              height: 25,
            )
          ],
        ),
      ),
    );
  }
}

class RegisterData {
  String phone = '';
  String firstName = '';
  String lastName = '';
  String password = '';
  String confirmPassword = '';
  String dateOfBirth = '';
  XFile? profileImage;
  XFile? identityImage;
}

// =======================================================
// FILE PATH: lib\presentation\screens\auth\register\register_screen1.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:malaz/core/config/color/app_color.dart';
import 'package:modal_progress_hud_nsn/modal_progress_hud_nsn.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../cubits/auth/auth_cubit.dart';
import '../../../global_widgets/build_branding.dart';
import '../shared_widgets/shared_widgets.dart';
import 'home_register_screen.dart';

class RegisterScreen1 extends StatefulWidget {
  final GlobalKey<FormState> formKey;
  final GlobalKey<BuildPincodeTextfieldState> pinKey;
  final RegisterData registerData;
  final Function(bool)? onPinVerified;

  const RegisterScreen1({
    super.key,
    required this.formKey,
    required this.pinKey,
    required this.registerData,
    this.onPinVerified,
  });

  @override
  State<RegisterScreen1> createState() => _RegisterScreen1State();
}

class _RegisterScreen1State extends State<RegisterScreen1> {
  bool _isSending = false;
  String? _pinError;

  /// Calling the function to send code via cubit
  void _sendVerificationCode() {
    final phone = widget.registerData.phone.trim();
    if (phone.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(backgroundColor: Colors.amber,content: Text('Please enter your phone first')));
      return;
    }
    /// Here we ask the cubit to send the code
    context.read<AuthCubit>().sendOtp(phone);
  }

  /// Calling a code validation function via AuthCubit
  void _verifyPin(String pin) {
    if (pin.length != 6) {
      setState(() => _pinError = 'Please enter a 6-digit PIN code');
      widget.onPinVerified?.call(false);
      return;
    }
    setState(() => _pinError = null);

    final phone = widget.registerData.phone.trim();
    /// Here we tell the field that verification has started
    widget.pinKey?.currentState?.verifyStarted();
    /// Here we ask Cubit to check
    context.read<AuthCubit>().verifyOtp(phone, pin);
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return BlocListener<AuthCubit, AuthState>(
      listener: (context, state) {
        /// Send code
        if (state is OtpSending) {
          setState(() => _isSending = true);
        } else if (state is OtpSent) {
          setState(() => _isSending = false);
          ScaffoldMessenger.of(context).showSnackBar(const SnackBar(backgroundColor: Colors.amber,content: Text('Verification code sent!')));
        } else if (state is OtpSendError) {
          setState(() => _isSending = false);
          ScaffoldMessenger.of(context).showSnackBar(SnackBar(backgroundColor: Colors.amber,content: Text(state.message)));
        }

        /// Verify Code
        if (state is OtpVerifying) {
          /// Ensure pin field shows progress
          widget.pinKey?.currentState?.verifyStarted();
        } else if (state is OtpVerified) {

          /// Success: Inform the field, and inform the parent (HomeRegister) that the PIN is valid
          widget.pinKey?.currentState?.verifyFinished(success: true);
          widget.onPinVerified?.call(true);
          ScaffoldMessenger.of(context).showSnackBar(const SnackBar(backgroundColor: Colors.amber,content: Text('Code verified successfully')));
        } else if (state is OtpVerifyError) {
          /// Failed: The field was told an error message, and a local error occurred.
          final msg = state.message.isNotEmpty ? state.message : 'Invalid code';
          widget.pinKey?.currentState?.verifyFinished(success: false, message: msg);
          widget.onPinVerified?.call(false);
          setState(() => _pinError = msg);
          ScaffoldMessenger.of(context).showSnackBar(SnackBar(backgroundColor: Colors.amber,content: Text(msg)));
        }
      },
      child: ModalProgressHUD(
        color: Colors.white,
        inAsyncCall: _isSending,
        child: Scaffold(
          backgroundColor: colorScheme.surface,
          body: Padding(
            padding: const EdgeInsets.all(6),
            child: SingleChildScrollView(
              child: SafeArea(
                child: Padding(
                  padding: const EdgeInsets.symmetric(horizontal: 24),
                  child: Form(
                    key: widget.formKey,
                    child: Column(
                      mainAxisAlignment: MainAxisAlignment.center,
                      children: [
                        const SizedBox(
                          height: 40,
                        ),
                        // Logo
                        Container(
                          width: 80,
                          height: 80,
                          decoration: BoxDecoration(
                            color: Colors.white,
                            borderRadius: BorderRadius.circular(20),
                            boxShadow: const [BoxShadow(blurRadius: 20, color: Colors.black12)],
                          ),
                          child: Image.asset('assets/icons/key_logo.png'),
                        ),
                        const SizedBox(
                          height: 24,
                        ),


                        ShaderMask(
                          shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                          child: Text(tr.create_account,
                              style: const TextStyle(fontSize: 28, fontWeight: FontWeight.bold, color: Colors.yellow)),
                        ),
                        const SizedBox(
                          height: 8,
                        ),


                        ShaderMask(
                          shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                          child: Text(tr.join_to_find, style: TextStyle(color: Colors.grey.shade600)),
                        ),
                        const SizedBox(
                          height: 100,
                        ),

                        // Mobile Field
                        BuildTextfield(
                          label: tr.mobile_number,
                          icon: Icons.phone,
                          obscure: false,
                          keyboardType: TextInputType.phone,
                          haveSuffixEyeIcon: false,
                          formKey: widget.formKey,
                          onChanged: (value) => widget.registerData.phone = value,
                        ),
                        const SizedBox(
                          height: 16,
                        ),

                        // Send Verification Code Button

                        BuildVerficationCodeButton(
                          onPressed: _isSending ? null : _sendVerificationCode,
                        ),
                        const SizedBox(
                          height: 4,
                        ),

                        // Pin Code TextField
                        BuildPincodeTextfield(
                          key: widget.pinKey,
                          onChanged: (pin) {
                            /// When the PIN length reaches 6 digits, we call Cubit verification.
                            if (pin.length == 6) {
                              _verifyPin(pin);
                            }
                          },
                          onVerified: (success) {
                            /// it is called after verifyFinished within the field
                            /// UI update here too
                            widget.onPinVerified?.call(success);
                          },
                        ),
                        if (_pinError != null) Text(_pinError!, style: const TextStyle(color: Colors.red)),
                        const SizedBox(
                          height: 100,
                        ),

                        // Login Row
                        const BuildLoginRow(),
                        const SizedBox(
                          height: 80,
                        ),

                        // Branding
                        BuildBranding(),
                      ],
                    ),
                  ),
                ),
              ),
            ),
          ),
        ),
      ),
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\auth\register\register_screen2.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:malaz/core/config/color/app_color.dart';
import 'package:malaz/presentation/screens/auth/register/home_register_screen.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../global_widgets/build_branding.dart';
import '../shared_widgets/shared_widgets.dart';

class RegisterScreen2 extends StatefulWidget {
  final GlobalKey<FormState> formKey;
  final RegisterData registerData;
  const RegisterScreen2({super.key, required this.formKey, required this.registerData});

  @override
  State<RegisterScreen2> createState() => _RegisterScreen2State();
}

class _RegisterScreen2State extends State<RegisterScreen2> {
  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.surface,
      body: SingleChildScrollView(
        child: SafeArea(
          child: Padding(
            padding: const EdgeInsets.symmetric(
              horizontal: 24,
            ),
            child: Form(
              key: widget.formKey,
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const SizedBox(
                    height: 40,
                  ),

                  // Logo
                  Container(
                    width: 80,
                    height: 80,
                    decoration: BoxDecoration(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(20),
                        boxShadow: const [
                          BoxShadow(blurRadius: 20, color: Colors.black12)
                        ]),
                    child: Image.asset('assets/icons/key_logo.png'),
                  ),
                  const SizedBox(
                    height: 24,
                  ),

                  // Create Account - Header Text 1
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(tr.create_account, // Using getter
                        style: TextStyle(
                          fontSize: 28,
                          fontWeight: FontWeight.bold,
                          color: Colors.yellow,
                        )),
                  ),
                  const SizedBox(
                    height: 8,
                  ),

                  // Join To Find - Header Text 2
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(
                      tr.join_to_find, // Using getter
                      style: TextStyle(color: Colors.grey.shade600),
                    ),
                  ),
                  const SizedBox(
                    height: 100,
                  ),

                  // First Name Field
                  BuildTextfield(
                    label: tr.first_name,
                    icon: Icons.person,
                    obscure: false,
                    keyboardType: TextInputType.name,
                    haveSuffixEyeIcon: false,
                    formKey: widget.formKey,
                    onChanged: (value) => widget.registerData.firstName = value,
                  ),
                  const SizedBox(
                    height: 16,
                  ),

                  // Last Name Field
                  BuildTextfield(
                    label: tr.last_name,
                    icon: Icons.person,
                    obscure: false,
                    keyboardType: TextInputType.name,
                    haveSuffixEyeIcon: false,
                    formKey: widget.formKey,
                    onChanged: (value) => widget.registerData.lastName = value,
                  ),
                  const SizedBox(
                    height: 16,
                  ),

                  // Date Of Birth Field
                  BuildTextfield(
                    label: tr.date_of_birth,
                    icon: Icons.calendar_today_outlined,
                    onPressedForDate: true,
                    formKey: widget.formKey,
                    onChanged: (value) => widget.registerData.dateOfBirth = value,

                  ),
                  const SizedBox(
                    height: 100,
                  ),

                  // Navigator.push to Login Page
                  const BuildLoginRow(),
                  const SizedBox(
                    height: 100,
                  ),

                  // Branding
                  BuildBranding()
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\auth\register\register_screen3.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:malaz/core/config/color/app_color.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../global_widgets/build_branding.dart';
import '../shared_widgets/shared_widgets.dart';
import 'home_register_screen.dart';

class RegisterScreen3 extends StatelessWidget {
  final GlobalKey<FormState> formKey;
  final RegisterData registerData;
  const RegisterScreen3({super.key, required this.formKey, required this.registerData});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.surface,
      body: SingleChildScrollView(
        child: SafeArea(
          child: Padding(
            padding: const EdgeInsets.symmetric(
              horizontal: 24,
            ),
            child: Form(
              key: formKey,
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const SizedBox(
                    height: 40,
                  ),

                  // Logo
                  Container(
                    width: 80,
                    height: 80,
                    decoration: BoxDecoration(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(20),
                        boxShadow: const [
                          BoxShadow(blurRadius: 20, color: Colors.black12)
                        ]),
                    child: Image.asset('assets/icons/key_logo.png'),
                  ),
                  const SizedBox(
                    height: 24,
                  ),

                  // Create Account - Header Text 1
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(tr.create_account, // Using getter
                        style: TextStyle(
                          fontSize: 28,
                          fontWeight: FontWeight.bold,
                          color: Colors.yellow,
                        )),
                  ),
                  const SizedBox(
                    height: 8,
                  ),

                  // Join To Find - Header Text 2
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(
                      tr.join_to_find, // Using getter
                      style: TextStyle(color: Colors.grey.shade600),
                    ),
                  ),
                  const SizedBox(
                    height: 135,
                  ),

                  // Password Field
                  BuildTextfield(
                    label: tr.password,
                    icon: Icons.password,
                    haveSuffixEyeIcon: true,
                    obscure: true,
                    formKey: formKey,
                    onChanged: (value) => registerData.password = value,
                  ),
                  const SizedBox(
                    height: 16,
                  ),

                  //  Confirm Password Field
                  BuildTextfield(
                    label: tr.confirm_password,
                    icon: Icons.password,
                    haveSuffixEyeIcon: true,
                    obscure: true,
                    formKey: formKey,
                    onChanged: (value) => registerData.confirmPassword = value,
                  ),
                  const SizedBox(
                    height: 100,
                  ),

                  // Navigator.push to Login Page
                  const BuildLoginRow(),
                  const SizedBox(
                    height: 135,
                  ),

                  // Branding
                  BuildBranding()
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\auth\register\register_screen4.dart
// =======================================================

import 'dart:io';
import 'package:flutter/material.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/core/config/color/app_color.dart';
import 'package:malaz/presentation/screens/auth/register/home_register_screen.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../global_widgets/build_branding.dart';
import '../shared_widgets/shared_widgets.dart';

class RegisterScreen4 extends StatefulWidget {
  final GlobalKey<FormState> formKey;
  final RegisterData registerData;
  const RegisterScreen4({super.key, required this.formKey, required this.registerData});

  @override
  State<RegisterScreen4> createState() => RegisterScreen4State();
}

class RegisterScreen4State extends State<RegisterScreen4> {
  XFile? _image;
  bool _showImageError = false;

  void _submit() {
    if (_image == null) {
      setState(() {
        _showImageError = true;
      });
    } else {
      setState(() {
        _showImageError = false;
      });
    }
  }
  void showImageError(bool show) {
    setState(() {
      _showImageError = show;
    });
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.surface,
      body: SingleChildScrollView(
        child: SafeArea(
          child: Padding(
            padding: const EdgeInsets.symmetric(
              horizontal: 24,
            ),
            child: Form(
              key: widget.formKey,
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const SizedBox(
                    height: 40,
                  ),

                  // Logo
                  Container(
                    width: 80,
                    height: 80,
                    decoration: BoxDecoration(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(20),
                        boxShadow: const [
                          BoxShadow(blurRadius: 20, color: Colors.black12)
                        ]),
                    child: Image.asset('assets/icons/key_logo.png'),
                  ),
                  const SizedBox(
                    height: 24,
                  ),

                  // Create Account - Header Text 1
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(tr.create_account, // Using getter
                        style: TextStyle(
                          fontSize: 28,
                          fontWeight: FontWeight.bold,
                          color: Colors.yellow,
                        )),
                  ),
                  const SizedBox(
                    height: 8,
                  ),

                  // Join To Find - Header Text 2
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(
                      tr.join_to_find, // Using getter
                      style: TextStyle(color: Colors.grey.shade600),
                    ),
                  ),
                  const SizedBox(
                    height: 100,
                  ),

                  // ID Document Message
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(tr.id_document_message, // Using getter
                        style: TextStyle(
                          fontSize: 16,
                          fontWeight: FontWeight.bold,
                          color: Colors.yellow,
                        )),
                  ),
                  const SizedBox(
                    height: 24,
                  ),

                  // Image Input
                  ImageUploadWidget(
                    isError: _showImageError,
                    onImageSelected: (XFile? img) {
                      setState(() {
                        _image = img;
                        widget.registerData.identityImage = img;
                        _showImageError = false;
                      });
                    },
                  ),
                  if (_showImageError)
                    Padding(
                      padding: const EdgeInsets.only(top: 8),
                      child: Text(
                        tr.image_required,
                        style: TextStyle(color: Colors.red, fontWeight: FontWeight.bold),
                      ),
                    ),
                  const SizedBox(
                    height: 70,
                  ),

                  // Navigator.push to Login Page
                  const BuildLoginRow(),
                  const SizedBox(
                    height: 100,
                  ),

                  // Branding
                  BuildBranding()
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
  bool isImageSelected() {
    return _image != null;
  }
}

class ImageUploadWidget extends StatefulWidget {
  final Function(XFile?) onImageSelected;
  final bool isError;

  const ImageUploadWidget({Key? key, required this.onImageSelected,this.isError = false,}) : super(key: key);
  @override
  _ImageUploadWidgetState createState() => _ImageUploadWidgetState();
}

class _ImageUploadWidgetState extends State<ImageUploadWidget> {
  XFile? _image;

  Future<void> _pickImage() async {
    final picker = ImagePicker();
    final pickedFile = await picker.pickImage(source: ImageSource.gallery);

    if (pickedFile != null) {
      setState(() {
        _image = XFile(pickedFile.path);
      });
      widget.onImageSelected(_image);
    }
  }

  Widget _uploadBox(
      {required IconData icon, required String label, String? sub}) {
    return InkWell(
      onTap: _pickImage,
      child: DottedBox(
        isError: widget.isError,
        child: _image == null
            ? Column(
          mainAxisSize: MainAxisSize.min,
          children: [
            Icon(icon, size: 36, color: Colors.yellow),
            const SizedBox(height: 8),
            Text(label,
                style: TextStyle(
                    fontWeight: FontWeight.w600, color: Colors.yellow)),
            if (sub != null) ...[
              const SizedBox(height: 6),
              Text(sub,
                  style: TextStyle(fontSize: 12, color: Colors.yellow)),
            ],
          ],
        ) : Image.file(File(_image!.path), fit: BoxFit.cover),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return SizedBox(
      width: 350,
      height: 150,
      child: _uploadBox(
        icon: Icons.cloud_upload_outlined,
        label: tr.upload_id_message,
        sub: tr.png_jpg,
      ),
    );
  }
}

class DottedBox extends StatelessWidget {
  final Widget child;
  final bool isError;
  const DottedBox({required this.child, this.isError = false, Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return ShaderMask(
      shaderCallback: (bounds) =>
          AppColors.premiumGoldGradient.createShader(bounds),
      child: Container(
        width: double.infinity,
        padding: const EdgeInsets.all(20),
        decoration: BoxDecoration(
          color: Colors.white12,
          borderRadius: BorderRadius.circular(14),
          border: Border.all(
            color: isError ? Colors.red : Colors.yellow,
            style: BorderStyle.solid,
          ),
        ),
        child: child,
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\auth\register\register_screen5.dart
// =======================================================

import 'dart:io';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import 'package:image_picker/image_picker.dart';
import 'package:malaz/core/config/color/app_color.dart';
import 'package:malaz/presentation/global_widgets/custom_button.dart';
import '../../../../l10n/app_localizations.dart';
import '../../../cubits/auth/auth_cubit.dart';
import '../../../global_widgets/build_branding.dart';
import 'home_register_screen.dart';

class RegisterScreen5 extends StatefulWidget {
  final GlobalKey<FormState> formKey;
  final RegisterData registerData;
  final VoidCallback onRegisterPressed;

  const RegisterScreen5({super.key, required this.formKey, required this.registerData, required this.onRegisterPressed});

  @override
  State<RegisterScreen5> createState() => RegisterScreen5State();
}

class RegisterScreen5State extends State<RegisterScreen5> {
  XFile? _image;
  bool _showImageError = false;

  void _submit() {
    if (_image == null) {
      setState(() {
        _showImageError = true;
      });
    } else {
      setState(() {
        _showImageError = false;
      });
    }
  }
  void showImageError(bool show) {
    setState(() {
      _showImageError = show;
    });
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.surface,
      body: SingleChildScrollView(
        child: SafeArea(
          child: Padding(
            padding: const EdgeInsets.symmetric(horizontal: 24),
            child: Form(
              key: widget.formKey,
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const SizedBox(
                    height: 40,
                  ),

                  // Logo
                  Container(
                    width: 80,
                    height: 80,
                    decoration: BoxDecoration(
                        color: Colors.white,
                        borderRadius: BorderRadius.circular(20),
                        boxShadow: const [
                          BoxShadow(blurRadius: 20, color: Colors.black12)
                        ]),
                    child: Image.asset('assets/icons/key_logo.png'),
                  ),
                  const SizedBox(
                    height: 24,
                  ),

                  // Create Account - Header Text 1
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(tr.create_account, // Using getter
                        style: TextStyle(
                          fontSize: 28,
                          fontWeight: FontWeight.bold,
                          color: Colors.yellow,
                        )),
                  ),
                  const SizedBox(
                    height: 8,
                  ),

                  // Join To Find - Header Text 2
                  ShaderMask(
                    shaderCallback: (bounds) =>
                        AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(
                      tr.join_to_find, // Using getter
                      style: TextStyle(color: Colors.grey.shade600),
                    ),
                  ),
                  const SizedBox(
                    height: 70,
                  ),

                  // Profile Image Message
                  ShaderMask(
                    shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                    child: Text(
                        tr.profile_image_message, // Using getter
                        style: TextStyle(
                            fontSize: 14,
                            color: Colors.grey.shade600
                        )
                    ),
                  ),
                  const SizedBox(
                    height: 24,
                  ),

                  // Profile Image Input
                  ImageUploadWidget(
                    isError: _showImageError,
                    onImageSelected: (XFile? img) {
                      setState(() {
                        widget.registerData.profileImage = img;
                        _image = img;
                        _showImageError = false;
                      });
                    },
                  ),
                  if (_showImageError)
                    Padding(
                      padding: const EdgeInsets.only(top: 8),
                      child: Text(
                        tr.image_required,
                        style: TextStyle(color: Colors.red, fontWeight: FontWeight.bold),
                      ),
                    ),
                  const SizedBox(
                    height: 50,
                  ),

                  // Register Button
                  CustomButton(
                    text: tr.register,
                    onPressed: widget.onRegisterPressed,
                  ),
                  const SizedBox(
                    height: 60,
                  ),

                  // Branding
                  BuildBranding()
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
  bool isImageSelected() {
    return _image != null;
  }
}
class ImageUploadWidget extends StatefulWidget {
  final Function(XFile?) onImageSelected;
  final bool isError;

  const ImageUploadWidget({Key? key, required this.onImageSelected,this.isError = false,}) : super(key: key);

  @override
  _ImageUploadWidgetState createState() => _ImageUploadWidgetState();
}

class _ImageUploadWidgetState extends State<ImageUploadWidget> {
  XFile? _image;

  Future<void> _pickImage() async {
    final picker = ImagePicker();
    final pickedFile = await picker.pickImage(source: ImageSource.gallery);

    if (pickedFile != null) {
      setState(() {
        _image = XFile(pickedFile.path);
      });
      widget.onImageSelected(_image);
    }
  }

  Widget _uploadBox({required IconData icon}) {
    return InkWell(
      borderRadius: BorderRadius.circular(150),
      onTap: _pickImage,
      child: DottedBox(
        isError: widget.isError,
        child: _image == null
            ? Icon(icon, size: 100, color: Colors.yellow)
            : CircleAvatar(radius: 150,backgroundImage: FileImage(File(_image!.path))),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return SizedBox(
      width: 150,
      height: 150,
      child: _uploadBox(
        icon: Icons.person,
      ),
    );
  }
}

class DottedBox extends StatelessWidget {
  final Widget child;
  final bool isError;
  const DottedBox({required this.child, this.isError = false, Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return ShaderMask(
      shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
      child: ClipRRect(
        borderRadius: BorderRadius.all(Radius.circular(150)),
        child: Container(
          width: double.infinity,
          padding: const EdgeInsets.all(20),
          decoration: BoxDecoration(
            color: Colors.white12,
            borderRadius: BorderRadius.circular(14),
            border: Border.all(
              color: isError ? Colors.red : Colors.yellow,
              style: BorderStyle.solid,
            ),
          ),
          child: child,
        ),
      ),
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\auth\shared_widgets\shared_widgets.dart
// =======================================================

import 'dart:io';

import 'package:dio/dio.dart';
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:pin_code_fields/pin_code_fields.dart';

import '../../../../core/config/color/app_color.dart';
import '../../../../l10n/app_localizations.dart';

class BuildCard extends StatelessWidget {
  const BuildCard({super.key});

  @override
  Widget build(BuildContext context) {
    return Container(
      height: 350,
      decoration: const BoxDecoration(
          image: DecorationImage(
              image: AssetImage('assets/icons/card_box.png'), fit: BoxFit.fill)),
    );
  }
}

class BuildPincodeTextfield extends StatefulWidget {
  final GlobalKey<BuildPincodeTextfieldState>? pinKey;
  final Function(String)? onChanged;
  final Function(bool)? onVerified;

  const BuildPincodeTextfield({super.key, this.pinKey, this.onChanged, this.onVerified});

  @override
  State<BuildPincodeTextfield> createState() => BuildPincodeTextfieldState();
}

class BuildPincodeTextfieldState extends State<BuildPincodeTextfield> {
  final TextEditingController _pinController = TextEditingController();
  final FocusNode _focusNode = FocusNode();
  bool _showError = false;
  String? _errorMessage;
  bool _isVerifying = false;

  @override
  void initState() {
    super.initState();
    _focusNode.addListener(() {
      if (!_focusNode.hasFocus) {
        _validatePin(_pinController.text);
      }
    });
  }

  @override
  void dispose() {
    super.dispose();
  }

  void _validatePin(String value) {
    if (value.length != 6) {
      setState(() => _errorMessage = 'Please enter a 6-digit PIN code');
    } else {
      setState(() => _errorMessage = null);
    }
  }

  bool isPinValid() {
    return _pinController.text.length == 6 && _errorMessage == null;
  }

  void showError() {
    setState(() => _errorMessage = 'Please enter a 6-digit PIN code');
  }

  Future<void> verifyStarted() async {
    setState(() => _isVerifying = true);
  }

  Future<void> verifyFinished({required bool success, String? message}) async {
    if (!mounted) return;
    setState(() {
      _isVerifying = false;
      _errorMessage = success ? null : (message ?? 'Invalid code');
    });
    widget.onVerified?.call(success);
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final borderColor = _errorMessage == null ? colorScheme.primary : Colors.red;

    return ShaderMask(
      shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          PinCodeTextField(
            key: widget.pinKey,
            appContext: context,
            length: 6,
            controller: _pinController,
            focusNode: _focusNode,
            keyboardType: TextInputType.number,
            textStyle: TextStyle(
              color: colorScheme.primary,
              fontSize: 18,
            ),
            pinTheme: PinTheme(
              selectedBorderWidth: 2,
              inactiveBorderWidth: 2,
              activeBorderWidth: 2,
              shape: PinCodeFieldShape.box,
              borderRadius: BorderRadius.circular(16),
              fieldHeight: 45,
              fieldWidth: 35,
              activeFillColor: colorScheme.primary,
              inactiveColor: colorScheme.primary.withOpacity(0.5),
              selectedColor: borderColor,
              selectedFillColor: colorScheme.primary,
              activeColor: borderColor,
            ),
            onChanged: (value) {
              /// Important: We pass the change to the parent to which we passed onChanged
              widget.onChanged?.call(value);

              /// We also maintain the interior facade
              if (_showError && value.length == 6) {
                setState(() => _showError = false);
              }

              /// Simple local check
              if (value.length != 6) {
                setState(() => _errorMessage = 'Please enter a 6-digit PIN code');
              } else {
                setState(() => _errorMessage = null);
              }
            },
            beforeTextPaste: (text) => true,
          ),

          if (_errorMessage != null)
            Padding(
              padding: const EdgeInsets.only(top: 8),
              child: Text(_errorMessage!, style: const TextStyle(color: Colors.red)),
            ),

          if (_isVerifying) const Padding(padding: EdgeInsets.only(top: 8), child: SizedBox(width: 18, height: 18, child: CircularProgressIndicator(strokeWidth: 2))),
        ],
      ),
    );
  }
}

class BuildRegisterRow extends StatelessWidget {
  const BuildRegisterRow({super.key});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;
    return Row(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        ShaderMask(
          shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
          child: Text(
            tr.dont_have_account,
            style: TextStyle(color: colorScheme.secondary),
          ),
        ),
        GestureDetector(
          onTap: () {
            context.go('/home_register');
          },
          child: ShaderMask(
            shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
            child: Text(
              tr.register,
              style: TextStyle(color: colorScheme.primary),
            ),
          ),
        ),
      ],
    );
  }
}

class BuildLoginRow extends StatelessWidget {
  const BuildLoginRow({super.key});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Row(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        ShaderMask(
          shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
          child: Text(
            tr.have_account,
            style: TextStyle(color: colorScheme.secondary),
          ),
        ),
        GestureDetector(
          onTap: () {
            context.go('/login');
          },
          child: ShaderMask(
            shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
            child: Text(
              tr.login,
              style: TextStyle(color: colorScheme.primary, fontWeight: FontWeight.bold),
            ),
          ),
        ),
      ],
    );
  }
}

class BuildRibbon extends StatelessWidget {
  const BuildRibbon({super.key});

  @override
  Widget build(BuildContext context) {
    return Container(
      height: 200,
      decoration: const BoxDecoration(
        image: DecorationImage(
          image: AssetImage(
            'assets/icons/ribbon.png',
          ),
          fit: BoxFit.fill,
        ),
      ),
    );
  }
}

class BuildTextfield extends StatefulWidget {
  final String label;
  final IconData icon;
  final bool obscure;
  final TextInputType keyboardType;
  final bool haveSuffixEyeIcon;
  final bool onPressedForDate;
  final GlobalKey<FormState>? formKey;
  final TextEditingController? controller;
  final void Function(String)? onChanged;

  const BuildTextfield({
    super.key,
    required this.label,
    required this.icon,
    this.obscure = false,
    this.haveSuffixEyeIcon = false,
    this.onPressedForDate = false,
    this.keyboardType = TextInputType.text,
    this.formKey,
    this.controller,
    this.onChanged,
  });

  @override
  State<BuildTextfield> createState() => _BuildTextfieldState();
}

class _BuildTextfieldState extends State<BuildTextfield> {
  late bool _obscureText;
  late TextInputType _keyboardType;
  late bool _haveSuffixEyeIcon;
  late bool _onPressedForDate;
  late final GlobalKey<FormState>? _formKey;
  late final TextEditingController _internalController;

  TextEditingController get _effectiveController =>
      widget.controller ?? _internalController;

  @override
  void initState() {
    super.initState();
    _obscureText = widget.obscure;
    _keyboardType = widget.keyboardType;
    _haveSuffixEyeIcon = widget.haveSuffixEyeIcon;
    _onPressedForDate = widget.onPressedForDate;
    _formKey = widget.formKey;
    _internalController = TextEditingController();
  }

  @override
  void dispose() {
    _internalController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return ShaderMask(
      shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
      child: TextFormField(
        controller: _effectiveController,
        validator: (data) {
          if (data == null || data.isEmpty) {
            return tr.field_required;
          }
          return null;/// Returning null means the verification was successful
        },
        onChanged: (data) {
          /// We update the form if it exists and pass an external callback if it exists
          if (_formKey != null) {
            _formKey?.currentState?.validate();
          }
          if (widget.onChanged != null) widget.onChanged!(data);
        },
        readOnly: _onPressedForDate == true ? true : false,
        obscureText: _obscureText,
        keyboardType: _keyboardType,
        onTap: () async {
          if (_onPressedForDate) {
            DateTime? pickedDate = await showDatePicker(
              context: context,
              initialDate: DateTime.now(),
              firstDate: DateTime(1900),
              lastDate: DateTime(2100),
            );
            if (pickedDate != null) {
              final formattedDate = "${pickedDate.year.toString().padLeft(4,'0')}-"
                  "${pickedDate.month.toString().padLeft(2,'0')}-"
                  "${pickedDate.day.toString().padLeft(2,'0')}";
              _effectiveController.text = formattedDate;
              if (_formKey != null) _formKey?.currentState?.validate();

              /// Manually call onChanged
              if (widget.onChanged != null) {
                widget.onChanged!(formattedDate);
              }

              if (_formKey != null) _formKey?.currentState?.validate();
            }
          }
        },
        decoration: InputDecoration(
          labelText: widget.label,
          labelStyle: TextStyle(
            color: colorScheme.onSurface.withOpacity(0.6),
          ),
          prefixIcon: ShaderMask(
            shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
            child: Icon(
              widget.icon,
              color: Colors.yellow,
            ),
          ),
          suffixIcon: _haveSuffixEyeIcon == true
              ? ShaderMask(
            shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
            child: GestureDetector(
              onTap: () {
                setState(() {
                  _obscureText = !_obscureText;
                });
              },
              child: Icon(
                _obscureText ? Icons.remove_red_eye_outlined : Icons.remove_red_eye,
                color: Colors.yellow,
              ),
            ),
          )
              : null,
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide(
              color: Colors.yellow,
            ),
          ),
          enabledBorder: OutlineInputBorder(
            borderRadius: const BorderRadius.only(
              topLeft: Radius.circular(30),
              topRight: Radius.circular(8),
              bottomLeft: Radius.circular(8),
              bottomRight: Radius.circular(30),
            ),
            borderSide: BorderSide(
              color: Colors.yellow,
            ),
          ),
          focusedBorder: OutlineInputBorder(
            borderRadius: const BorderRadius.only(
              topLeft: Radius.circular(30),
              topRight: Radius.circular(8),
              bottomLeft: Radius.circular(8),
              bottomRight: Radius.circular(30),
            ),
            borderSide: BorderSide(
              color: Colors.yellow,
              width: 2,
            ),
          ),
          errorBorder: OutlineInputBorder(
            borderRadius: const BorderRadius.only(
              topLeft: Radius.circular(30),
              topRight: Radius.circular(8),
              bottomLeft: Radius.circular(8),
              bottomRight: Radius.circular(30),
            ),
            borderSide: BorderSide(
              color: Colors.red,
              width: 2,
            ),
          ),
          focusedErrorBorder: OutlineInputBorder(
            borderRadius: const BorderRadius.only(
              topLeft: Radius.circular(30),
              topRight: Radius.circular(8),
              bottomLeft: Radius.circular(8),
              bottomRight: Radius.circular(30),
            ),
            borderSide: BorderSide(
              color: Colors.red,
              width: 2,
            ),
          ),
        ),
      ),
    );
  }
}


class BuildVerficationCodeButton extends StatelessWidget {
  final VoidCallback? onPressed;
  const BuildVerficationCodeButton({super.key, this.onPressed});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Align(
      alignment: Alignment.centerLeft,
      child: TextButton.icon(
        onPressed: onPressed,
        icon: ShaderMask(
          shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
          child: Icon(Icons.send, color: colorScheme.primary
          ),
        ),
        label: ShaderMask(
          shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
          child: Text(tr.send_code,
              style: TextStyle(color: colorScheme.primary)),
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\auth\under_review\under_review.dart
// =======================================================

import 'dart:async';
import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import 'package:malaz/presentation/global_widgets/custom_button.dart';
import 'package:modal_progress_hud_nsn/modal_progress_hud_nsn.dart';
import '../../../../core/config/color/app_color.dart';
import '../../../cubits/auth/auth_cubit.dart';

class UnderReview extends StatefulWidget {
  const UnderReview({Key? key}) : super(key: key);

  @override
  State<UnderReview> createState() => _UnderReviewState();
}

class _UnderReviewState extends State<UnderReview> {
  Timer? _timer;
  final int _intervalSeconds = 10; /// We check every 10 seconds
  bool modalProgressHUDisOn = false;

  @override
  void initState() {
    super.initState();
    /// Immediate call first
    _checkNow();

    /// Set up a periodic timer for verification
    _timer = Timer.periodic(Duration(seconds: _intervalSeconds), (_) {
      _checkNow();
    });
  }

  Future<void> _checkNow() async {
    if (modalProgressHUDisOn) return;
    setState(() => modalProgressHUDisOn = true);

    try {
      await context.read<AuthCubit>().checkAuth();

       await Future.delayed(const Duration(milliseconds: 400));
    } catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Verification error : $e')),
        );
      }
    } finally {
      if (!mounted) return;
      setState(() => modalProgressHUDisOn = false);
    }
  }

  @override
  void dispose() {
    _timer?.cancel();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return ModalProgressHUD(
      color: Colors.white,
      inAsyncCall: modalProgressHUDisOn,
      child: Scaffold(
        backgroundColor: ColorScheme.of(context).surface,
        body: Center(
          child: Padding(
            padding: const EdgeInsets.symmetric(horizontal:24.0),
            child: Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                ShaderMask(
                  shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                  child: Icon(
                    Icons.hourglass_top_rounded,
                    size: 80,
                    color: Colors.white,
                  ),
                ),
                const SizedBox(
                  height: 16,
                ),
                ShaderMask(
                  shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                  child: Text(
                    'Your request is under review by the application administrators. We will notify you when it is approved.',
                    textAlign: TextAlign.center,
                    style: TextStyle(fontSize: 16, color: Colors.grey),
                  ),
                ),
                const SizedBox(
                  height: 100,
                ),
                SizedBox(
                  width: 250,
                  height: 50,
                  child: CustomButton(
                    text: 'Check Now',
                    onPressed: modalProgressHUDisOn ? null : _checkNow, /// Disable the button during execution
                  ),
                ),
                const SizedBox(
                  height: 14,
                ),
                SizedBox(
                  width: 250,
                  height: 50,
                  child: CustomButton(
                    text: 'Log Out',
                    onPressed: () => context.read<AuthCubit>().logout(),
                  ),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\booking\booking_screen.dart
// =======================================================


import 'package:flutter/material.dart';

import '../../../l10n/app_localizations.dart';

enum BookingStatus { accepted, pending, cancelled }

class BookingModel {
  final String id;
  final String title;
  final String location;
  final String date;
  final double price;
  final BookingStatus status;
  final String imageUrl;

  BookingModel({
    required this.id,
    required this.title,
    required this.location,
    required this.date,
    required this.price,
    required this.status,
    required this.imageUrl,
  });
}

class BookingsScreen extends StatelessWidget {
  const BookingsScreen({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    final bookings = [
      BookingModel(id: 'BK-001', title: 'Modern Downtown Apartment', location: 'Downtown', date: 'Jan 15, 2024', price: 1200, status: BookingStatus.accepted, imageUrl: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=200&fit=crop'),
      BookingModel(id: 'BK-002', title: 'Luxury Penthouse', location: 'Uptown', date: 'Feb 1, 2024', price: 2500, status: BookingStatus.pending, imageUrl: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=200&fit=crop'),
      BookingModel(id: 'BK-003', title: 'Cozy Studio', location: 'Midtown', date: 'Dec 20, 2023', price: 900, status: BookingStatus.cancelled, imageUrl: 'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=200&fit=crop'),
    ];

    return Scaffold(
      backgroundColor: colorScheme.background,
      appBar: AppBar(
        title: Text(tr.my_bookings, style: const TextStyle(fontWeight: FontWeight.bold)),
        backgroundColor: colorScheme.surface,
        elevation: 0,
        foregroundColor: colorScheme.onSurface,
      ),
      body: ListView.separated(
        padding: const EdgeInsets.all(20),
        itemCount: bookings.length,
        separatorBuilder: (_, __) => const SizedBox(height: 20),
        itemBuilder: (context, index) {
          return _BookingCard(booking: bookings[index]);
        },
      ),
    );
  }
}

class _BookingCard extends StatelessWidget {
  final BookingModel booking;

  const _BookingCard({Key? key, required this.booking}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    Color statusColor;
    Color statusBg;
    String statusText;

    switch (booking.status) {
      case BookingStatus.accepted:
        statusColor = Colors.green.shade700;
        statusBg = Colors.green.shade50;
        statusText = 'Accepted'; // These should be translated too if needed
        break;
      case BookingStatus.pending:
        statusColor = Colors.orange.shade700;
        statusBg = Colors.orange.shade50;
        statusText = 'Pending';
        break;
      case BookingStatus.cancelled:
        statusColor = colorScheme.error;
        statusBg = colorScheme.error.withOpacity(0.1);
        statusText = 'Cancelled';
        break;
    }

    return Opacity(
      opacity: booking.status == BookingStatus.cancelled ? 0.6 : 1.0,
      child: Container(
        decoration: BoxDecoration(
          color: colorScheme.surface,
          borderRadius: BorderRadius.circular(24),
          boxShadow: [BoxShadow(color: Colors.black.withOpacity(0.05), blurRadius: 15, offset: const Offset(0, 5))],
        ),
        child: Padding(
          padding: const EdgeInsets.all(20),
          child: Column(
            children: [
              Row(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  Container(
                    padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
                    decoration: BoxDecoration(color: statusBg, borderRadius: BorderRadius.circular(10)),
                    child: Text(statusText, style: TextStyle(color: statusColor, fontWeight: FontWeight.bold, fontSize: 12)),
                  ),
                  Text('#${booking.id}', style: TextStyle(color: colorScheme.onSurface.withOpacity(0.6), fontSize: 12)),
                ],
              ),
              const SizedBox(height: 16),
              Row(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  ClipRRect(
                    borderRadius: BorderRadius.circular(16),
                    child: Image.network(booking.imageUrl, width: 80, height: 80, fit: BoxFit.cover),
                  ),
                  const SizedBox(width: 16),
                  Expanded(
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text(booking.title, style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16, color: colorScheme.onSurface), maxLines: 1, overflow: TextOverflow.ellipsis),
                        const SizedBox(height: 4),
                        Row(
                          children: [
                            Icon(Icons.location_on, size: 14, color: colorScheme.primary),
                            const SizedBox(width: 4),
                            Text(booking.location, style: TextStyle(fontSize: 12, color: colorScheme.onSurface.withOpacity(0.6))),
                          ],
                        ),
                        const SizedBox(height: 8),
                        Text('Check-in: ${booking.date}', style: TextStyle(fontSize: 12, color: colorScheme.onSurface.withOpacity(0.6), fontWeight: FontWeight.w500)),
                      ],
                    ),
                  ),
                  Column(
                    children: [
                      Text('\$${booking.price.toInt()}', style: TextStyle(fontWeight: FontWeight.bold, fontSize: 18, color: colorScheme.primary)),
                      Text('/mo', style: TextStyle(fontSize: 10, color: Colors.grey.shade400)),
                    ],
                  )
                ],
              ),
              if (booking.status != BookingStatus.cancelled) ...[
                const SizedBox(height: 20),
                Row(
                  children: [
                    Expanded(
                      child: OutlinedButton.icon(
                        onPressed: () {},
                        icon: const Icon(Icons.remove_red_eye, size: 16),
                        label: const Text('Details'), // This should be translated
                        style: OutlinedButton.styleFrom(
                          foregroundColor: colorScheme.primary,
                          side: BorderSide(color: colorScheme.primary),
                          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
                        ),
                      ),
                    ),
                    const SizedBox(width: 12),
                    Expanded(
                      child: ElevatedButton.icon(
                        onPressed: () {},
                        icon: const Icon(Icons.chat, size: 16),
                        label: const Text('Chat'), // This should be translated
                        style: ElevatedButton.styleFrom(
                          backgroundColor: Colors.blue.withOpacity(0.1),
                          foregroundColor: Colors.blue.shade700,
                          elevation: 0,
                          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
                        ),
                      ),
                    ),
                  ],
                )
              ]
            ],
          ),
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\chats\chats_screen.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:malaz/presentation/screens/chats/ChatWithAPerson.dart';

class ChatModel {
  final String name;
  final String message;
  final String time;
  final String imageUrl;
  final int unreadCount;

  ChatModel({required this.name, required this.message, required this.time, required this.imageUrl, this.unreadCount = 0});
}

class ChatsScreen extends StatelessWidget {
  const ChatsScreen({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    // Mock Data
    final List<ChatModel> chats = [
      ChatModel(name: 'Sarah Johnson', message: 'Yes, the apartment is still available...', time: '2 min ago', unreadCount: 2, imageUrl: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&fit=crop'),
      ChatModel(name: 'Michael Chen', message: 'Thank you for your interest.', time: '1 hour ago', imageUrl: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&fit=crop'),
    ];

    return Scaffold(
      backgroundColor: colorScheme.background,
      appBar: AppBar(
        toolbarHeight: 80,
        title: const Text('Chat', style: TextStyle(fontWeight: FontWeight.bold,fontSize: 36)),
        backgroundColor: colorScheme.primary,
        foregroundColor: colorScheme.surface,
      ),
      body: ListView(
        children: [
          _buildHeader(colorScheme: colorScheme, title: 'Activities'),
          _buildActivitiesListView(colorScheme: colorScheme, chats: chats),
          _buildHeader(colorScheme: colorScheme, title: 'Messages'),
          _buildMessagesListView(chats: chats, colorScheme: colorScheme),
        ]
      ),
    );
  }
}

class _buildMessagesListView extends StatelessWidget {
  const _buildMessagesListView({
    super.key,
    required this.chats,
    required this.colorScheme,
  });

  final List<ChatModel> chats;
  final ColorScheme colorScheme;

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      shrinkWrap: true,
      physics: NeverScrollableScrollPhysics(),
      itemCount: 12,//chats.length,
      itemBuilder: (context, index) {
        final chat = chats[0];
        return Padding(
          padding: EdgeInsets.all(8),
          child: GestureDetector(
            onTap: (){
              Navigator.push(context, MaterialPageRoute(builder: (context) => const ChatWithAPerson()));
              //context.push('/one_chat');
            },
            child: Container(
                padding: const EdgeInsets.all(16),
                decoration: BoxDecoration(
                  color: colorScheme.surface,
                  borderRadius: BorderRadius.circular(20),
                  border: BoxBorder.all(color: colorScheme.primary),
                  boxShadow: [BoxShadow(color: Colors.black.withOpacity(0.05), blurRadius: 10, offset: const Offset(0, 4))],
                ),
                child: Row(
                  children: [
                    CircleAvatar(
                      radius: 30,
                      backgroundImage: NetworkImage(chat.imageUrl),
                    ),
                    const SizedBox(width: 16),
                    Expanded(
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          Row(
                            mainAxisAlignment: MainAxisAlignment.spaceBetween,
                            children: [
                              Text(chat.name, style: TextStyle(fontWeight: FontWeight.bold, fontSize: 16, color: colorScheme.primary)),
                              Text(chat.time, style: TextStyle(fontSize: 12, color: colorScheme.onSurface.withOpacity(0.6))),
                            ],
                          ),
                          const SizedBox(height: 4),
                          Text(
                            chat.message,
                            maxLines: 1,
                            overflow: TextOverflow.ellipsis,
                            style: TextStyle(
                              color: chat.unreadCount > 0 ? colorScheme.onSurface : colorScheme.onSurface.withOpacity(0.6),
                              fontWeight: chat.unreadCount > 0 ? FontWeight.bold : FontWeight.normal,
                            ),
                          ),
                        ],
                      ),
                    ),
                    if (chat.unreadCount > 0) ...[
                      const SizedBox(width: 12),
                      Container(
                        padding: const EdgeInsets.all(8),
                        decoration: BoxDecoration(color: colorScheme.primary, shape: BoxShape.circle),
                        child: Text(
                          chat.unreadCount.toString(),
                          style: TextStyle(color: colorScheme.onPrimary, fontSize: 12, fontWeight: FontWeight.bold),
                        ),
                      ),
                    ]
                  ],
                ),
            ),
          ),
        );
      }
    );
  }
}

class _buildActivitiesListView extends StatelessWidget {
  const _buildActivitiesListView({
    super.key,
    required this.colorScheme,
    required this.chats,
  });

  final ColorScheme colorScheme;
  final List<ChatModel> chats;

  @override
  Widget build(BuildContext context) {
    return SizedBox(
      height: 90,
      child: ListView.builder(
        scrollDirection: Axis.horizontal,
        itemCount: 12,
        itemBuilder: (context, index){
          return Padding(
            padding: const EdgeInsets.only(left: 10),
            child: CircleAvatar(
              radius: 43,
              backgroundColor: colorScheme.primary,
              child: CircleAvatar(
                radius: 40,
                backgroundColor: colorScheme.surface,
                child: CircleAvatar(
                  radius: 35,
                  backgroundImage: NetworkImage(chats[0].imageUrl),
                ),
              ),
            ),
          );
        },
      ),
    );
  }
}

class _buildHeader extends StatelessWidget {
  const _buildHeader({
    super.key,
    required this.colorScheme, required this.title,
  });

  final ColorScheme colorScheme;
  final String title;

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16),
      child: Text(
        title,
        style: TextStyle(
          color: colorScheme.primary,
          fontSize: 20,
          fontWeight: FontWeight.bold,
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\chats\ChatWithAPerson.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';

class ChatWithAPerson extends StatelessWidget {

  const ChatWithAPerson({super.key});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    return Scaffold(
      backgroundColor: colorScheme.surface,
      appBar: AppBar(
        leading: IconButton(onPressed: (){
          context.pop();
        }, icon: Icon(Icons.arrow_back_sharp,size: 36,)),
        toolbarHeight: 80,
        title: Row(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            CircleAvatar(
              radius: 28,
              backgroundImage: NetworkImage('https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&fit=crop'),
              //backgroundColor: colorScheme.surface,
            ),
            SizedBox(
              width: 18,
            ),
            Text(
              'Chat Name',
              style: TextStyle(
                fontWeight: FontWeight.bold,
                fontSize: 24,
              ),
            ),
          ],
        ),
        backgroundColor: colorScheme.primary,
        foregroundColor: colorScheme.surface,
      ),
      body: Stack(
        children: [
          Positioned.fill(
            child: Opacity(
              opacity: 0.1,
              child: Transform.rotate(
                angle: 0.36,
                child: GridView.builder(
                  physics: NeverScrollableScrollPhysics(),
                  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
                    crossAxisCount: 4,
                    mainAxisSpacing: 60,
                    crossAxisSpacing: 60,
                  ),
                  itemBuilder: (context, index) {
                    return Transform.rotate(
                      angle: (index % 2 == 0) ? 0.3 : -0.3, // دورة خفيفة يمين ويسار
                      child: Image.asset(
                        'assets/icons/key_logo.png',
                        color: colorScheme.primary,
                        //colorBlendMode: BlendMode.modulate,
                        fit: BoxFit.contain,
                      ),
                    );
                  },
                  itemCount: 50, // عدد كاف لتغطية الخلفية
                ),
              ),
            ),
          ),
          Column(
            children: [
              Expanded(
                child: ListView(
                  children: [
                    ChatBubble(),
                    SizedBox(height: 16,),
                    ChatBubbleForFriend(),
                  ],
                ),
              ),
              Padding(
                padding: const EdgeInsets.all(16),
                child: TextField(
                  //controller: controller,
                  // onSubmitted: (data) async {
                  //   if(data.trim().isEmpty) return;
                  //   await messages.add({
                  //     'message': data,
                  //     'createdAt': DateTime.now(),
                  //     'id': email,
                  //   });
                  // controller.clear();

                  //   await Future.delayed(Duration(milliseconds: 100));
                  //   _controller.animateTo(
                  //     _controller.position.maxScrollExtent,
                  //     duration: Duration(milliseconds: 300),
                  //     curve: Curves.easeOut,
                  //   );
                  // },
                  decoration: InputDecoration(
                    hintText: 'Send Message...',
                    hintStyle: TextStyle(color: colorScheme.secondary),
                    suffixIcon: Icon(
                      Icons.send,
                      color: colorScheme.primary,// kPrimaryColor,
                    ),
                    enabledBorder: OutlineInputBorder(
                        borderRadius: BorderRadius.circular(16),
                        borderSide: BorderSide(
                          color: colorScheme.primary,// kPrimaryColor,
                        )
                    ),
                    border: OutlineInputBorder(
                        borderRadius: BorderRadius.circular(16),
                        borderSide: BorderSide(
                          color: colorScheme.primary,// kPrimaryColor,
                        )
                    ),
                  ),
                ),
              ),
            ],
          ),
        ],
      ),
    );
  }
}


class ChatBubble extends StatelessWidget {
  ChatBubble ({
    super.key,
    //required this.message,
    //required this.userInfo,
  });
  //final MessageModel message;
  //final UserModel userInfo;
  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return Align(
      alignment: Alignment.centerLeft,
      child: Container(
        padding: const EdgeInsets.only(
          left: 16,
          right: 16,
          top: 16,
          bottom: 8,
        ),
        margin: const EdgeInsets.only(
          top: 16,
          left: 16,
          right: 16,
        ),
        constraints: BoxConstraints(
          maxWidth: MediaQuery.of(context).size.width * 0.7,
        ),
        decoration: BoxDecoration(
          boxShadow: [BoxShadow(color: Colors.black.withOpacity(0.09), blurRadius: 10, offset: const Offset(0, 4))],
          border: BoxBorder.all(color: colorScheme.primary),
          borderRadius: const BorderRadius.only(
            topLeft: Radius.circular(16),
            topRight: Radius.circular(16),
            bottomRight: Radius.circular(16),
          ),
          color: Colors.white,
        ),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.end,
          children: [
            Text(
              'Hello My Name is abrar.... dkjsehuc dekfjwe beuwh',
              //message.message,
              style: TextStyle(
                color: Colors.black,
                fontSize: 18,
              ),
            ),
            Text('20:00', style: TextStyle(color: colorScheme.secondary,fontSize: 10),),
          ],
        ),
      ),
    );
  }
}
class ChatBubbleForFriend extends StatelessWidget {
  //final MessageModel message;

  ChatBubbleForFriend ({
    super.key,
    //required this.message,
  });
  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return Align(
      alignment: Alignment.centerRight,
      child: Container(
        padding: EdgeInsets.only(
          left: 16,
          right: 16,
          top: 16,
          bottom: 8,
        ),
        margin: EdgeInsets.only(
          top: 4,
          left: 16,
          right: 16,
        ),
        constraints: BoxConstraints(
          maxWidth: MediaQuery.of(context).size.width * 0.7,
        ),
        decoration: BoxDecoration(
          boxShadow: [BoxShadow(color: Colors.black.withOpacity(0.09), blurRadius: 10, offset: const Offset(0, 4))],
          borderRadius: BorderRadius.only(
            topLeft: Radius.circular(16),
            topRight: Radius.circular(16),
            bottomLeft: Radius.circular(16),
          ),
          color: colorScheme.primary,
        ),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.end,
          children: [
            Text(
              'Hello my friend.. fdg fbd fdgr regr regger rerg rgeger reg ',
              //message.message,
              style: TextStyle(
                color: Colors.white,
                fontSize: 18,
              ),
            ),
            Text('20:00', style: TextStyle(color: colorScheme.surface,fontSize: 10),),
          ],
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\details\details_screen.dart
// =======================================================


import 'package:flutter/material.dart';
import '../../../domain/entities/apartment.dart';
import '../../global_widgets/custom_button.dart';

class DetailsScreen extends StatelessWidget {
  final Apartment apartment;

  const DetailsScreen({super.key, required this.apartment});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    return Scaffold(
      backgroundColor: colorScheme.background,
      body: CustomScrollView(
        slivers: [
          SliverAppBar(
            expandedHeight: 300,
            pinned: true,
            backgroundColor: colorScheme.primary,
            flexibleSpace: FlexibleSpaceBar(
              background: Hero(
                tag: apartment.id,
                child: Image.network(apartment.mainImageUrl, fit: BoxFit.cover),
              ),
            ),
            leading: IconButton(
              icon: Container(
                padding: const EdgeInsets.all(8),
                decoration: BoxDecoration(color: colorScheme.surface, shape: BoxShape.circle),
                child: Icon(Icons.arrow_back, color: colorScheme.onSurface, size: 20),
              ),
              onPressed: () => Navigator.pop(context),
            ),
          ),
          SliverToBoxAdapter(
            child: Container(
              padding: const EdgeInsets.all(24),
              decoration: BoxDecoration(
                color: colorScheme.background,
                borderRadius: const BorderRadius.vertical(top: Radius.circular(30)),
              ),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // Title & Price
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Expanded(
                        child: Text(
                          apartment.title,
                          style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold, color: colorScheme.onBackground),
                        ),
                      ),
                      const SizedBox(width: 16),
                      Column(
                        crossAxisAlignment: CrossAxisAlignment.end,
                        children: [
                          Text(
                            '\$${apartment.price.toInt()}',
                            style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold, color: colorScheme.primary),
                          ),
                          Text('/month', style: TextStyle(color: colorScheme.onBackground.withOpacity(0.6))),
                        ],
                      )
                    ],
                  ),
                  const SizedBox(height: 24),

                  // Stats Grid
                  Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      _StatBadge(
                        icon: Icons.bed,
                        label: '${apartment.bedrooms} Beds',
                        color: Colors.green,
                      ),
                      _StatBadge(
                        icon: Icons.bathtub,
                        label: '${apartment.bathrooms} Baths',
                        color: Colors.blue,
                      ),
                      _StatBadge(
                        icon: Icons.square_foot,
                        label: '${apartment.area} sqft',
                        color: Colors.purple,
                      ),
                    ],
                  ),
                  const SizedBox(height: 24),

                  Text('Description', style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold, color: colorScheme.onBackground)),
                  const SizedBox(height: 12),
                  Text(
                    'Beautiful modern apartment in the heart of downtown. This stunning unit features high ceilings, hardwood floors, and floor-to-ceiling windows.',
                    style: TextStyle(color: colorScheme.onBackground.withOpacity(0.6), height: 1.5),
                  ),

                  const SizedBox(height: 32),

                  // Actions
                  Row(
                    children: [
                      Container(
                        padding: const EdgeInsets.all(16),
                        decoration: BoxDecoration(
                          border: Border.all(color: colorScheme.primary),
                          borderRadius: BorderRadius.circular(16),
                        ),
                        child: Icon(Icons.favorite_border, color: colorScheme.primary),
                      ),
                      const SizedBox(width: 16),
                      const Expanded(
                        child: CustomButton(
                          text: 'Book Now',
                          onPressed: null, // Deactivated for now
                        ),
                      ),
                    ],
                  ),
                  const SizedBox(height: 20),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}

class _StatBadge extends StatelessWidget {
  final IconData icon;
  final String label;
  final Color color;

  const _StatBadge({required this.icon, required this.label, required this.color});

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 16),
      decoration: BoxDecoration(
        color: color.withOpacity(0.1),
        borderRadius: BorderRadius.circular(16),
      ),
      child: Column(
        children: [
          Icon(icon, color: color, size: 28),
          const SizedBox(height: 8),
          Text(
            label,
            style: TextStyle(fontWeight: FontWeight.bold, color: Theme.of(context).colorScheme.onBackground),
          ),
        ],
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\favorites\favorites_screen.dart
// =======================================================


import 'package:flutter/material.dart';
import '../../../data/datasources/apartments/apartments_source.dart';
import '../../../l10n/app_localizations.dart';
import '../../global_widgets/apartment_card.dart';

class FavoritesScreen extends StatelessWidget {
  const FavoritesScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Text("sara working on it");
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\home\home_screen.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import 'package:malaz/core/constants/app_constants.dart';
import 'package:shimmer/shimmer.dart';
import '../../../../domain/entities/apartment.dart';
import '../../../core/config/routes/route_info.dart';
import '../../../l10n/app_localizations.dart';
import '../../cubits/home/home_cubit.dart';
import '../../global_widgets/apartment_cards/apartment_card.dart';
import '../side_drawer/app_drawer.dart';
import '../../global_widgets/apartment_cards/apartment_shimmer.dart';

class HomeScreen extends StatelessWidget {
  const HomeScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return const HomeView();
  }
}

class HomeView extends StatefulWidget {
  const HomeView({super.key});

  @override
  State<HomeView> createState() => _HomeViewState();
}

class _HomeViewState extends State<HomeView> {
  final GlobalKey<ScaffoldState> _scaffoldKey = GlobalKey<ScaffoldState>();
  final ScrollController _scrollController = ScrollController();

  @override
  void initState() {
    super.initState();
    _scrollController.addListener(_onScroll);

    final cubit = context.read<HomeCubit>();
    if (cubit.state is HomeInitial) {
      cubit.loadApartments();
    }
  }

  @override
  void dispose() {
    _scrollController.dispose();
    super.dispose();
  }

  void _onScroll() {
    if (_isBottom) {
      context.read<HomeCubit>().loadApartments(loadNext: true);
    }
  }

  bool get _isBottom {
    if (!_scrollController.hasClients) return false;
    final maxScroll = _scrollController.position.maxScrollExtent;
    final currentScroll = _scrollController.offset;
    return currentScroll >= (maxScroll * 0.9);
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    return Scaffold(
      key: _scaffoldKey,
      backgroundColor: colorScheme.background,
      drawer: const AppDrawer(),
      body: SafeArea(
        child: Column(
          children: [
            _BuildHomeHeader(scaffoldKey: _scaffoldKey),
            const _BuildFilterList(),
            const SizedBox(height: 10),
            Expanded(
              child: RefreshIndicator(
                onRefresh: () async {
                  await context.read<HomeCubit>().loadApartments(isRefresh: true);
                },
                child: _BuildHomeBody(scrollController: _scrollController),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

/// ============================================================================
/// [UI_BUILDING_WIDGETS]

/// *[contains]
/// - [_BuildHomeHeader]
/// - [_BuildFilterList]
/// - [_BuildHomeBody]
/// - [_BuildApartmentList]
/// - [_BuildBottomLoader]
/// - [_BuildErrorView]
/// - [_BuildAddPropertyFab]
///
class _BuildHomeHeader extends StatelessWidget {
  final GlobalKey<ScaffoldState> scaffoldKey;

  const _BuildHomeHeader({required this.scaffoldKey});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return Padding(
      padding: const EdgeInsets.all(20),
      child: Row(
        children: [
          _BuildIconButton(
            icon: Icons.menu,
            onTap: () => scaffoldKey.currentState?.openDrawer(),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Container(
              padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),
              decoration: BoxDecoration(
                color: colorScheme.surface,
                borderRadius: BorderRadius.circular(16),
                border: Border.all(color: Colors.grey.withOpacity(0.2)),
              ),
              child: Row(
                children: [
                  Icon(Icons.search, color: colorScheme.onSurface.withOpacity(0.5)),
                  const SizedBox(width: 8),
                  Text( /// TODO: this's must be a text field
                    'Search apartments...',
                    style: TextStyle(color: colorScheme.onSurface.withOpacity(0.5)),
                  ),
                ],
              ),
            ),
          ),
        ],
      ),
    );
  }
}

class _BuildFilterList extends StatelessWidget {
  const _BuildFilterList();

  @override
  Widget build(BuildContext context) {
    return SizedBox(
      height: 36,
      child: ListView(
        scrollDirection: Axis.horizontal,
        padding: const EdgeInsets.symmetric(horizontal: 20),
        children: const [
          _BuildFilterChip(label: 'All', isSelected: true),
          _BuildFilterChip(label: 'Near Me'),
          _BuildFilterChip(label: 'High Rated'),
          _BuildFilterChip(label: 'Newest'),
        ],
      ),
    );
  }
}

class _BuildHomeBody extends StatelessWidget {
  final ScrollController scrollController;

  const _BuildHomeBody({required this.scrollController});

  @override
  Widget build(BuildContext context) {
    return BlocBuilder<HomeCubit, HomeState>(
      builder: (context, state) {
        if (state is HomeLoading) {
          return const Center(child: _BuildShimmerLoading());
        }

        if (state is HomeError) {
          return _BuildErrorView(message: state.message);
        }

        if (state is HomeLoaded) {
          if (state.apartments.isEmpty) {
            return const _BuildErrorView(message: 'No apartments found!');
          }
          return _BuildApartmentList(
            apartments: state.apartments,
            hasReachedMax: state.hasReachedMax,
            scrollController: scrollController,
          );
        }

        return const SizedBox.shrink();
      },
    );
  }
}

class _BuildApartmentList extends StatelessWidget {
  final List<Apartment> apartments;
  final bool hasReachedMax;
  final ScrollController scrollController;

  const _BuildApartmentList({
    required this.apartments,
    required this.hasReachedMax,
    required this.scrollController,
  });

  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      controller: scrollController,
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),
      itemCount: hasReachedMax ? apartments.length : apartments.length + 1,
      itemBuilder: (context, index) {
        if (index >= apartments.length) {
          return const _BuildBottomLoader();
        }

        final apartment = apartments[index];
        return ApartmentCard(
          apartment: apartment,
          onTap: () {
            context.pushNamed(RouteNames.details, extra: apartment);
          },
        );
      },
    );
  }
}

class _BuildBottomLoader extends StatelessWidget {
  const _BuildBottomLoader();

  @override
  Widget build(BuildContext context) {
    return const Padding(
      padding: EdgeInsets.all(16.0),
      child: Center(child: CircularProgressIndicator()),
    );
  }
}


/// [_BuildErrorView]
/// A modern error state widget with an illustration, clear translated message, and retry button.
class _BuildErrorView extends StatelessWidget {
  final String message;

  const _BuildErrorView({required this.message});

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);

    String displayMessage = message;

    if (message == AppConstants.networkFailureKey) {
      displayMessage = AppLocalizations.of(context).network_error_message;
    } else if(message == AppConstants.cancelledFailureKey) {
      displayMessage = AppLocalizations.of(context).request_cancelled_error_message;
    } else {
      displayMessage = AppLocalizations.of(context).unexpected_error_message;
    }

    return Center(
      child: SingleChildScrollView(
        padding: const EdgeInsets.all(32),
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Container(
              padding: const EdgeInsets.all(24),
              decoration: BoxDecoration(
                color: theme.colorScheme.error.withOpacity(0.1),
                shape: BoxShape.circle,
              ),
              child: Icon(
                Icons.cloud_off_rounded,
                size: 64,
                color: theme.colorScheme.error,
              ),
            ),

            const SizedBox(height: 24),

            Text(
              AppLocalizations.of(context).warring,
              style: theme.textTheme.headlineMedium?.copyWith(
                fontWeight: FontWeight.bold,
                color: theme.colorScheme.onSurface,
              ),
            ),

            const SizedBox(height: 12),

            Text(
              displayMessage,
              textAlign: TextAlign.center,
              style: theme.textTheme.bodyLarge?.copyWith(
                color: theme.colorScheme.onSurface.withOpacity(0.7),
                height: 1.5,
              ),
            ),

            const SizedBox(height: 32),

            SizedBox(
              width: 200,
              height: 54,
              child: ElevatedButton.icon(
                onPressed: () {
                  context.read<HomeCubit>().loadApartments(isRefresh: true);
                },
                style: ElevatedButton.styleFrom(
                  backgroundColor: theme.colorScheme.primary,
                  foregroundColor: theme.colorScheme.onPrimary,
                  elevation: 4,
                  shadowColor: theme.colorScheme.primary.withOpacity(0.4),
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(16),
                  ),
                ),
                icon: const Icon(Icons.refresh_rounded),
                label: Text(
                  AppLocalizations.of(context).retry,
                  style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
                ),
              ),
            ),
          ],
        ),
      ),
    );
  }
}

// !important note : do not uncomment this block it's cause a failure in
// !bottom bar navigation

/*class _BuildAddPropertyFab extends StatelessWidget {
  const _BuildAddPropertyFab();

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return FloatingActionButton(
      heroTag: 'add_property_fab',
      onPressed: () {
        context.pushNamed(RouteNames.addProperty);
      },
      backgroundColor: colorScheme.primary,
      shape: const CircleBorder(),
      child: Icon(Icons.add, color: colorScheme.onPrimary, size: 30),
    );
  }
}*/


/// [UI_BUILDING_SUB_WIDGET]
/// *[contains]
///
/// - [_BuildIconButton]
/// - [_BuildFilterChip]

class _BuildIconButton extends StatelessWidget {
  final IconData icon;
  final VoidCallback onTap;
  final Color? color;
  final Color? iconColor;

  const _BuildIconButton({required this.icon, required this.onTap, this.color, this.iconColor});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return GestureDetector(
      onTap: onTap,
      child: Container(
        padding: const EdgeInsets.all(12),
        decoration: BoxDecoration(
            color: color ?? colorScheme.surface,
            borderRadius: BorderRadius.circular(12),
            border: Border.all(color: Colors.grey.withOpacity(0.2))),
        child: Icon(icon, color: iconColor ?? colorScheme.onSurface.withOpacity(0.7)),
      ),
    );
  }
}

class _BuildFilterChip extends StatelessWidget {
  final String label;
  final bool isSelected;

  const _BuildFilterChip({required this.label, this.isSelected = false});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    return Container(
      margin: const EdgeInsets.only(right: 10),
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 8),
      decoration: BoxDecoration(
        color: isSelected ? colorScheme.secondary : colorScheme.surface,
        borderRadius: BorderRadius.circular(15),
        border: Border.all(
          color: isSelected ? colorScheme.secondary : Colors.grey.withOpacity(0.3),
        ),
      ),
      child: Text(
        label,
        style: TextStyle(
            color: isSelected ? colorScheme.onPrimary : colorScheme.onSurface.withOpacity(0.7),
            fontWeight: FontWeight.bold),
      ),
    );
  }
}

class _BuildShimmerLoading extends StatelessWidget {
  const _BuildShimmerLoading();

  @override
  Widget build(BuildContext context) {
    final isDark = Theme.of(context).brightness == Brightness.dark;

    return ListView.builder(
      padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 10),
      itemCount: AppConstants.numberOfApartmentsEachRequest,
      itemBuilder: (context, index) {
        return Shimmer.fromColors(
          baseColor: isDark ? Colors.grey[800]! : Colors.grey[300]!,
          highlightColor: isDark ? Colors.grey[700]! : Colors.grey[100]!,
          child:  BuildShimmerCard(),
        );
      },
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\main_wrapper\main_wrapper.dart
// =======================================================

import 'package:curved_navigation_bar/curved_navigation_bar.dart';
import 'package:flutter/material.dart';

// تأكد من صحة هذه المسارات بناءً على بنية ملفاتك
import '../booking/booking_screen.dart';
import '../chats/chats_screen.dart';
import '../favorites/favorites_screen.dart';
import '../home/home_screen.dart';
import '../manage_property/manage_property.dart'; // هذا الملف يجب أن يحتوي على ManagePropertiesScreen
import '../side_drawer/app_drawer.dart';

class MainWrapper extends StatefulWidget {
  const MainWrapper({super.key});

  @override
  State<MainWrapper> createState() => _MainWrapperState();
}

class _MainWrapperState extends State<MainWrapper> {
  int _currentIndex = 0;

  // قائمة الصفحات مرتبة حسب الترتيب في شريط التنقل
  final List<Widget> _screens = const [
    HomeScreen(),             // 0
    ChatsScreen(),            // 1
    FavoritesScreen(),        // 2
    BookingsScreen(),         // 3
    ManagePropertiesScreen(), // 4
  ];

  final GlobalKey<CurvedNavigationBarState> _bottomNavigationKey = GlobalKey();

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    // إعداد ألوان الأيقونات بناءً على الثيم


    return SafeArea(child:
      Scaffold(
      // تم حذف الـ FloatingActionButton من هنا بناءً على طلبك
      drawer: const AppDrawer(),
      body: IndexedStack(
        index: _currentIndex,
        children: _screens,
      ),
      bottomNavigationBar: CurvedNavigationBar(
        key: _bottomNavigationKey,
        index: _currentIndex,
        height: 45,
        items: <Widget>[
          Icon(Icons.home_outlined,
              size: _currentIndex == 0 ? 30:24,color: colorScheme.surface,),
          Icon(Icons.chat_bubble_outline,
              size: _currentIndex == 1 ? 30:24,color: colorScheme.surface,),
          Icon(Icons.favorite_outline,
              size: _currentIndex == 2 ? 30:24,color: colorScheme.surface,),
          Icon(Icons.calendar_today_outlined,
              size: _currentIndex == 3 ? 30:24,color: colorScheme.surface,),
          Icon(Icons.person_outline,
              size: _currentIndex == 4 ? 30:24,color: colorScheme.surface,),
        ],
        color: colorScheme.secondary,
        buttonBackgroundColor: colorScheme.primary,
        backgroundColor: Colors.transparent,
        onTap: (index) {
          setState(() {
            _currentIndex = index;
          });
        },
      ),
    ));
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\manage_property\manage_property.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:smooth_page_indicator/smooth_page_indicator.dart';
import 'package:malaz/presentation/cubits/home/home_cubit.dart';
import '../../../core/config/color/app_color.dart';
import '../../global_widgets/apartment_card.dart';
import '../details/details_screen.dart';
import '../property/add_property.dart';

class ManagePropertiesScreen extends StatefulWidget {
  const ManagePropertiesScreen({super.key});

  @override
  State<ManagePropertiesScreen> createState() => _ManagePropertiesScreenState();
}

class _ManagePropertiesScreenState extends State<ManagePropertiesScreen> {
  final PageController _pageController = PageController();
  int _currentPage = 0;

  @override
  void initState() {
    super.initState();
    _pageController.addListener(() {
      int next = _pageController.page!.round();
      if (_currentPage != next) {
        setState(() {
          _currentPage = next;
        });
      }
    });
  }

  @override
  void dispose() {
    _pageController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    return Scaffold(
      floatingActionButtonLocation: FloatingActionButtonLocation.startFloat,
      floatingActionButton: _currentPage == 0
          ? FloatingActionButton(
        heroTag: 'manage_property_fab',
        onPressed: () {
          Navigator.push(
            context,
            MaterialPageRoute(
                builder: (context) => const AddPropertyScreen()),
          );
        },
        backgroundColor: colorScheme.primary,
        shape: const CircleBorder(),
        child: Icon(Icons.add, color: colorScheme.onPrimary, size: 30),
      )
          : null,
      body: NestedScrollView(
        headerSliverBuilder: (context, innerBoxIsScrolled) {
          return [
            SliverAppBar(
              pinned: true,
              expandedHeight: 410.0,
              backgroundColor: colorScheme.primary,
              elevation: 0,
              centerTitle: true,
              title: const Text('My Profile',
                  style: TextStyle(fontWeight: FontWeight.bold)),
              flexibleSpace: FlexibleSpaceBar(
                collapseMode: CollapseMode.pin,
                background: Container(
                  margin: const EdgeInsets.only(top: kToolbarHeight + 20),
                  decoration: BoxDecoration(
                    color: colorScheme.surface,
                    borderRadius:
                    const BorderRadius.vertical(top: Radius.circular(30)),
                  ),
                  child: Column(
                    children: [
                      const SizedBox(height: 20),
                      _buildProfileImage(),
                      const SizedBox(height: 15),
                      ShaderMask(
                        shaderCallback: (bounds) =>
                            AppColors.premiumGoldGradient.createShader(bounds),
                        child: const Text(
                          'John Doe',
                          style: TextStyle(
                              color: AppColors.surfaceLight,
                              fontSize: 24,
                              fontWeight: FontWeight.bold),
                        ),
                      ),
                      const SizedBox(height: 20)
                    ],
                  ),
                ),
              ),
              bottom: PreferredSize(
                preferredSize: const Size.fromHeight(100),
                child: Container(
                  width: double.infinity,
                  color: colorScheme.surface,
                  padding: const EdgeInsets.symmetric(vertical: 10),
                  child: Column(
                    children: [
                      const SizedBox(height: 20),
                      _buildGradientIndicator(),
                      const SizedBox(height: 10),
                      const Padding(
                        padding: EdgeInsets.symmetric(horizontal: 25),
                        child: Row(
                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
                          children: [
                            Text("Properties",
                                style: TextStyle(
                                    fontSize: 15, fontWeight: FontWeight.bold)),
                            Text("Inbound",
                                style: TextStyle(
                                    fontSize: 15, fontWeight: FontWeight.bold)),
                            Text("Past Rentals",
                                style: TextStyle(
                                    fontSize: 15, fontWeight: FontWeight.bold)),
                          ],
                        ),
                      ),
                    ],
                  ),
                ),
              ),
            ),
          ];
        },
        body: Container(
          color: colorScheme.surface,
          child: PageView(
            controller: _pageController,
            children: [
              _buildPropertiesList(),
              _buildInboundRequestsList(),
              _buildPastRentalsList(),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildPropertiesList() {
    return BlocBuilder<HomeCubit, HomeState>(
      builder: (context, state) {
        if (state is HomeLoading || state is HomeInitial) {
          return const Center(child: CircularProgressIndicator());
        }
        if (state is HomeLoaded) {
          return ListView.builder(
            padding: const EdgeInsets.all(20),
            itemCount: state.apartments.length,
            itemBuilder: (context, index) {
              final apartment = state.apartments[index];
              return ApartmentCard(
                apartment: apartment,
                onTap: () => Navigator.push(
                    context,
                    MaterialPageRoute(
                        builder: (_) => DetailsScreen(apartment: apartment))),
              );
            },
          );
        }
        return const Center(child: Text("Error loading properties"));
      },
    );
  }

  Widget _buildInboundRequestsList() {
    return ListView(
      padding: const EdgeInsets.all(20),
      children: [
        InboundRequestCard(
          tenantName: 'Samer Issa',
          dateRange: '22 Dec - 28 Dec',
          peopleCount: 3,
          apartmentImageUrl:
          'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=500',
          status: 'pending',
        ),
        InboundRequestCard(
          tenantName: 'Ali Ahmed',
          dateRange: '05 Jan - 12 Jan',
          peopleCount: 2,
          apartmentImageUrl:
          'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=500',
          status: 'pending',
        ),
      ],
    );
  }

  Widget _buildPastRentalsList() {
    return ListView(
      padding: const EdgeInsets.all(20),
      children: [
        InboundRequestCard(
          tenantName: 'Omar Khaled',
          dateRange: '01 Nov - 10 Nov',
          peopleCount: 2,
          apartmentImageUrl:
          'https://images.unsplash.com/photo-1484154218962-a197022b5858?w=500',
          status: 'completed',
        ),
      ],
    );
  }

  Widget _buildProfileImage() {
    return Stack(
      alignment: Alignment.center,
      children: [
        ShaderMask(
          shaderCallback: (Rect bounds) => const LinearGradient(
            colors: [Colors.yellow, Colors.orange, Colors.yellowAccent],
          ).createShader(bounds),
          child: Container(
            width: 190,
            height: 190,
            decoration: const BoxDecoration(
                shape: BoxShape.circle, color: Colors.white),
          ),
        ),
        const CircleAvatar(
          radius: 90,
          backgroundColor: Colors.transparent,
          backgroundImage: NetworkImage(
              'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=600'),
        ),
      ],
    );
  }

  Widget _buildGradientIndicator() {
    return ShaderMask(
      shaderCallback: (bounds) =>
          AppColors.premiumGoldGradient.createShader(bounds),
      child: SmoothPageIndicator(
        controller: _pageController,
        count: 3,
        effect: const ExpandingDotsEffect(
          activeDotColor: Colors.white,
          dotColor: AppColors.surfaceLight,
          dotHeight: 10,
          expansionFactor: 3,
        ),
      ),
    );
  }
}

class InboundRequestCard extends StatefulWidget {
  final String tenantName;
  final String dateRange;
  final int peopleCount;
  final String apartmentImageUrl;
  String status;

  InboundRequestCard({
    super.key,
    required this.tenantName,
    required this.dateRange,
    required this.peopleCount,
    required this.apartmentImageUrl,
    required this.status,
  });

  @override
  State<InboundRequestCard> createState() => _InboundRequestCardState();
}

class _InboundRequestCardState extends State<InboundRequestCard> {
  @override
  Widget build(BuildContext context) {
    return Card(
      margin: const EdgeInsets.only(bottom: 20),
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
      clipBehavior: Clip.antiAlias,
      elevation: 4,
      child: Column(
        children: [
          Stack(
            children: [
              Image.network(widget.apartmentImageUrl,
                  height: 140, width: double.infinity, fit: BoxFit.cover),
              Positioned(
                top: 10,
                right: 10,
                child: Container(
                  padding:
                  const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
                  decoration: BoxDecoration(
                    color: _getStatusColor(widget.status),
                    borderRadius: BorderRadius.circular(10),
                  ),
                  child: Text(
                      widget.status.toUpperCase(), // سيظهر هنا ACCEPTED أو PENDING
                      style: const TextStyle(
                          color: Colors.white,
                          fontSize: 10,
                          fontWeight: FontWeight.bold)),
                ),
              ),
            ],
          ),
          Padding(
            padding: const EdgeInsets.all(15),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(widget.tenantName,
                    style: const TextStyle(
                        fontSize: 18, fontWeight: FontWeight.bold)),
                const SizedBox(height: 8),
                Row(
                  children: [
                    const Icon(Icons.calendar_month,
                        size: 16, color: Colors.grey),
                    const SizedBox(width: 5),
                    Text(widget.dateRange,
                        style:
                        const TextStyle(color: Colors.grey, fontSize: 13)),
                    const Spacer(),
                    const Icon(Icons.people, size: 16, color: Colors.grey),
                    const SizedBox(width: 5),
                    Text('${widget.peopleCount} Guests',
                        style:
                        const TextStyle(color: Colors.grey, fontSize: 13)),
                  ],
                ),
                if (widget.status == 'pending') ...[
                  const SizedBox(height: 15),
                  Row(
                    children: [
                      Expanded(
                        child: OutlinedButton(
                          onPressed: () =>
                              setState(() => widget.status = 'canceled'),
                          style: OutlinedButton.styleFrom(
                              foregroundColor: Colors.red,
                              side: const BorderSide(color: Colors.red)),
                          child: const Text('Reject'),
                        ),
                      ),
                      const SizedBox(width: 10),
                      Expanded(
                        child: ElevatedButton(
                          onPressed: () =>
                              setState(() => widget.status = 'accepted'),
                          style: ElevatedButton.styleFrom(
                              backgroundColor: Colors.green,
                              foregroundColor: Colors.white),
                          child: const Text('Accept'),
                        ),
                      ),
                    ],
                  ),
                ] else ...[
                  const SizedBox(height: 15),
                  Container(
                    width: double.infinity,
                    padding: const EdgeInsets.all(10),
                    decoration: BoxDecoration(
                        color: _getStatusColor(widget.status).withOpacity(0.1),
                        borderRadius: BorderRadius.circular(10)),
                    child: Center(
                      child: Text(
                        widget.status == 'accepted'
                            ? 'Request Accepted'
                            : widget.status == 'completed'
                            ? 'Successfully Rented'
                            : 'Request Canceled',
                        style: TextStyle(
                            color: _getStatusColor(widget.status),
                            fontWeight: FontWeight.bold),
                      ),
                    ),
                  ),
                ],
              ],
            ),
          ),
        ],
      ),
    );
  }

  Color _getStatusColor(String status) {
    if (status == 'completed' || status == 'accepted') return Colors.green;
    if (status == 'canceled') return Colors.red;
    return Colors.orange; // لـ pending
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\property\add_property.dart
// =======================================================

import 'dart:io';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:image_picker/image_picker.dart';
import '../../../core/config/color/app_color.dart';
import '../../../l10n/app_localizations.dart';

class AddPropertyScreen extends StatefulWidget {
  const AddPropertyScreen({super.key});

  @override
  State<AddPropertyScreen> createState() => _AddPropertyScreenState();
}

class _AddPropertyScreenState extends State<AddPropertyScreen> {
  //  State Management & Controllers
  final List<XFile> _images = [];
  final GlobalKey<FormState> _formKey = GlobalKey<FormState>();

  bool _showImageError = false;

  final TextEditingController _bedroomsController = TextEditingController();
  final TextEditingController _bathroomsController = TextEditingController();
  final TextEditingController _areaController = TextEditingController();
  final TextEditingController _priceController = TextEditingController();
  final TextEditingController _cityController = TextEditingController();
  final TextEditingController _governorateController = TextEditingController();
  final TextEditingController _addressController = TextEditingController();
  final TextEditingController _descriptionController = TextEditingController();

  String _selectedPropertyType = '';

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();
    if (_selectedPropertyType.isEmpty) {
      _selectedPropertyType = AppLocalizations.of(context)!.apartment;
    }
  }

  @override
  void dispose() {
    _bedroomsController.dispose();
    _bathroomsController.dispose();
    _areaController.dispose();
    _priceController.dispose();
    _cityController.dispose();
    _governorateController.dispose();
    _addressController.dispose();
    _descriptionController.dispose();
    super.dispose();
  }

  // 2. Business Logic/Actions
  void _addPhoto(XFile? img) {
    if (img != null) {
      setState(() {
        _images.add(img);
        _showImageError = false;
      });
    }
  }

  void _removePhoto(int index) {
    setState(() {
      _images.removeAt(index);
      if (_images.isEmpty) {
        _showImageError = true;
      }
    });
  }

  void _submitProperty() {
    if (_images.isEmpty) {
      setState(() {
        _showImageError = true;
      });
    }

    final bool isFormValid = _formKey.currentState!.validate();
    final bool hasImages = _images.isNotEmpty;

    if (isFormValid && hasImages) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Form Submitted Successfully!')),
      );
    }
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return Scaffold(
      backgroundColor: colorScheme.background,
      appBar: const _PropertyAppBar(),
      body: SingleChildScrollView(
        child: SafeArea(
          child: Form(
            key: _formKey,
            child: Column(
                crossAxisAlignment: CrossAxisAlignment.stretch,
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  const SizedBox(height: 60),

                  _buildHeader(tr, colorScheme),
                  const SizedBox(height: 40),

                  _buildImageSection(tr, colorScheme),
                  const SizedBox(height: 30),

                  _buildEssentialDetailsSection(tr, colorScheme),
                  const SizedBox(height: 40),

                  _buildPriceSection(tr, colorScheme),
                  const SizedBox(height: 40),

                  _buildPropertyTypeSection(tr, colorScheme),
                  const SizedBox(height: 20),

                  _buildLocationDetailsSection(tr, colorScheme),
                  const SizedBox(height: 20),

                  _buildDescriptionSection(tr, colorScheme),

                  _buildSaveButton(tr),

                  const SizedBox(height: 20),
                ]),
          ),
        ),
      ),
    );
  }

  // 4. Helper Private Methods for UI Construction

  Widget _buildHeader(AppLocalizations tr, ColorScheme colorScheme) {
    return Center(
        child: Column(
          children: [
            Row(mainAxisAlignment: MainAxisAlignment.center, children: [
              ShaderMask(
                shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                child: Text(
                  tr.malaz,
                  style: TextStyle(color: colorScheme.onPrimary, fontSize: 40, fontWeight: FontWeight.w500),
                ),
              ),
              ShaderMask(
                  shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                  child: SizedBox(
                    height: 70,
                    width: 60,
                    child: Image.asset(
                      "assets/icons/key_logo.png",
                      color: Colors.white,
                    ),
                  ))
            ]),
            const SizedBox(height: 10),
            ShaderMask(
              shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
              child: Center(
                child: Text(
                  tr.share_your_property,
                  style: const TextStyle(color: Colors.white, fontSize: 15),
                ),
              ),
            ),
          ],
        ));
  }

  Widget _buildImageSection(AppLocalizations tr, ColorScheme colorScheme) {
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 24, vertical: 20),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          _PropertyImageCarousel(
            images: _images,
            onImageAdded: _addPhoto,
            onImageRemoved: _removePhoto,
            showError: _showImageError,
          ),
          if (_showImageError)
            Padding(
              padding: const EdgeInsets.only(top: 10, left: 0),
              child: Text(
                tr.image_required,
                style: const TextStyle(color: Colors.red, fontWeight: FontWeight.bold),
              ),
            ),
        ],
      ),
    );
  }

  Widget _buildEssentialDetailsSection(AppLocalizations tr, ColorScheme colorScheme) {
    const double titlePadding = 24.0;
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Padding(
          padding: EdgeInsets.only(left: titlePadding, bottom: 15),
          child: Text(
            tr.essential_details,
            style: TextStyle(color: colorScheme.primary, fontSize: 20, fontWeight: FontWeight.bold),
          ),
        ),
        Row(children: [
          Expanded(
              child: _PropertyFormInputField(
                controller: _bedroomsController,
                icon: Icons.bed,
                hint: "0",
                preffix: tr.bedrooms,
                isnumber: true,
                validator: (value) {
                  if (value == null || value.isEmpty || int.tryParse(value) == null || int.parse(value) <= 0) {
                    return tr.field_required;
                  }
                  return null;
                },
              )),
          Expanded(
              child: _PropertyFormInputField(
                controller: _bathroomsController,
                icon: Icons.bathtub,
                hint: "0",
                preffix: tr.bathrooms,
                isnumber: true,
                validator: (value) {
                  if (value == null || value.isEmpty || int.tryParse(value) == null || int.parse(value) <= 0) {
                    return tr.field_required;
                  }
                  return null;
                },
              )),
        ]),
        const SizedBox(height: 15),
        _PropertyFormInputField(
          controller: _areaController,
          icon: Icons.square_foot,
          hint: "0",
          preffix: tr.area,
          isnumber: true,
          suffix: ("sqft"),
          validator: (value) {
            if (value == null || value.isEmpty || int.tryParse(value) == null || int.parse(value) <= 0) {
              return tr.field_required;
            }
            return null;
          },
        ),
      ],
    );
  }

  Widget _buildPriceSection(AppLocalizations tr, ColorScheme colorScheme) {
    const double titlePadding = 24.0;
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Padding(
          padding: EdgeInsets.only(left: titlePadding, bottom: 10),
          child: Text(
            tr.price,
            style: TextStyle(color: colorScheme.primary, fontSize: 20, fontWeight: FontWeight.bold),
          ),
        ),
        _PropertyFormInputField(
          controller: _priceController,
          icon: Icons.money,
          hint: "0",
          preffix: "${tr.price} :",
          isnumber: true,
          suffix: "\$",
          validator: (value) {
            if (value == null || value.isEmpty || int.tryParse(value) == null || int.parse(value) <= 0) {
              return tr.field_required;
            }
            return null;
          },
        ),
      ],
    );
  }

  Widget _buildPropertyTypeSection(AppLocalizations tr, ColorScheme colorScheme) {
    const double titlePadding = 24.0;
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Padding(
          padding: EdgeInsets.only(left: titlePadding, bottom: 5),
          child: Text(
            tr.property_type,
            style: TextStyle(color: colorScheme.primary, fontSize: 20, fontWeight: FontWeight.bold),
          ),
        ),
        _PropertyTypeSelector(onTypeSelected: (selectedType) {
          _selectedPropertyType = selectedType;
        }),
      ],
    );
  }

  Widget _buildLocationDetailsSection(AppLocalizations tr, ColorScheme colorScheme) {
    const double titlePadding = 24.0;
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Padding(
          padding: EdgeInsets.only(left: titlePadding, bottom: 15),
          child: Text(
            tr.location_details,
            style: TextStyle(color: colorScheme.primary, fontSize: 20, fontWeight: FontWeight.bold),
          ),
        ),
        _PropertyFormInputField(
          controller: _cityController,
          icon: Icons.location_city,
          hint: tr.syria,
          preffix: tr.city,
          isnumber: false,
          validator: (value) {
            if (value == null || value.isEmpty) {
              return tr.field_required;
            }
            return null;
          },
        ),
        const SizedBox(height: 15),
        _PropertyFormInputField(
          controller: _governorateController,
          icon: Icons.public,
          hint: tr.damascus,
          preffix: tr.governorate,
          isnumber: false,
          validator: (value) {
            if (value == null || value.isEmpty) {
              return tr.field_required;
            }
            return null;
          },
        ),
        const SizedBox(height: 10),
        _PropertyFormInputField(
          controller: _addressController,
          icon: Icons.pin_drop,
          hint: tr.address_loc,
          preffix: tr.address,
          isnumber: false,
          validator: (value) {
            if (value == null || value.isEmpty) {
              return tr.field_required;
            }
            return null;
          },
        ),
      ],
    );
  }

  Widget _buildDescriptionSection(AppLocalizations tr, ColorScheme colorScheme) {
    const double titlePadding = 24.0;
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Padding(
          padding: EdgeInsets.only(left: titlePadding, bottom: 10),
          child: Text(
            tr.description,
            style: TextStyle(color: colorScheme.primary, fontSize: 20, fontWeight: FontWeight.bold),
          ),
        ),
        _PropertyFormInputField(
          controller: _descriptionController,
          hint: tr.describe_property,
          icon: Icons.description,
          preffix: "${tr.description}:",
          isnumber: false,
          validator: (value) {
            if (value == null || value.isEmpty) {
              return tr.field_required;
            }
            return null;
          },
        ),
      ],
    );
  }

  Widget _buildSaveButton(AppLocalizations tr) {
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 24.0, vertical: 30.0),
      child: _PrimaryGradientButton(
        text: tr.save,
        onTap: _submitProperty,
      ),
    );
  }
}

class _PropertyAppBar extends StatelessWidget implements PreferredSizeWidget {
  const _PropertyAppBar();

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return AppBar(
      title: Text(
        tr.add_property,
        style: const TextStyle(fontWeight: FontWeight.bold),
      ),
      backgroundColor: colorScheme.surface,
      elevation: 0,
      foregroundColor: colorScheme.onSurface,
      centerTitle: false,
    );
  }

  @override
  Size get preferredSize => const Size.fromHeight(kToolbarHeight);
}

class _PrimaryGradientButton extends StatelessWidget {
  final String text;
  final VoidCallback onTap;

  const _PrimaryGradientButton({required this.text, required this.onTap});

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onTap,
      child: Container(
        width: double.infinity,
        height: 55,
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(12),
          boxShadow: [
            BoxShadow(
              color: Colors.black.withOpacity(0.2),
              spreadRadius: 1,
              blurRadius: 5,
              offset: const Offset(0, 3),
            ),
          ],
        ),
        child: Stack(
          alignment: Alignment.center,
          children: [
            Positioned.fill(
              child: ShaderMask(
                shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                child: Container(
                  decoration: BoxDecoration(
                    color: Colors.white,
                    borderRadius: BorderRadius.circular(12),
                  ),
                ),
              ),
            ),
            Text(
              text,
              style: const TextStyle(
                fontSize: 18,
                fontWeight: FontWeight.bold,
                color: Colors.white,
              ),
            ),
          ],
        ),
      ),
    );
  }
}


class _PropertyFormInputField extends StatelessWidget {
  final TextEditingController? controller;
  final String? Function(String?)? validator;
  final String hint;
  final IconData icon;
  final String preffix;
  final String suffix;
  final bool isnumber;

  const _PropertyFormInputField({
    this.controller,
    this.validator,
    required this.hint,
    required this.icon,
    required this.isnumber,
    required this.preffix,
    this.suffix = '',
  });

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    const double horizontalPadding = 17.0;

    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: horizontalPadding, vertical: 8),
      child: TextFormField(
        controller: controller,
        validator: validator,
        keyboardType: isnumber ? TextInputType.number : TextInputType.text,
        maxLines: isnumber ? 1 : null,
        minLines: isnumber ? null : 1,

        inputFormatters: isnumber
            ? [
          FilteringTextInputFormatter.digitsOnly,
        ]
            : null,

        decoration: InputDecoration(
          prefixIcon: Padding(
            padding: const EdgeInsets.only(left: 15, right: 10),
            child: Row(
              mainAxisSize: MainAxisSize.min,
              children: [
                Icon(
                  icon,
                  color: colorScheme.onSurface,
                  size: 20,
                ),
                const SizedBox(width: 8),
                Text(
                  preffix,
                  style: TextStyle(
                    color: colorScheme.onSurface,
                    fontWeight: FontWeight.w500,
                  ),
                ),
              ],
            ),
          ),

          suffixIcon: (suffix.isNotEmpty && suffix != ' ')
              ? Padding(
            padding: const EdgeInsets.only(right: 15),
            child: SizedBox(
              width: 37,
              child: Align(
                alignment: Alignment.centerRight,
                child: Text(
                  suffix,
                  style: TextStyle(
                    color: colorScheme.onSurface,
                    fontWeight: FontWeight.w500,
                  ),
                ),
              ),
            ),
          )
              : null,

          hintText: hint,
          hintStyle: TextStyle(
            color: colorScheme.onSurface.withOpacity(0.4),
            fontWeight: FontWeight.w400,
          ),

          filled: true,
          fillColor: colorScheme.surface,
          contentPadding: const EdgeInsets.symmetric(vertical: 15, horizontal: 10),

          enabledBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide(color: colorScheme.primary.withOpacity(0.5), width: 1.0),
          ),
          focusedBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: BorderSide(color: colorScheme.primary, width: 2.0),
          ),
          errorBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: const BorderSide(color: Colors.red, width: 1.5),
          ),
          focusedErrorBorder: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12),
            borderSide: const BorderSide(color: Colors.red, width: 2.0),
          ),
        ),
      ),
    );
  }
}


class _PropertyTypeSelector extends StatefulWidget {
  final Function(String type)? onTypeSelected;

  const _PropertyTypeSelector({this.onTypeSelected});

  @override
  State<_PropertyTypeSelector> createState() => _PropertyTypeSelectorState();
}

class _PropertyTypeSelectorState extends State<_PropertyTypeSelector> {
  List<String> propertyTypes = [];
  String? _selectedType;
  bool _isInit = true;

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();

    if (_isInit) {
      final tr = AppLocalizations.of(context)!;
      propertyTypes = [
        tr.apartment,
        tr.villa,
        tr.house,
        tr.farm,
        tr.country_house,
      ];

      if (propertyTypes.isNotEmpty) {
        _selectedType = propertyTypes.first;
      }
      _isInit = false;
    }
  }

  void _handleSelection(String type) {
    setState(() {
      _selectedType = type;
    });
    if (widget.onTypeSelected != null && _selectedType != null) {
      widget.onTypeSelected!(_selectedType!);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.symmetric(horizontal: 24.0, vertical: 10.0),
      child: Wrap(
        spacing: 12.0,
        runSpacing: 10.0,
        children: propertyTypes.map((type) {
          return _TypeSelectorButton(
            text: type,
            isSelected: _selectedType == type,
            onTap: () => _handleSelection(type),
          );
        }).toList(),
      ),
    );
  }
}


class _TypeSelectorButton extends StatelessWidget {
  final String text;
  final bool isSelected;
  final VoidCallback onTap;

  const _TypeSelectorButton({
    required this.text,
    required this.isSelected,
    required this.onTap,
  });

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    final backgroundColor = isSelected ? colorScheme.primary : colorScheme.surface;
    final textColor = isSelected ? colorScheme.onPrimary : colorScheme.onSurface;

    return GestureDetector(
      onTap: onTap,
      child: Container(
        padding: const EdgeInsets.symmetric(horizontal: 18, vertical: 10),
        decoration: BoxDecoration(
          color: backgroundColor,
          borderRadius: BorderRadius.circular(10),
          border: Border.all(
            color: isSelected ? colorScheme.primary : colorScheme.primary.withOpacity(0.3),
            width: 1.5,
          ),
        ),
        child: Text(
          text,
          style: TextStyle(
            color: textColor,
            fontWeight: FontWeight.bold,
            fontSize: 14,
          ),
        ),
      ),
    );
  }
}

class _PropertyImageCarousel extends StatefulWidget {
  final List<XFile> images;
  final Function(XFile?) onImageAdded;
  final Function(int index)? onImageRemoved;
  final bool showError;

  const _PropertyImageCarousel({
    required this.images,
    required this.onImageAdded,
    this.onImageRemoved,
    this.showError = false,
  });

  @override
  State<_PropertyImageCarousel> createState() => _PropertyImageCarouselState();
}

class _PropertyImageCarouselState extends State<_PropertyImageCarousel> {
  Future<void> _pickImage() async {
    final picker = ImagePicker();
    final pickedFile = await picker.pickImage(source: ImageSource.gallery);
    widget.onImageAdded(pickedFile);
  }

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;
    final tr = AppLocalizations.of(context)!;

    return _DottedBox(
      isError: widget.showError,
      child: SizedBox(
        height: 250,
        child: Stack(
          children: <Widget>[
            Positioned.fill(
              child: ClipRRect(
                borderRadius: BorderRadius.circular(13),
                child: widget.images.isEmpty
                    ? Center(
                  child: Text(
                    tr.uploud_photo_property,
                    style: TextStyle(color: colorScheme.primary, fontSize: 16),
                  ),
                )
                    : PageView.builder(
                  itemCount: widget.images.length,
                  itemBuilder: (context, index) {
                    return Stack(
                      children: [
                        Image.file(
                          File(widget.images[index].path),
                          fit: BoxFit.cover,
                          width: double.infinity,
                          height: double.infinity,
                        ),

                        // زر الحذف
                        Positioned(
                          top: 8,
                          right: 8,
                          child: GestureDetector(
                            onTap: () {
                              if (widget.onImageRemoved != null) {
                                widget.onImageRemoved!(index);
                              }
                            },
                            child: Container(
                              width: 30,
                              height: 30,
                              decoration: BoxDecoration(
                                  color: Colors.red.shade700,
                                  shape: BoxShape.circle,
                                  border: Border.all(color: Colors.white, width: 1.5)),
                              child: const Icon(
                                Icons.close,
                                color: Colors.white,
                                size: 18,
                              ),
                            ),
                          ),
                        ),
                      ],
                    );
                  },
                ),
              ),
            ),

            // زر إضافة الصورة
            Positioned(
              top: 10,
              left: 10,
              child: _GradientFab(onPressed: _pickImage),
            ),
          ],
        ),
      ),
    );
  }
}


class _DottedBox extends StatelessWidget {
  final Widget child;
  final bool isError;
  const _DottedBox({required this.child, this.isError = false, Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final Color borderColor = isError ? Colors.red : Theme.of(context).colorScheme.primary;

    const BoxDecoration borderDecoration = BoxDecoration(
      borderRadius: BorderRadius.all(Radius.circular(18)),
      border: Border.fromBorderSide(BorderSide(color: Colors.transparent, width: 2.0)),
    );

    return SizedBox(
      width: double.infinity,
      child: CustomPaint(
        painter: __PrimaryBorderPainter(
          decoration: borderDecoration,
          borderColor: borderColor,
          isError: isError,
        ),
        child: Padding(
          padding: const EdgeInsets.all(5),
          child: child,
        ),
      ),
    );
  }
}


class __PrimaryBorderPainter extends CustomPainter {
  final BoxDecoration decoration;
  final Color? borderColor;
  final bool isError;

  __PrimaryBorderPainter({required this.decoration, this.borderColor, required this.isError});

  @override
  void paint(Canvas canvas, Size size) {
    final Rect rect = Offset.zero & size;
    final Paint borderPaint = Paint();

    borderPaint.color = isError ? Colors.red : (borderColor ?? Colors.transparent);

    borderPaint.style = PaintingStyle.stroke;
    borderPaint.strokeWidth = 2.0;

    final RRect rrect =
    RRect.fromRectAndRadius(rect, decoration.borderRadius!.resolve(TextDirection.ltr).topLeft);

    // لرسم خط متقطع (dotted line)، نحتاج إلى منطق مختلف. بما أن الكلاس الأصلي لم يكن يرسم خطاً متقطعاً حقيقياً،
    // بل يرسم RRect عادي، سأبقيه كما كان مع تغيير الاسم ليصبح خاصاً:
    canvas.drawRRect(rrect.deflate(borderPaint.strokeWidth / 2), borderPaint);
  }

  @override
  bool shouldRepaint(covariant __PrimaryBorderPainter oldDelegate) {
    return oldDelegate.isError != isError || oldDelegate.borderColor != borderColor;
  }
}


class _GradientFab extends StatelessWidget {
  final VoidCallback onPressed;
  const _GradientFab({required this.onPressed});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    return GestureDetector(
      onTap: onPressed,
      child: Container(
        width: 40,
        height: 40,
        decoration: BoxDecoration(
          shape: BoxShape.circle,
          gradient: AppColors.premiumGoldGradient,
          boxShadow: const [
            BoxShadow(color: Colors.black26, blurRadius: 4, offset: Offset(0, 2)),
          ],
        ),
        child: Icon(Icons.add_a_photo, color: colorScheme.surface, size: 20),
      ),
    );
  }
}
// =======================================================
// FILE PATH: lib\presentation\screens\settings\settings_screen.dart
// =======================================================


import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import '../../cubits/settings/settings_cubit.dart';

enum ThemeOption { light, dark, system }

/// [SettingsScreen]
/// It's not in work currently the whole code here is nothing but scribble
/// If you are about to fix this screen you can delete everything below
class SettingsScreen extends StatelessWidget {
  const SettingsScreen({super.key});

  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    final colorScheme = theme.colorScheme;

    return Scaffold(
      backgroundColor: colorScheme.background,
      appBar: AppBar(
        title: const Text('Settings', style: TextStyle(fontWeight: FontWeight.bold)),
        backgroundColor: colorScheme.surface,
        elevation: 0,
        foregroundColor: colorScheme.onSurface,
      ),
      body: Padding(
        padding: const EdgeInsets.all(20.0),
        child: BlocBuilder<SettingsCubit, SettingsState>(
          builder: (context, state) {
            return Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                const _BuildAppearanceTitleSection(),
                const SizedBox(height: 16),
                _ThemeSwitcher(currentThemeMode: state.themeMode),
                const SizedBox(height: 32),
                const _BuildLanguageTitleSection(),
                const SizedBox(height: 16),
                _LanguageSelector(currentLocale: state.locale),
              ],
            );
          },
        ),
      ),
    );
  }
}

// --- Widgets Building The Screen ---

class _BuildAppearanceTitleSection extends StatelessWidget {
  const _BuildAppearanceTitleSection();

  @override
  Widget build(BuildContext context) {
    return Text(
      'Appearance',
      style: TextStyle(
        fontSize: 14,
        fontWeight: FontWeight.bold,
        color: Theme.of(context).colorScheme.onSurface.withOpacity(0.6), // A less prominent color
      ),
    );
  }
}

class _ThemeSwitcher extends StatelessWidget {
  final ThemeMode currentThemeMode;
  const _ThemeSwitcher({required this.currentThemeMode});

  ThemeOption _getOptionForThemeMode(ThemeMode mode) {
    if (mode == ThemeMode.light) return ThemeOption.light;
    if (mode == ThemeMode.dark) return ThemeOption.dark;
    return ThemeOption.system;
  }

  @override
  Widget build(BuildContext context) {
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;
    return Container(
      padding: const EdgeInsets.all(6),
      decoration: BoxDecoration(
        color: isDarkMode ? Colors.black.withOpacity(0.2) : Colors.grey.shade200,
        borderRadius: BorderRadius.circular(16),
      ),
      child: Row(
        children: [
          _ThemeOption(
            option: ThemeOption.light,
            currentOption: _getOptionForThemeMode(currentThemeMode),
            title: 'Light',
            icon: Icons.wb_sunny_rounded,
          ),
          const SizedBox(width: 4),
          _ThemeOption(
            option: ThemeOption.dark,
            currentOption: _getOptionForThemeMode(currentThemeMode),
            title: 'Dark',
            icon: Icons.nightlight_round,
          ),
        ],
      ),
    );
  }
}

class _ThemeOption extends StatelessWidget {
  final ThemeOption option;
  final ThemeOption currentOption;
  final String title;
  final IconData icon;

  const _ThemeOption({
    required this.option,
    required this.currentOption,
    required this.title,
    required this.icon,
  });

  ThemeMode _getThemeModeForOption(ThemeOption option) {
    if (option == ThemeOption.light) return ThemeMode.light;
    if (option == ThemeOption.dark) return ThemeMode.dark;
    return ThemeMode.system;
  }

  @override
  Widget build(BuildContext context) {
    final isSelected = option == currentOption;
    final colorScheme = Theme.of(context).colorScheme;

    return Expanded(
      child: GestureDetector(
        onTap: () {
          final newThemeMode = _getThemeModeForOption(option);
          context.read<SettingsCubit>().updateThemeMode(newThemeMode);
        },
        child: AnimatedContainer(
          duration: const Duration(milliseconds: 200),
          padding: const EdgeInsets.symmetric(vertical: 12),
          decoration: BoxDecoration(
            color: isSelected ? colorScheme.surface : Colors.transparent,
            borderRadius: BorderRadius.circular(12),
            boxShadow: isSelected
                ? [BoxShadow(color: Colors.black.withOpacity(0.1), blurRadius: 10, offset: const Offset(0, 4))]
                : [],
          ),
          child: Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Icon(
                icon,
                color: isSelected ? colorScheme.primary : colorScheme.onSurface.withOpacity(0.6),
                size: 20,
              ),
              const SizedBox(width: 8),
              Text(
                title,
                style: TextStyle(
                  fontWeight: isSelected ? FontWeight.bold : FontWeight.normal,
                  color: isSelected ? colorScheme.onSurface : colorScheme.onSurface.withOpacity(0.6),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

class _BuildLanguageTitleSection extends StatelessWidget {
  const _BuildLanguageTitleSection();

  @override
  Widget build(BuildContext context) {
    return Text(
      'Language',
      style: TextStyle(
        fontSize: 14,
        fontWeight: FontWeight.bold,
        color: Theme.of(context).colorScheme.onSurface.withOpacity(0.6),
      ),
    );
  }
}

class _LanguageSelector extends StatelessWidget {
  final Locale currentLocale;
  const _LanguageSelector({required this.currentLocale});

  @override
  Widget build(BuildContext context) {
    final colorScheme = Theme.of(context).colorScheme;

    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),
      decoration: BoxDecoration(
        color: colorScheme.surface,
        borderRadius: BorderRadius.circular(16),
        boxShadow: [BoxShadow(color: Colors.black.withOpacity(0.05), blurRadius: 10, offset: const Offset(0, 4))],
      ),
      child: ListTile(
        leading: Icon(Icons.language_rounded, color: colorScheme.primary),
        title: Text('Language', style: TextStyle(fontWeight: FontWeight.bold, color: colorScheme.onSurface)),
        trailing: Row(
          mainAxisSize: MainAxisSize.min,
          children: [
            Text(
              currentLocale.languageCode.toUpperCase(),
              style: TextStyle(color: colorScheme.onSurface.withOpacity(0.6)),
            ),
            const SizedBox(width: 8),
            Icon(Icons.arrow_forward_ios_rounded, size: 16, color: colorScheme.onSurface.withOpacity(0.6)),
          ],
        ),
        onTap: () {
          final newLocale = currentLocale.languageCode == 'en' ? const Locale('ar') : const Locale('en');
          context.read<SettingsCubit>().updateLanguage(newLocale);
        },
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\side_drawer\app_drawer.dart
// =======================================================

import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';
import '../../../core/config/color/app_color.dart';
import '../../../core/service_locator/service_locator.dart';
import '../../../data/datasources/local/auth_local_datasource.dart';
import '../../../l10n/app_localizations.dart';
import '../../cubits/auth/auth_cubit.dart';
import '../../cubits/language/language_cubit.dart';
import '../../cubits/theme/theme_cubit.dart';

enum ThemeOption { light, dark, system }

/// [AppDrawer]
/// a huge mass here it needs to be cleaned up :(
class AppDrawer extends StatefulWidget {
  const AppDrawer({super.key});

  @override
  State<AppDrawer> createState() => _AppDrawerState();
}

class _AppDrawerState extends State<AppDrawer> {
  @override
  Widget build(BuildContext context) {
    final theme = Theme.of(context);
    final colorScheme = theme.colorScheme;
    final tr = AppLocalizations.of(context)!;

    return BlocListener<AuthCubit, AuthState>(
      listener: (context, state) {
        if (state is AuthUnauthenticated) {
          context.go('/login');
        }
      },
      child: Drawer(
            backgroundColor: theme.scaffoldBackgroundColor,
            child: Column(
              children: [
                _buildUserHeader(context, tr, colorScheme),
                Expanded(
                  child: ListView(
                    padding: const EdgeInsets.symmetric(vertical: 10),
                    children: [
                      _buildDrawerItem(context, Icons.person_outline, tr.my_profile, () {
                        context.push('/profile');
                      }),
                      _buildDrawerItem(context, Icons.palette_outlined, tr.theme, () {
                        Navigator.pop(context);
                        _showThemeBottomSheet(context);
                      }),
                      _buildDrawerItem(context, Icons.language, tr.language, () {
                        Navigator.pop(context);
                        _showLanguageBottomSheet(context);
                      }),
                      const Divider(),
                      _buildDrawerItem(context, Icons.apartment, tr.become_a_renter, () {}), // ?
                      _buildDrawerItem(context, Icons.settings_outlined, tr.settings, () {
                        context.push('/settings');
                      }),
                    ],
                  ),
                ),
                _buildLogoutButton(context, colorScheme, tr),
              ],
            ),
          ),
    );
  }

  Widget _buildDrawerItem(BuildContext context, IconData icon, String title, VoidCallback onTap) {
    final colorScheme = Theme.of(context).colorScheme;
    return ListTile(
      leading: Icon(icon, color: colorScheme.primary),
      title: Text(title,
          style: TextStyle(
              fontWeight: FontWeight.w600, color: colorScheme.onSurface)),
      onTap: onTap,
      contentPadding: const EdgeInsets.symmetric(horizontal: 24, vertical: 4),
    );
  }

  Widget _buildUserHeader(BuildContext context, AppLocalizations tr, ColorScheme colorScheme) {
    return BlocBuilder<AuthCubit, AuthState>(
      builder: (context, state) {
        String name = 'User Name';
        String? img;

        if (state is AuthAuthenticated) {
          name = "${state.user.first_name} ${state.user.last_name}";
          img = state.user.profile_image_url;
          print('>>>>>>>>>>>>${img}');
        }

        return Container(
          padding: const EdgeInsets.fromLTRB(20, 60, 20, 40),
          width: double.infinity,
          decoration: const BoxDecoration(gradient: AppColors.premiumGoldGradient2),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
            CircleAvatar(
            radius: 50,
            backgroundColor: Colors.white.withOpacity(0.3),
            child: (img == null || img.isEmpty)
                ? Icon(Icons.person, size: 60, color: colorScheme.surface)
                : UserProfileImage(
              imageUrl: img,
              size: 100.0,
            ),
          ),
          const SizedBox(height: 16),
          Text(name, style: TextStyle(color: colorScheme.surface, fontSize: 20, fontWeight: FontWeight.bold)),
          const SizedBox(height: 10),
          InkWell(
            onTap: () {
              context.push('/profile');
            },
            borderRadius: BorderRadius.circular(8),
            child: Container(
              padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 4),
              decoration: BoxDecoration(
                color: Colors.white.withOpacity(0.15),
                borderRadius: BorderRadius.circular(8),
                border: Border.all(
                  color: colorScheme.surface,
                  width: 1,
                ),
              ),
              child: Row(
                mainAxisSize: MainAxisSize.min,
                children: [
                  Icon(
                      Icons.edit_note_rounded,
                      color: colorScheme.surface,
                      size: 18
                  ),
                  const SizedBox(width: 6),
                  Text(
                    tr.edit_profile,
                    style: TextStyle(
                      color: colorScheme.surface,
                      fontSize: 12,
                      fontWeight: FontWeight.w500,
                    ),
                  ),
                ],
              ),
            ),
          ),
          ],
          ),
        );
      },
    );
  }

  Widget _buildLogoutButton(BuildContext context, ColorScheme colorScheme, AppLocalizations tr) {
    return Padding(
      padding: const EdgeInsets.all(20),
      child: Container(
        decoration: BoxDecoration(
          color: colorScheme.error.withOpacity(0.1),
          borderRadius: BorderRadius.circular(12),
        ),
        child: ListTile(
          leading: Icon(Icons.logout, color: colorScheme.error),
          title: Text(tr.logout, style: TextStyle(color: colorScheme.error, fontWeight: FontWeight.bold)),
          onTap: () => context.read<AuthCubit>().logout(),
        ),
      ),
    );
  }

  void _showThemeBottomSheet(BuildContext context) {
    final tr = AppLocalizations.of(context)!;
    showModalBottomSheet(
      context: context,
      shape: const RoundedRectangleBorder(
        borderRadius: BorderRadius.vertical(top: Radius.circular(24)),
      ),
      builder: (ctx) {
        return BlocBuilder<ThemeCubit, ThemeState>(
          builder: (context, state) {
            return Container(
              padding: const EdgeInsets.all(24),
              child: Column(
                mainAxisSize: MainAxisSize.min,
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(tr.select_theme,
                      style: Theme.of(context)
                          .textTheme
                          .headlineSmall
                          ?.copyWith(fontWeight: FontWeight.bold)),
                  const SizedBox(height: 24),
                  _ThemeSwitcher(currentThemeMode: state.themeMode),
                  const SizedBox(height: 20),
                ],
              ),
            );
          },
        );
      },
    );
  }

  void _showLanguageBottomSheet(BuildContext context) {
    final tr = AppLocalizations.of(context)!;
    showModalBottomSheet(
      context: context,
      isScrollControlled: true,
      shape: const RoundedRectangleBorder(
        borderRadius: BorderRadius.vertical(top: Radius.circular(24)),
      ),
      builder: (ctx) {
        return BlocBuilder<LanguageCubit, LanguageState>(
          builder: (context, state) {
            return Padding(
              padding: const EdgeInsets.all(24.0),
              child: Column(
                mainAxisSize: MainAxisSize.min,
                children: [
                  Text(tr.select_language,
                      style: Theme.of(context)
                          .textTheme
                          .headlineSmall
                          ?.copyWith(fontWeight: FontWeight.bold)),
                  const SizedBox(height: 16),
                  Flexible(
                    child: ListView(
                      shrinkWrap: true,
                      children: [
                        RadioListTile<Locale>(
                          title: const Text('English'),
                          value: const Locale('en'),
                          groupValue: state.locale,
                          onChanged: (value) => _onLanguageChanged(ctx, value),
                        ),
                        RadioListTile<Locale>(
                          title: const Text('العربية'),
                          value: const Locale('ar'),
                          groupValue: state.locale,
                          onChanged: (value) => _onLanguageChanged(ctx, value),
                        ),
                        RadioListTile<Locale>(
                          title: const Text('Français'),
                          value: const Locale('fr'),
                          groupValue: state.locale,
                          onChanged: (value) => _onLanguageChanged(ctx, value),
                        ),
                        RadioListTile<Locale>(
                          title: const Text('Русский'),
                          value: const Locale('ru'),
                          groupValue: state.locale,
                          onChanged: (value) => _onLanguageChanged(ctx, value),
                        ),
                        RadioListTile<Locale>(
                          title: const Text('Türkçe'),
                          value: const Locale('tr'),
                          groupValue: state.locale,
                          onChanged: (value) => _onLanguageChanged(ctx, value),
                        ),
                      ],
                    ),
                  ),
                  const SizedBox(height: 20),
                ],
              ),
            );
          },
        );
      },
    );
  }

  void _onLanguageChanged(BuildContext context, Locale? value) {
    if (value != null) {
      context.read<LanguageCubit>().updateLanguage(value);
      Navigator.pop(context);
    }
  }
}

class UserProfileImage extends StatelessWidget {
  final String imageUrl;
  final double size;

  const UserProfileImage({
    super.key,
    required this.imageUrl,
    this.size = 50.0
  });

  @override
  Widget build(BuildContext context) {
    return FutureBuilder<String?>(
      future: sl<AuthLocalDatasource>().getCachedToken(),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) {
          return SizedBox(
            width: size,
            height: size,
            child: const CircularProgressIndicator(strokeWidth: 2),
          );
        }

        final token = snapshot.data;

        return ClipRRect(
          borderRadius: BorderRadius.circular(size / 2),
          child: Image.network(
            imageUrl!,
            width: size,
            height: size,
            fit: BoxFit.cover,
            headers: {
              'Authorization': 'Bearer ${token?.trim()}', // إضافة trim للتأكد من عدم وجود مسافات
              'Accept': 'application/json',
              'Connection': 'keep-alive', // أحياناً تساعد في استقرار الطلب
            },
            errorBuilder: (context, error, stackTrace) {
              print('IMAGE ERROR: $error'); // سيطبع لكِ في الـ Console سبب الفشل
              return Container();
            },
          ),
        );
      },
    );
  }
}

// ... (theme switcher widgets remain the same)
class _ThemeSwitcher extends StatelessWidget {
  final ThemeMode currentThemeMode;
  const _ThemeSwitcher({required this.currentThemeMode});

  ThemeOption _getOptionForThemeMode(ThemeMode mode) {
    if (mode == ThemeMode.light) return ThemeOption.light;
    if (mode == ThemeMode.dark) return ThemeOption.dark;
    return ThemeOption.system;
  }

  @override
  Widget build(BuildContext context) {
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;
    return Container(
      padding: const EdgeInsets.all(6),
      decoration: BoxDecoration(
        color:
            isDarkMode ? Colors.black.withOpacity(0.2) : Colors.grey.shade200,
        borderRadius: BorderRadius.circular(16),
      ),
      child: Row(
        children: [
          _ThemeOption(
            option: ThemeOption.light,
            currentOption: _getOptionForThemeMode(currentThemeMode),
            title: 'Light',
            icon: Icons.wb_sunny_rounded,
          ),
          const SizedBox(width: 4),
          _ThemeOption(
            option: ThemeOption.dark,
            currentOption: _getOptionForThemeMode(currentThemeMode),
            title: 'Dark',
            icon: Icons.nightlight_round,
          ),
        ],
      ),
    );
  }
}

class _ThemeOption extends StatelessWidget {
  final ThemeOption option;
  final ThemeOption currentOption;
  final String title;
  final IconData icon;

  const _ThemeOption({
    required this.option,
    required this.currentOption,
    required this.title,
    required this.icon,
  });

  ThemeMode _getThemeModeForOption(ThemeOption option) {
    if (option == ThemeOption.light) return ThemeMode.light;
    if (option == ThemeOption.dark) return ThemeMode.dark;
    return ThemeMode.system;
  }

  @override
  Widget build(BuildContext context) {
    final isSelected = option == currentOption;
    final colorScheme = Theme.of(context).colorScheme;

    return Expanded(
      child: GestureDetector(
        onTap: () {
          final newThemeMode = _getThemeModeForOption(option);
          context.read<ThemeCubit>().changeTheme(newThemeMode);
        },
        child: AnimatedContainer(
          duration: const Duration(milliseconds: 200),
          padding: const EdgeInsets.symmetric(vertical: 12),
          decoration: BoxDecoration(
            color: isSelected ? colorScheme.surface : Colors.transparent,
            borderRadius: BorderRadius.circular(12),
            boxShadow: isSelected
                ? [
                    BoxShadow(
                        color: Colors.black.withOpacity(0.1),
                        blurRadius: 10,
                        offset: const Offset(0, 4))
                  ]
                : [],
          ),
          child: Row(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              Icon(
                icon,
                color: isSelected
                    ? colorScheme.primary
                    : colorScheme.onSurface.withOpacity(0.6),
                size: 20,
              ),
              const SizedBox(width: 8),
              Text(
                title,
                style: TextStyle(
                  fontWeight: isSelected ? FontWeight.bold : FontWeight.normal,
                  color: isSelected
                      ? colorScheme.onSurface
                      : colorScheme.onSurface.withOpacity(0.6),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}

// =======================================================
// FILE PATH: lib\presentation\screens\splash_screen\splash_screen.dart
// =======================================================

import 'dart:async';
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:go_router/go_router.dart';

import '../../../core/config/color/app_color.dart';
import '../../cubits/auth/auth_cubit.dart';
import '../../global_widgets/build_branding.dart';

/// [SplashScreen]
///
/// An animated splash_screen that displays a logo and branding
/// before transitioning to the main application.
/// the main purpose of this screen is to load vital data from the server
/// moreover, it impacts an awesome user experience
class SplashScreen extends StatefulWidget {
  const SplashScreen({super.key});

  @override
  _SplashScreenState createState() => _SplashScreenState();
}

/// [SingleTickerProviderStateMixin]
///
/// To make the UI draw it self ~60 times per second
class _SplashScreenState extends State<SplashScreen>
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;

  late Animation<double> _fadeAnimation;

  late Animation<double> _scaleAnimation;

  bool _authStarted = false;

  @override
  void initState() {
    super.initState();
    _animationController = AnimationController(
      vsync: this,
      duration: const Duration(seconds: 10),
    );

    _fadeAnimation = Tween<double>(begin: 0.85, end: 1.0).animate(
      CurvedAnimation(parent: _animationController, curve: Curves.easeInOut),
    );

    _scaleAnimation = Tween<double>(begin: 0.85, end: 1.0).animate(
      CurvedAnimation(parent: _animationController, curve: Curves.easeInOut),
    );

    _animationController.forward();
    _animationController.addStatusListener((status) {
      if (status == AnimationStatus.completed && !_authStarted) {
        // if (mounted) {
        //   //context.read<AuthBloc>().add(AuthCheckedRequested);
        //   context.go('/login');
        // }
        _authStarted = true;
        _startAuthCheckAndNavigate();
      }
    });
    // الانتظار حتى انتهاء animation + التأكد من auth state
    //_navigateAfterAnimation();

  }
  Future<void> _startAuthCheckAndNavigate() async {
    final authCubit = context.read<AuthCubit>();

    // نفذ checkAuth() الآن — سيغيّر حالة الـ cubit
    await authCubit.checkAuth();

    if (!mounted) return;

    final state = authCubit.state;
    if (state is AuthAuthenticated) {
      context.go('/home');
    } else {
      context.go('/login');
    }
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Theme.of(context).scaffoldBackgroundColor,
      body: Stack(
        children: [
          _BuildAnimatedLogoAndLoader(
            fadeAnimation: _fadeAnimation,
            scaleAnimation: _scaleAnimation,
          ),
          BuildBranding(),
        ],
      ),
    );
  }
}

/// [_BuildAnimatedLogoAndLoader]
///
/// A private widget class responsible for building the centered, animated logo
/// and the loading indicator.
class _BuildAnimatedLogoAndLoader extends StatelessWidget {
  final Animation<double> fadeAnimation;
  final Animation<double> scaleAnimation;

  const _BuildAnimatedLogoAndLoader({
    required this.fadeAnimation,
    required this.scaleAnimation,
  });

  @override
  Widget build(BuildContext context) {
    return Center(
      child: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          ScaleTransition(
            scale: scaleAnimation,
            child: FadeTransition(
              opacity: fadeAnimation,
              child: ShaderMask(
                shaderCallback: (bounds) => AppColors.premiumGoldGradient2.createShader(bounds),
                child: Image.asset(
                  'assets/icons/key_logo.png',
                  width: 150,
                  height: 150,
                  color: Colors.white,
                ),
              ),
            ),
          ),
          const SizedBox(height: 32),
          FadeTransition(
            opacity: CurvedAnimation(
              parent: fadeAnimation,
              curve: const Interval(0.3, 1.0, curve: Curves.easeIn),
            ),
            child: SizedBox(
              width: 120,
              child: ShaderMask(
                shaderCallback: (bounds) => AppColors.premiumGoldGradient.createShader(bounds),
                child: LinearProgressIndicator(
                  backgroundColor: Theme.of(
                    context,
                  ).primaryColor.withOpacity(0.1),
                  valueColor: AlwaysStoppedAnimation<Color>(
                    Colors.yellow
                    //Theme.of(context).primaryColor,
                  ),
                  minHeight: 2.5,
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
}
